echo "🚀 运行 Pre-push 检查门禁..."
echo ""

# 获取当前分支
BRANCH=$(git symbolic-ref --short HEAD 2>/dev/null)
echo "📌 当前分支: $BRANCH"
echo ""

# 进入 desktop-app-vue 目录
cd desktop-app-vue || exit 1

# 1. 运行 TypeScript 类型检查
echo "🔷 运行 TypeScript 类型检查..."
npm run type-check

if [ $? -ne 0 ]; then
  echo ""
  echo "❌ TypeScript 类型检查失败！"
  echo "请修复类型错误后再推送"
  echo ""
  echo "如需跳过检查（不推荐），使用: git push --no-verify"
  exit 1
fi

echo "✅ TypeScript 类型检查通过"
echo ""

# 注意: 数据库测试和 MCP 测试已移至 CI/CD 流水线
# 这些测试需要特定环境，在本地 pre-push 中容易超时或失败
# 完整测试请运行: npm run test:unit

echo "🎉 所有必要检查通过，允许推送！"
echo ""
echo "💡 提示: 完整单元测试请运行: cd desktop-app-vue && npm run test:unit"
