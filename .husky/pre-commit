#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” è¿è¡Œ Pre-commit ä»£ç è´¨é‡é—¨ç¦..."
echo ""

# 1. è¿è¡Œ lint-stagedï¼ˆESLint + Prettier + å®‰å…¨æ‰«æï¼‰
echo "ğŸ“ è¿è¡Œ ESLint å’Œä»£ç æ ¼å¼åŒ–..."
npx lint-staged

# æ£€æŸ¥ lint-staged é€€å‡ºç 
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ ESLint æˆ–å®‰å…¨æ‰«æå¤±è´¥ï¼"
  echo "è¯·ä¿®å¤ä¸Šè¿°é—®é¢˜åå†æäº¤"
  echo ""
  echo "å¦‚éœ€è·³è¿‡éªŒè¯ï¼ˆä¸æ¨èï¼‰ï¼Œä½¿ç”¨: git commit --no-verify"
  exit 1
fi

echo "âœ… ESLint å’Œä»£ç æ ¼å¼åŒ–é€šè¿‡"
echo ""

# 2. è¿è¡Œé¡¹ç›®è§„åˆ™éªŒè¯
echo "ğŸ” è¿è¡Œä»£ç è§„åˆ™éªŒè¯..."

# è¿›å…¥ desktop-app-vue ç›®å½•è¿è¡ŒéªŒè¯
cd desktop-app-vue || exit 1

# è¿è¡Œè§„åˆ™éªŒè¯å™¨
npm run validate:rules

# æ£€æŸ¥é€€å‡ºç 
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ ä»£ç è§„åˆ™éªŒè¯å¤±è´¥ï¼"
  echo "è¯·ä¿®å¤ä¸Šè¿°é—®é¢˜åå†æäº¤ï¼Œæˆ–æŸ¥çœ‹ .chainlesschain/rules.md äº†è§£ç¼–ç è§„èŒƒ"
  echo ""
  echo "å¦‚éœ€è·³è¿‡éªŒè¯ï¼ˆä¸æ¨èï¼‰ï¼Œä½¿ç”¨: git commit --no-verify"
  exit 1
fi

echo "âœ… ä»£ç è§„åˆ™éªŒè¯é€šè¿‡"
