# 设备管理

设备管理提供对所有已注册设备的全生命周期管理功能。

## 设备列表

### 查看设备列表

```
设备管理 → 设备列表

显示信息:
- 序列号
- 设备类型
- 设备型号
- 状态
- 用户ID（已激活时）
- 注册时间
- 激活时间
- 最后使用时间
```

### 筛选和搜索

```
筛选条件:
□ 设备类型: 全部 / U盾 / SIMKey
□ 状态: 全部 / 已注册 / 已激活 / 使用中 / 已停用
□ 时间范围: 最近7天 / 最近30天 / 自定义
□ 设备型号: ePass3003 / WatchData / USIM-001

搜索:
- 按序列号搜索
- 按用户ID搜索
- 按设备ID搜索
```

### 批量操作

```
选择多个设备:
☑ UP2024010100001
☑ UP2024010100002
☑ UP2024010100003

批量操作:
- 导出数据
- 批量停用
- 批量删除（仅未激活）
- 生成报表
- 打印标签
```

## 设备详情

点击设备可查看完整信息：

### 基本信息

```
设备ID: d7f3e8a1-4b2c-4d9e-8f1a-2b3c4d5e6f7a
序列号: UP2024010100001
设备类型: U盾
设备型号: ePass3003
硬件版本: v2.1
固件版本: v1.5.3
MAC地址: 00:1A:2B:3C:4D:5E
生产日期: 2024-01-01
状态: 使用中
```

### 使用信息

```
用户ID: user123
用户名: 张三
激活时间: 2024-01-05 10:30:00
最后使用: 2024-01-15 14:25:33
使用次数: 523次
在线状态: 在线
```

### 证书信息

```
证书类型: 安全证书
颁发日期: 2024-01-05
有效期至: 2026-01-05
公钥指纹: SHA256:a3f9b4c7...
证书状态: 有效

[查看证书] [下载证书] [吊销证书]
```

### 操作历史

```
时间              | 操作        | 操作员  | 结果
------------------|------------|--------|-------
2024-01-15 14:25  | 登录认证    | user123| 成功
2024-01-15 10:30  | 签名操作    | user123| 成功
2024-01-14 09:15  | 登录认证    | user123| 成功
2024-01-13 16:45  | 登录认证    | user123| 失败
```

## 设备状态管理

### 停用设备

```
设备详情 → 停用设备

停用原因:
○ 用户申请
● 安全风险
○ 设备故障
○ 其他

备注: 检测到异常登录

确认停用 → 设备状态变更为"已停用"
```

### 重新启用

```
设备详情 → 重新启用

验证:
- 管理员密码
- 两步验证

确认启用 → 设备状态恢复为"使用中"
```

### 报废设备

```
设备详情 → 报废设备

确认信息:
⚠️ 此操作不可撤销！
- 设备将永久无法使用
- 用户数据将被清除
- 证书将被吊销

输入管理员密码: ********
确认报废
```

## 远程管理

### 远程锁定

```
场景: 设备丢失或被盗

操作:
设备详情 → 远程操作 → 远程锁定

确认锁定 →
- 设备立即锁定
- 需要管理员解锁才能使用
- 发送通知给用户
```

### 远程擦除

```
⚠️ 危险操作！

设备详情 → 远程操作 → 远程擦除

将清除:
- 所有密钥
- 所有证书
- 所有用户数据

确认擦除 → 设备恢复出厂设置
```

### 远程更新

```
设备详情 → 远程操作 → 远程更新

选择固件版本: v1.6.0
更新内容:
- 修复安全漏洞
- 性能优化
- 新增功能

推送更新 → 设备收到更新通知
```

## 设备分组

### 创建分组

```
设备管理 → 设备分组 → 新建分组

分组名称: 2024年1月批次
分组描述: 2024年1月生产的所有设备
分组类型:
○ 按时间
● 按批次
○ 按型号
○ 自定义

保存
```

### 管理分组

```
分组列表:
┌────────────────────────────┐
│ 2024年1月批次              │
│ 设备数: 1,234              │
│ 已激活: 856 (69.3%)        │
│                            │
│ [查看设备] [编辑] [删除]    │
└────────────────────────────┘
```

## 设备统计

### 总体统计

```
仪表盘 → 设备统计

┌─────────────────┐ ┌─────────────────┐
│ 总设备数        │ │ 激活率          │
│ 10,234          │ │ 78.5%           │
└─────────────────┘ └─────────────────┘

┌─────────────────┐ ┌─────────────────┐
│ 在线设备        │ │ 故障设备        │
│ 3,456 (43%)     │ │ 23 (0.2%)       │
└─────────────────┘ └─────────────────┘
```

### 状态分布

```
设备状态分布:
- 已注册: 2,145 (21%)
- 已激活: 8,036 (78.5%)
- 使用中: 7,823 (76.4%)
- 已停用: 53 (0.5%)
- 已报废: 0

[饼图显示]
```

### 型号分布

```
设备型号分布:
1. ePass3003: 4,567 (44.6%)
2. WatchData: 3,234 (31.6%)
3. USIM-001: 1,876 (18.3%)
4. 其他: 557 (5.5%)

[柱状图显示]
```

### 使用趋势

```
设备使用趋势（近30天）:
[折线图显示每日活跃设备数]

高峰时段分析:
- 9:00-10:00: 峰值 3,456
- 14:00-15:00: 峰值 3,234
- 21:00-22:00: 峰值 2,987
```

## 设备告警

### 告警类型

| 告警级别 | 告警类型 | 说明 |
|---------|---------|------|
| 🔴 严重 | 设备被克隆 | 检测到克隆设备 |
| 🔴 严重 | 证书过期 | 设备证书已过期 |
| 🟡 警告 | 异常登录 | 异地登录或频繁失败 |
| 🟡 警告 | 固件过旧 | 固件版本过低 |
| 🔵 信息 | 使用量大 | 日使用次数超过阈值 |

### 告警配置

```
系统设置 → 告警配置

设备告警:
☑ 异常登录检测
  - 异地登录
  - 连续失败 > 3次

☑ 硬件异常
  - 证书即将过期（提前30天）
  - 固件版本低于 v1.5.0

☑ 使用异常
  - 日使用次数 > 100
  - 长时间未使用 > 90天

通知方式:
☑ 邮件
☑ 短信
□ 钉钉
□ 企业微信
```

### 告警处理

```
告警列表:
时间              | 设备        | 告警类型    | 级别 | 状态
------------------|------------|------------|------|------
2024-01-15 14:30  | UP20240... | 异常登录    | 🟡   | 待处理
2024-01-15 10:25  | SK20240... | 固件过旧    | 🟡   | 已处理
2024-01-14 16:45  | UP20240... | 设备被克隆  | 🔴   | 待处理

操作:
- 查看详情
- 标记已读
- 忽略
- 停用设备
```

## 设备维护

### 固件升级

```
设备详情 → 维护 → 固件升级

当前版本: v1.5.3
最新版本: v1.6.0

更新日志:
- 修复CVE-2024-0001安全漏洞
- 提升签名性能 20%
- 修复若干已知问题

[立即升级] [稍后提醒]
```

### 证书续期

```
设备详情 → 维护 → 证书续期

当前证书:
- 颁发日期: 2024-01-05
- 有效期至: 2026-01-05
- 剩余天数: 365天

续期选项:
○ 1年
● 2年
○ 5年

[续期证书]
```

### 故障诊断

```
设备详情 → 维护 → 故障诊断

运行诊断工具:
☑ 硬件检测
☑ 证书验证
☑ 通信测试
☑ 性能测试

开始诊断 →

诊断结果:
✓ 硬件正常
✓ 证书有效
✗ 通信延迟过高 (1500ms)
✓ 性能正常

建议操作:
- 检查网络连接
- 更新固件到最新版本
```

## 数据导出

### 导出设备列表

```
设备管理 → 导出

筛选条件:
- 时间范围: 2024-01-01 ~ 2024-01-31
- 设备状态: 全部
- 设备类型: U盾

导出字段:
☑ 序列号
☑ 设备型号
☑ 状态
☑ 用户ID
☑ 激活时间
☑ 最后使用时间
□ 证书信息
□ 操作历史

导出格式: Excel / CSV / PDF / JSON

生成报表
```

### 导出统计报表

```
报表中心 → 设备统计报表

报表类型:
○ 日报
● 月报
○ 年报
○ 自定义

时间范围: 2024年1月

包含内容:
☑ 设备总数
☑ 新增设备
☑ 激活设备
☑ 活跃设备
☑ 故障设备
☑ 使用统计

生成PDF报表
```

## API接口

### 获取设备列表

```http
GET /api/v1/devices?page=1&size=20&status=activated
Authorization: Bearer {token}
```

响应：
```json
{
  "code": 0,
  "data": {
    "total": 8036,
    "page": 1,
    "size": 20,
    "items": [
      {
        "deviceId": "d7f3e8a1-...",
        "serialNumber": "UP2024010100001",
        "deviceType": "U盾",
        "model": "ePass3003",
        "status": "使用中",
        "userId": "user123",
        "activatedAt": "2024-01-05T10:30:00Z",
        "lastUsedAt": "2024-01-15T14:25:33Z"
      }
    ]
  }
}
```

### 更新设备状态

```http
PATCH /api/v1/devices/{deviceId}/status
Content-Type: application/json
Authorization: Bearer {token}

{
  "status": "已停用",
  "reason": "安全风险",
  "remarks": "检测到异常登录"
}
```

## 最佳实践

1. ✅ **定期检查**: 每周检查设备状态和告警
2. ✅ **及时更新**: 推送固件更新到所有设备
3. ✅ **监控异常**: 配置告警，及时发现问题
4. ✅ **定期维护**: 定期进行设备健康检查
5. ✅ **数据备份**: 定期导出设备数据备份
