<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èœå•é›†æˆæµ‹è¯•åŠ©æ‰‹ - ChainlessChain v0.26.2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .stat-card {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            color: white;
        }
        .stat-card.total { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card.success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .stat-card.warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card.failed { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .menu-item {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .menu-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }
        .menu-item.tested {
            border-color: #38ef7d;
            background: #f0fff4;
        }
        .menu-item.failed {
            border-color: #f5576c;
            background: #fff5f5;
        }
        .menu-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .menu-info {
            flex: 1;
        }
        .menu-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        .menu-path {
            font-size: 12px;
            color: #888;
            font-family: 'Courier New', monospace;
        }
        .menu-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        .menu-status.untested { background: #e0e0e0; color: #999; }
        .menu-status.success { background: #38ef7d; color: white; }
        .menu-status.failed { background: #f5576c; color: white; }
        .controls {
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        button.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        button.secondary {
            background: #f0f0f0;
            color: #333;
        }
        button.secondary:hover {
            background: #e0e0e0;
        }
        .log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid transparent;
        }
        .log-entry.info { border-left-color: #4fc3f7; }
        .log-entry.success { border-left-color: #81c784; }
        .log-entry.error { border-left-color: #e57373; }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 8px;
        }
        .badge.new { background: #52c41a; color: white; }
        .badge.ai { background: #1890ff; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ChainlessChain v0.26.2 èœå•é›†æˆæµ‹è¯•</h1>
        <p class="subtitle">14ä¸ªæ–°å¢èœå•é¡¹è‡ªåŠ¨åŒ–éªŒè¯å·¥å…·</p>

        <div class="stats">
            <div class="stat-card total">
                <div class="stat-number" id="totalCount">14</div>
                <div class="stat-label">æ€»èœå•é¡¹</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="successCount">0</div>
                <div class="stat-label">æµ‹è¯•æˆåŠŸ</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-number" id="warningCount">0</div>
                <div class="stat-label">å¾…æµ‹è¯•</div>
            </div>
            <div class="stat-card failed">
                <div class="stat-number" id="failedCount">0</div>
                <div class="stat-label">æµ‹è¯•å¤±è´¥</div>
            </div>
        </div>

        <div class="controls">
            <button class="primary" onclick="startAutoTest()">ğŸš€ å¼€å§‹è‡ªåŠ¨æµ‹è¯•</button>
            <button class="secondary" onclick="stopAutoTest()">â¸ï¸ åœæ­¢æµ‹è¯•</button>
            <button class="secondary" onclick="resetTest()">ğŸ”„ é‡ç½®</button>
            <button class="secondary" onclick="copyReport()">ğŸ“‹ å¤åˆ¶æŠ¥å‘Š</button>
        </div>

        <div class="section">
            <div class="section-title">ğŸ“Š ç›‘æ§ä¸è¯Šæ–­ (6é¡¹)</div>
            <div class="menu-grid" id="monitoring-grid"></div>
        </div>

        <div class="section">
            <div class="section-title">ğŸ¤– MCPå’ŒAIé…ç½® (2é¡¹)</div>
            <div class="menu-grid" id="mcp-grid"></div>
        </div>

        <div class="section">
            <div class="section-title">ğŸ”— P2Pé«˜çº§åŠŸèƒ½ (6é¡¹)</div>
            <div class="menu-grid" id="p2p-grid"></div>
        </div>

        <div class="log" id="log"></div>
    </div>

    <script>
        const menuItems = {
            monitoring: [
                { id: 1, title: 'LLMæ€§èƒ½ç›‘æ§', path: '/llm/performance', icon: 'ğŸ“ˆ', badge: 'new' },
                { id: 2, title: 'æ•°æ®åº“æ€§èƒ½ç›‘æ§', path: '/database/performance', icon: 'ğŸ’¾', badge: null },
                { id: 3, title: 'é”™è¯¯ç›‘æ§', path: '/error/monitor', icon: 'ğŸ›', badge: 'ai' },
                { id: 4, title: 'ä¼šè¯ç®¡ç†', path: '/sessions', icon: 'ğŸ•’', badge: 'new' },
                { id: 5, title: 'å†…å­˜ä»ªè¡¨æ¿', path: '/memory', icon: 'ğŸ—„ï¸', badge: null },
                { id: 6, title: 'æ ‡ç­¾ç®¡ç†', path: '/tags', icon: 'ğŸ·ï¸', badge: null },
            ],
            mcp: [
                { id: 7, title: 'MCPæœåŠ¡å™¨', path: '/settings?tab=mcp', icon: 'âš™ï¸', badge: null },
                { id: 8, title: 'Tokenä½¿ç”¨ç»Ÿè®¡', path: '/settings?tab=token-usage', icon: 'ğŸ“Š', badge: null },
            ],
            p2p: [
                { id: 9, title: 'è®¾å¤‡é…å¯¹', path: '/p2p/device-pairing', icon: 'ğŸ”—', badge: null },
                { id: 10, title: 'è®¾å¤‡ç®¡ç†', path: '/p2p/device-management', icon: 'ğŸ“±', badge: null },
                { id: 11, title: 'æ–‡ä»¶ä¼ è¾“', path: '/p2p/file-transfer', icon: 'ğŸ“¤', badge: null },
                { id: 12, title: 'å®‰å…¨å·ç éªŒè¯', path: '/p2p/safety-numbers', icon: 'ğŸ”‘', badge: null },
                { id: 13, title: 'ä¼šè¯æŒ‡çº¹', path: '/p2p/session-fingerprint', icon: 'ğŸ”', badge: null },
                { id: 14, title: 'æ¶ˆæ¯é˜Ÿåˆ—', path: '/p2p/message-queue', icon: 'ğŸ“‹', badge: null },
            ]
        };

        let testResults = {};
        let autoTestRunning = false;
        let currentTestIndex = 0;

        function renderMenuItems() {
            ['monitoring', 'mcp', 'p2p'].forEach(category => {
                const grid = document.getElementById(`${category}-grid`);
                grid.innerHTML = menuItems[category].map(item => `
                    <div class="menu-item" id="item-${item.id}" onclick="testMenuItem(${item.id})">
                        <div class="menu-icon">${item.icon}</div>
                        <div class="menu-info">
                            <div class="menu-title">
                                ${item.title}
                                ${item.badge ? `<span class="badge ${item.badge}">${item.badge === 'new' ? 'æ–°' : 'AI'}</span>` : ''}
                            </div>
                            <div class="menu-path">${item.path}</div>
                        </div>
                        <div class="menu-status untested" id="status-${item.id}">?</div>
                    </div>
                `).join('');
            });
        }

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="log-entry ${type}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStats() {
            const results = Object.values(testResults);
            const success = results.filter(r => r === 'success').length;
            const failed = results.filter(r => r === 'failed').length;
            const waiting = 14 - success - failed;

            document.getElementById('successCount').textContent = success;
            document.getElementById('failedCount').textContent = failed;
            document.getElementById('warningCount').textContent = waiting;
        }

        function testMenuItem(id) {
            const allItems = [...menuItems.monitoring, ...menuItems.mcp, ...menuItems.p2p];
            const item = allItems.find(i => i.id === id);

            log(`å¼€å§‹æµ‹è¯•: ${item.title} (${item.path})`, 'info');

            // åœ¨Electronåº”ç”¨ä¸­å¯¼èˆªï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (window.opener && window.opener.location) {
                try {
                    window.opener.location.hash = '#' + item.path;
                    log(`âœ“ å·²è·³è½¬åˆ°: ${item.path}`, 'success');
                    markItemAs(id, 'success');
                } catch(e) {
                    log(`âœ— è·³è½¬å¤±è´¥: ${e.message}`, 'error');
                    markItemAs(id, 'failed');
                }
            } else {
                // æä¾›URLä¾›æ‰‹åŠ¨æµ‹è¯•
                const url = `http://127.0.0.1:5173/#${item.path}`;
                log(`è¯·åœ¨åº”ç”¨ä¸­è®¿é—®: ${url}`, 'info');
                log(`æˆ–åœ¨Consoleä¸­æ‰§è¡Œ: window.location.hash = '${item.path}'`, 'info');

                // æ¨¡æ‹Ÿæµ‹è¯•ï¼ˆç”¨æˆ·éœ€è¦æ‰‹åŠ¨ç¡®è®¤ï¼‰
                const result = confirm(`æ˜¯å¦æˆåŠŸæ‰“å¼€ "${item.title}" é¡µé¢ï¼Ÿ\n\nç‚¹å‡»"ç¡®å®š"è¡¨ç¤ºæˆåŠŸï¼Œ"å–æ¶ˆ"è¡¨ç¤ºå¤±è´¥`);
                markItemAs(id, result ? 'success' : 'failed');
            }
        }

        function markItemAs(id, status) {
            testResults[id] = status;

            const itemEl = document.getElementById(`item-${id}`);
            const statusEl = document.getElementById(`status-${id}`);

            itemEl.classList.remove('tested', 'failed');
            statusEl.classList.remove('untested', 'success', 'failed');

            if (status === 'success') {
                itemEl.classList.add('tested');
                statusEl.classList.add('success');
                statusEl.textContent = 'âœ“';
            } else if (status === 'failed') {
                itemEl.classList.add('failed');
                statusEl.classList.add('failed');
                statusEl.textContent = 'âœ—';
            }

            updateStats();
        }

        async function startAutoTest() {
            if (autoTestRunning) return;

            autoTestRunning = true;
            currentTestIndex = 0;
            log('ğŸš€ å¼€å§‹è‡ªåŠ¨æµ‹è¯•...', 'info');

            const allItems = [...menuItems.monitoring, ...menuItems.mcp, ...menuItems.p2p];

            for (let i = 0; i < allItems.length && autoTestRunning; i++) {
                currentTestIndex = i;
                const item = allItems[i];

                log(`[${i+1}/14] æµ‹è¯•: ${item.title}`, 'info');
                testMenuItem(item.id);

                // ç­‰å¾…2ç§’å†æµ‹è¯•ä¸‹ä¸€ä¸ª
                await new Promise(resolve => setTimeout(resolve, 2000));
            }

            autoTestRunning = false;
            log('âœ… è‡ªåŠ¨æµ‹è¯•å®Œæˆï¼', 'success');
            log(`ç»“æœ: ${Object.values(testResults).filter(r => r === 'success').length}/14 æˆåŠŸ`, 'success');
        }

        function stopAutoTest() {
            autoTestRunning = false;
            log('â¸ï¸ æµ‹è¯•å·²åœæ­¢', 'info');
        }

        function resetTest() {
            testResults = {};
            autoTestRunning = false;
            currentTestIndex = 0;

            document.querySelectorAll('.menu-item').forEach(el => {
                el.classList.remove('tested', 'failed');
            });

            document.querySelectorAll('.menu-status').forEach(el => {
                el.classList.remove('success', 'failed');
                el.classList.add('untested');
                el.textContent = '?';
            });

            document.getElementById('log').innerHTML = '';
            updateStats();
            log('ğŸ”„ æµ‹è¯•å·²é‡ç½®', 'info');
        }

        function copyReport() {
            const results = Object.values(testResults);
            const success = results.filter(r => r === 'success').length;
            const failed = results.filter(r => r === 'failed').length;

            const report = `
ChainlessChain v0.26.2 èœå•é›†æˆæµ‹è¯•æŠ¥å‘Š
æµ‹è¯•æ—¥æœŸ: ${new Date().toLocaleString()}
======================================
æ€»è®¡: 14ä¸ªèœå•é¡¹
æˆåŠŸ: ${success}/14
å¤±è´¥: ${failed}/14
å¾…æµ‹: ${14 - success - failed}/14
======================================

è¯¦ç»†ç»“æœ:
${[...menuItems.monitoring, ...menuItems.mcp, ...menuItems.p2p].map(item => {
    const status = testResults[item.id];
    const icon = status === 'success' ? 'âœ…' : status === 'failed' ? 'âŒ' : 'âš ï¸';
    return `${icon} ${item.title} - ${item.path}`;
}).join('\n')}
            `.trim();

            navigator.clipboard.writeText(report).then(() => {
                alert('æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                log('ğŸ“‹ æŠ¥å‘Šå·²å¤åˆ¶', 'success');
            });
        }

        // åˆå§‹åŒ–
        renderMenuItems();
        updateStats();
        log('âœ… æµ‹è¯•å·¥å…·å·²å°±ç»ª', 'success');
        log('ğŸ’¡ ç‚¹å‡»ä»»æ„èœå•é¡¹å¼€å§‹æµ‹è¯•ï¼Œæˆ–ç‚¹å‡»"å¼€å§‹è‡ªåŠ¨æµ‹è¯•"æŒ‰é’®', 'info');
    </script>
</body>
</html>
