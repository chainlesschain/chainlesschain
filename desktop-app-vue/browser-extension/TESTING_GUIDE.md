# ChainlessChain Web Clipper - 集成测试指南

## 📋 目录

- [测试前准备](#测试前准备)
- [测试环境](#测试环境)
- [测试清单](#测试清单)
- [详细测试步骤](#详细测试步骤)
- [测试结果记录](#测试结果记录)
- [问题排查](#问题排查)

---

## 测试前准备

### 1. 启动桌面应用

```bash
# 进入桌面应用目录
cd desktop-app-vue

# 启动开发模式
npm run dev
```

**验证桌面应用正常运行**：
- [ ] Electron 窗口已打开
- [ ] HTTP API 服务已启动（端口 23456）
- [ ] 数据库已初始化
- [ ] 控制台无严重错误

**测试 API 可用性**：
```bash
# Windows PowerShell
Invoke-WebRequest -Uri "http://localhost:23456/api/ping" -Method POST

# 或使用 curl (Git Bash)
curl -X POST http://localhost:23456/api/ping

# 预期响应
# {"success":true,"data":{"message":"pong"}}
```

### 2. 构建浏览器扩展

```bash
# 进入扩展目录
cd desktop-app-vue/browser-extension

# 构建 Chrome 版本
npm run build:chrome
```

**验证构建成功**：
- [ ] 构建无错误（webpack compiled successfully）
- [ ] `build/chrome/` 目录已生成
- [ ] 所有必要文件已复制

### 3. 加载扩展到浏览器

**Chrome/Edge**：
1. 打开 `chrome://extensions/`
2. 启用"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择 `build/chrome` 目录
5. 验证扩展图标出现在工具栏

**验证扩展加载**：
- [ ] 扩展图标可见
- [ ] 扩展 ID 已生成
- [ ] 无错误提示
- [ ] 点击图标可打开 popup

---

## 测试环境

### 环境信息

| 项目 | 版本/信息 |
|------|-----------|
| 操作系统 | Windows 10/11 |
| 浏览器 | Chrome 120+ / Edge 120+ |
| 扩展版本 | v2.0.0 |
| 桌面应用版本 | v0.16.0 |
| Node.js | 16.x+ |
| LLM 服务 | Ollama / Cloud API (可选) |

### 测试网站

准备以下测试页面：

| 类型 | URL | 用途 |
|------|-----|------|
| 技术博客 | https://react.dev/ | 测试文章提取 |
| 新闻网站 | https://news.ycombinator.com/ | 测试列表内容 |
| 文档网站 | https://developer.mozilla.org/ | 测试代码块提取 |
| 简单页面 | https://example.com/ | 测试基础功能 |
| 复杂页面 | https://github.com/ | 测试 Readability |

---

## 测试清单

### ✅ Phase 1: 基础连接测试

- [ ] T1.1 - 扩展与桌面应用连接状态
- [ ] T1.2 - HTTP API ping 测试
- [ ] T1.3 - 扩展 popup 正常打开
- [ ] T1.4 - 状态指示器正确显示

### ✅ Phase 2: 基础剪藏功能

- [ ] T2.1 - 简单页面剪藏
- [ ] T2.2 - 复杂页面剪藏（使用 Readability）
- [ ] T2.3 - 不使用 Readability 剪藏
- [ ] T2.4 - 自定义标题
- [ ] T2.5 - 添加标签
- [ ] T2.6 - 选择不同类型（文章/笔记/文档）
- [ ] T2.7 - 自动 RAG 索引选项
- [ ] T2.8 - 数据库记录验证

### ✅ Phase 3: AI 功能测试

- [ ] T3.1 - AI 标签生成（LLM 可用）
- [ ] T3.2 - AI 标签生成（LLM 不可用 - Fallback）
- [ ] T3.3 - AI 摘要生成（LLM 可用）
- [ ] T3.4 - AI 摘要生成（LLM 不可用 - Fallback）
- [ ] T3.5 - 标签/摘要按钮状态切换
- [ ] T3.6 - 加载指示器显示

### ✅ Phase 4: 截图与标注

- [ ] T4.1 - 截图捕获
- [ ] T4.2 - 标注编辑器打开
- [ ] T4.3 - 选择工具
- [ ] T4.4 - 画笔绘制
- [ ] T4.5 - 高亮标记
- [ ] T4.6 - 文本添加
- [ ] T4.7 - 箭头绘制
- [ ] T4.8 - 矩形绘制
- [ ] T4.9 - 颜色选择
- [ ] T4.10 - 撤销操作
- [ ] T4.11 - 清除所有标注
- [ ] T4.12 - 保存截图
- [ ] T4.13 - 文件系统验证
- [ ] T4.14 - 数据库记录验证

### ✅ Phase 5: 批量剪藏

- [ ] T5.1 - 批量剪藏窗口打开
- [ ] T5.2 - 标签页列表显示
- [ ] T5.3 - 单个标签页选择/取消
- [ ] T5.4 - 全选功能
- [ ] T5.5 - 取消全选功能
- [ ] T5.6 - 仅当前窗口选择
- [ ] T5.7 - 搜索过滤
- [ ] T5.8 - 批量处理启动
- [ ] T5.9 - 进度条更新
- [ ] T5.10 - 实时状态显示
- [ ] T5.11 - 错误处理
- [ ] T5.12 - 停止功能
- [ ] T5.13 - 完成统计
- [ ] T5.14 - 数据库批量记录验证

### ✅ Phase 6: 跨浏览器兼容性

- [ ] T6.1 - Chrome 120+ 兼容性
- [ ] T6.2 - Edge 120+ 兼容性
- [ ] T6.3 - Firefox 115+ 兼容性（可选）

### ✅ Phase 7: 边界测试

- [ ] T7.1 - 空标题处理
- [ ] T7.2 - 超长内容处理
- [ ] T7.3 - 特殊字符处理
- [ ] T7.4 - 网络断开重连
- [ ] T7.5 - 桌面应用崩溃恢复
- [ ] T7.6 - 并发剪藏限制

---

## 详细测试步骤

### Phase 1: 基础连接测试

#### T1.1 - 扩展与桌面应用连接状态

**步骤**：
1. 确保桌面应用已启动
2. 打开任意网页
3. 点击扩展图标
4. 观察状态指示器

**预期结果**：
- ✅ 状态显示"已连接"（绿色）
- ✅ 状态文本为"已连接"

**实际结果**：
- [ ] 通过 / [ ] 失败
- 备注：__________________

---

#### T1.2 - HTTP API ping 测试

**步骤**：
```bash
curl -X POST http://localhost:23456/api/ping
```

**预期结果**：
```json
{"success":true,"data":{"message":"pong"}}
```

**实际结果**：
- [ ] 通过 / [ ] 失败
- 响应：__________________

---

### Phase 2: 基础剪藏功能

#### T2.1 - 简单页面剪藏

**步骤**：
1. 打开 https://example.com/
2. 点击扩展图标
3. 查看预填信息：
   - 标题：应为 "Example Domain"
   - URL：应为当前页面 URL
4. 保持默认选项，点击"剪藏到知识库"
5. 等待成功提示

**预期结果**：
- ✅ 显示成功消息
- ✅ 桌面应用数据库中有新记录
- ✅ 内容正确提取

**验证数据库**：
```bash
# 在桌面应用中，打开开发者工具
# 查询最新的知识库条目
```

**实际结果**：
- [ ] 通过 / [ ] 失败
- 数据库 ID：__________________
- 备注：__________________

---

#### T2.2 - 复杂页面剪藏（使用 Readability）

**步骤**：
1. 打开 https://react.dev/learn
2. 点击扩展图标
3. 确保"使用 Readability 提取"已勾选
4. 点击"剪藏到知识库"

**预期结果**：
- ✅ 内容只包含正文，无导航栏/广告
- ✅ 保留代码块格式
- ✅ 保留标题层级

**实际结果**：
- [ ] 通过 / [ ] 失败
- 内容质量：[ ] 优秀 / [ ] 良好 / [ ] 一般 / [ ] 差
- 备注：__________________

---

#### T2.5 - 添加标签

**步骤**：
1. 打开任意技术博客
2. 点击扩展图标
3. 在"标签"输入框输入："React, 教程, 前端"
4. 点击"剪藏到知识库"

**预期结果**：
- ✅ 标签正确保存到数据库
- ✅ 标签数组：["React", "教程", "前端"]

**实际结果**：
- [ ] 通过 / [ ] 失败
- 数据库标签：__________________

---

### Phase 3: AI 功能测试

#### T3.1 - AI 标签生成（LLM 可用）

**前置条件**：
- LLM 服务已启动（Ollama 或云端 API）
- 桌面应用 LLM 设置正确

**步骤**：
1. 打开技术文章（如 React 文档）
2. 点击扩展图标
3. 点击"🤖 AI生成"按钮（标签输入框旁）
4. 等待 2-5 秒

**预期结果**：
- ✅ 按钮文本变为"生成中..."
- ✅ 2-5秒后标签自动填充
- ✅ 生成 3-5 个相关标签
- ✅ 按钮文本变为"✓ 已生成"，2秒后恢复

**实际结果**：
- [ ] 通过 / [ ] 失败
- 生成标签：__________________
- 响应时间：______ 秒
- 备注：__________________

---

#### T3.2 - AI 标签生成（LLM 不可用 - Fallback）

**前置条件**：
- 停止 LLM 服务（关闭 Ollama 或断开网络）

**步骤**：
1. 打开技术文章
2. 点击扩展图标
3. 点击"🤖 AI生成"按钮
4. 等待响应

**预期结果**：
- ✅ 使用关键词提取（Fallback）
- ✅ 返回基础标签（如域名、简单关键词）
- ✅ 无错误提示（或友好提示）

**实际结果**：
- [ ] 通过 / [ ] 失败
- Fallback 标签：__________________
- 备注：__________________

---

#### T3.3 - AI 摘要生成（LLM 可用）

**步骤**：
1. 打开长文章
2. 点击扩展图标
3. 点击"📝 生成摘要"按钮
4. 等待响应

**预期结果**：
- ✅ 摘要区域显示
- ✅ 生成 100-200 字摘要
- ✅ 摘要准确概括内容

**实际结果**：
- [ ] 通过 / [ ] 失败
- 摘要长度：______ 字
- 摘要质量：[ ] 优秀 / [ ] 良好 / [ ] 一般 / [ ] 差
- 备注：__________________

---

### Phase 4: 截图与标注

#### T4.1 - 截图捕获

**步骤**：
1. 打开任意网页
2. 点击扩展图标
3. 点击"📸 截图标注"按钮
4. 观察行为

**预期结果**：
- ✅ 标注编辑器窗口打开（1200x800）
- ✅ 截图正确显示在画布上
- ✅ popup 自动关闭

**实际结果**：
- [ ] 通过 / [ ] 失败
- 窗口尺寸：______x______
- 备注：__________________

---

#### T4.4 - 画笔绘制

**步骤**：
1. 在标注编辑器中，点击"✏️ 画笔"工具
2. 在画布上拖动鼠标绘制线条
3. 尝试绘制不同形状

**预期结果**：
- ✅ 工具按钮高亮（active 状态）
- ✅ 鼠标拖动时绘制红色线条
- ✅ 线条平滑连续

**实际结果**：
- [ ] 通过 / [ ] 失败
- 备注：__________________

---

#### T4.6 - 文本添加

**步骤**：
1. 点击"T 文本"工具
2. 在画布上点击一个位置
3. 输入文本："测试标注"
4. 点击画布其他位置确认

**预期结果**：
- ✅ 工具按钮高亮
- ✅ 点击后出现文本输入提示
- ✅ 文本正确显示在画布上
- ✅ 可以移动和编辑文本

**实际结果**：
- [ ] 通过 / [ ] 失败
- 备注：__________________

---

#### T4.9 - 颜色选择

**步骤**：
1. 点击颜色选择器图标
2. 选择蓝色 (#0000FF)
3. 使用画笔绘制线条

**预期结果**：
- ✅ 颜色选择器打开
- ✅ 选择后颜色变更
- ✅ 新绘制的内容为蓝色

**实际结果**：
- [ ] 通过 / [ ] 失败
- 备注：__________________

---

#### T4.10 - 撤销操作

**步骤**：
1. 绘制 3 个标注（画笔、文本、箭头）
2. 点击"↶ 撤销"按钮 3 次

**预期结果**：
- ✅ 每次点击撤销一个操作
- ✅ 按逆序删除标注
- ✅ 画布状态正确回退

**实际结果**：
- [ ] 通过 / [ ] 失败
- 备注：__________________

---

#### T4.12 - 保存截图

**步骤**：
1. 添加一些标注
2. 点击"💾 保存"按钮
3. 等待保存完成
4. 检查文件系统和数据库

**预期结果**：
- ✅ 显示"保存中..."提示
- ✅ 成功后窗口关闭或提示
- ✅ 文件保存到 `{userData}/screenshots/screenshot-{timestamp}.png`
- ✅ 数据库 `screenshots` 表有新记录

**验证**：
```bash
# 检查截图目录
ls {用户数据目录}/screenshots/

# 预期：screenshot-{timestamp}.png
```

**实际结果**：
- [ ] 通过 / [ ] 失败
- 文件路径：__________________
- 文件大小：______ KB
- 数据库 ID：__________________
- 备注：__________________

---

### Phase 5: 批量剪藏

#### T5.1 - 批量剪藏窗口打开

**步骤**：
1. 打开多个标签页（至少 5 个）
2. 点击扩展图标
3. 点击"📚 批量剪藏"按钮

**预期结果**：
- ✅ 批量剪藏窗口打开（900x700）
- ✅ popup 自动关闭
- ✅ 标签页列表加载中

**实际结果**：
- [ ] 通过 / [ ] 失败
- 备注：__________________

---

#### T5.2 - 标签页列表显示

**步骤**：
1. 观察标签页列表
2. 检查每个列表项

**预期结果**：
- ✅ 显示所有普通标签页（排除 chrome://、extension:// 等）
- ✅ 每项显示：favicon、标题、URL
- ✅ 每项有复选框
- ✅ 总数显示正确

**实际结果**：
- [ ] 通过 / [ ] 失败
- 显示标签页数：______
- 实际打开标签页数：______
- 备注：__________________

---

#### T5.7 - 搜索过滤

**步骤**：
1. 在搜索框输入："github"
2. 观察列表变化
3. 清空搜索框

**预期结果**：
- ✅ 实时过滤标题或 URL 包含"github"的标签页
- ✅ 总数更新
- ✅ 清空后显示所有标签页

**实际结果**：
- [ ] 通过 / [ ] 失败
- 过滤后数量：______
- 备注：__________________

---

#### T5.8 - 批量处理启动

**步骤**：
1. 选择 3-5 个标签页
2. 点击"开始剪藏 🚀"按钮
3. 观察进度面板

**预期结果**：
- ✅ 进度面板显示
- ✅ 进度条从 0% 开始
- ✅ 显示"正在处理: [页面标题]"
- ✅ 统计信息实时更新

**实际结果**：
- [ ] 通过 / [ ] 失败
- 备注：__________________

---

#### T5.10 - 实时状态显示

**步骤**：
1. 在批量处理过程中观察标签页状态
2. 检查状态变化

**预期结果**：
- ✅ 处理中：黄色背景 + "处理中..."标签
- ✅ 成功：绿色背景 + "✓ 成功"标签
- ✅ 失败：红色背景 + "✗ 失败"标签

**实际结果**：
- [ ] 通过 / [ ] 失败
- 备注：__________________

---

#### T5.13 - 完成统计

**步骤**：
1. 等待批量处理完成
2. 查看成功面板

**预期结果**：
- ✅ 显示✅图标动画
- ✅ 成功数量统计正确
- ✅ 失败数量统计（如有）
- ✅ "完成"按钮可用

**实际结果**：
- [ ] 通过 / [ ] 失败
- 成功：______ / 总计：______
- 失败：______
- 备注：__________________

---

### Phase 6: 跨浏览器兼容性

#### T6.1 - Chrome 120+ 兼容性

**步骤**：
1. 在 Chrome 中重复 Phase 2-5 所有测试
2. 记录任何异常

**实际结果**：
- [ ] 完全兼容 / [ ] 部分兼容 / [ ] 不兼容
- 问题：__________________

---

#### T6.2 - Edge 120+ 兼容性

**步骤**：
1. 在 Edge 中加载扩展
2. 重复 Phase 2-5 所有测试

**实际结果**：
- [ ] 完全兼容 / [ ] 部分兼容 / [ ] 不兼容
- 问题：__________________

---

### Phase 7: 边界测试

#### T7.1 - 空标题处理

**步骤**：
1. 打开网页
2. 清空标题输入框
3. 尝试剪藏

**预期结果**：
- ✅ 提示"请输入标题"
- ✅ 阻止提交

**实际结果**：
- [ ] 通过 / [ ] 失败
- 备注：__________________

---

#### T7.2 - 超长内容处理

**步骤**：
1. 打开超长文章（如 Wikipedia 长条目）
2. 剪藏内容

**预期结果**：
- ✅ 成功处理
- ✅ 无性能问题
- ✅ 内容完整保存

**实际结果**：
- [ ] 通过 / [ ] 失败
- 内容长度：______ 字符
- 处理时间：______ 秒
- 备注：__________________

---

#### T7.4 - 网络断开重连

**步骤**：
1. 剪藏一个页面（成功）
2. 断开网络（禁用网卡）
3. 尝试剪藏
4. 重新连接网络
5. 再次尝试剪藏

**预期结果**：
- ✅ 断网时显示错误提示
- ✅ 重连后恢复正常

**实际结果**：
- [ ] 通过 / [ ] 失败
- 错误提示：__________________
- 备注：__________________

---

## 测试结果记录

### 测试摘要

| 阶段 | 总数 | 通过 | 失败 | 通过率 |
|------|------|------|------|--------|
| Phase 1: 基础连接 | 4 | ___ | ___ | ___% |
| Phase 2: 基础剪藏 | 8 | ___ | ___ | ___% |
| Phase 3: AI 功能 | 6 | ___ | ___ | ___% |
| Phase 4: 截图标注 | 14 | ___ | ___ | ___% |
| Phase 5: 批量剪藏 | 14 | ___ | ___ | ___% |
| Phase 6: 跨浏览器 | 3 | ___ | ___ | ___% |
| Phase 7: 边界测试 | 6 | ___ | ___ | ___% |
| **总计** | **55** | **___** | **___** | **___%** |

### 发现的问题

| ID | 阶段 | 严重程度 | 问题描述 | 重现步骤 | 状态 |
|----|------|----------|----------|----------|------|
| BUG-001 | | 🔴高/🟡中/🟢低 | | | 待修复 |
| BUG-002 | | 🔴高/🟡中/🟢低 | | | 待修复 |

### 性能测试

| 测试项 | 预期 | 实际 | 通过 |
|--------|------|------|------|
| Popup 打开速度 | < 500ms | ___ ms | [ ] |
| 简单页面剪藏 | < 2s | ___ s | [ ] |
| 复杂页面剪藏 | < 5s | ___ s | [ ] |
| AI 标签生成 | < 5s | ___ s | [ ] |
| AI 摘要生成 | < 8s | ___ s | [ ] |
| 截图捕获 | < 1s | ___ s | [ ] |
| 批量剪藏 (10个) | < 30s | ___ s | [ ] |

---

## 问题排查

### 常见问题速查

#### 1. 状态显示"连接失败"

**检查清单**：
- [ ] 桌面应用是否运行
- [ ] HTTP API 服务是否启动（端口 23456）
- [ ] 防火墙是否阻止
- [ ] 测试 API: `curl -X POST http://localhost:23456/api/ping`

**解决方法**：
```bash
# 重启桌面应用
cd desktop-app-vue
npm run dev
```

---

#### 2. AI 功能不工作

**检查清单**：
- [ ] LLM 服务是否启动
- [ ] API Key 是否配置
- [ ] 网络连接正常

**测试 Ollama**：
```bash
curl http://localhost:11434/api/tags
```

---

#### 3. 批量剪藏部分失败

**可能原因**：
- 某些标签页未加载完成
- Content script 未注入
- 页面结构特殊

**建议**：
- 刷新失败的页面
- 单独剪藏失败的页面
- 查看控制台错误日志

---

#### 4. 截图功能不工作

**检查清单**：
- [ ] 浏览器权限（tabs 权限）
- [ ] 不是特殊页面（chrome://、about:）
- [ ] 浏览器版本足够新

---

## 测试完成清单

完成所有测试后：

- [ ] 所有核心功能测试通过
- [ ] 记录所有发现的问题
- [ ] 创建 Bug 修复计划
- [ ] 更新文档（如发现文档错误）
- [ ] 准备测试报告

---

## 测试报告模板

```markdown
# ChainlessChain Web Clipper v2.0.0 测试报告

## 测试信息
- 测试日期: YYYY-MM-DD
- 测试人员: [姓名]
- 测试环境: Windows 10, Chrome 120
- 扩展版本: v2.0.0

## 测试结果
- 总测试用例: 55
- 通过: XX
- 失败: XX
- 通过率: XX%

## 功能测试
### 基础剪藏 ✅
所有基础功能正常工作。

### AI 功能 ⚠️
发现问题：[描述]

### 截图标注 ✅
所有标注工具正常。

### 批量剪藏 ✅
并发处理和错误处理正常。

## 发现的问题
1. [BUG-001] 描述
2. [BUG-002] 描述

## 建议
1. [改进建议]
2. [优化建议]

## 结论
[总体评价]
```

---

**测试愉快！** 🧪✨
