{
  "id": "tpl_code_nextjs_008",
  "name": "nextjs_app",
  "display_name": "Next.js 全栈应用",
  "description": "Next.js 14+ 全栈应用开发框架，包含 App Router、Server Components、API Routes",
  "icon": "⚡",
  "category": "code-project",
  "subcategory": "frontend",
  "tags": [
    "Next.js",
    "React",
    "全栈开发",
    "SSR",
    "TypeScript"
  ],
  "project_type": "code",
  "prompt_template": "Next.js 全栈应用开发指南\n\n**项目信息：**\n- 项目名称：{{projectName}}\n- 应用类型：{{appType}}\n- 渲染策略：{{renderingStrategy}}\n- 数据库：{{database}}\n\n# Next.js 应用完整开发文档\n\n## 1. 项目初始化\n\n### 1.1 创建项目\n\n```bash\n# 使用 create-next-app\nnpx create-next-app@latest {{projectName}} --typescript --tailwind --app --use-npm\n\ncd {{projectName}}\n```\n\n**项目配置选项：**\n- ✅ TypeScript\n- ✅ ESLint\n- ✅ Tailwind CSS\n- ✅ App Router (推荐)\n- ✅ src/ 目录\n- {{#eq importAlias \"yes\"}}✅{{else}}❌{{/eq}} Import alias (@/*)\n\n### 1.2 项目结构\n\n```\n{{projectName}}/\n├── src/\n│   ├── app/                    # App Router 目录\n│   │   ├── layout.tsx         # 根布局\n│   │   ├── page.tsx           # 首页\n│   │   ├── globals.css        # 全局样式\n│   │   ├── api/               # API Routes\n│   │   │   └── [route]/route.ts\n│   │   ├── [feature]/         # 功能页面\n│   │   │   ├── page.tsx\n│   │   │   ├── loading.tsx\n│   │   │   └── error.tsx\n│   │   └── not-found.tsx      # 404 页面\n│   ├── components/            # React 组件\n│   │   ├── ui/               # UI 组件\n│   │   ├── forms/            # 表单组件\n│   │   └── layouts/          # 布局组件\n│   ├── lib/                   # 工具函数\n│   │   ├── utils.ts\n│   │   ├── db.ts             # 数据库连接\n│   │   └── api.ts            # API 客户端\n│   ├── hooks/                 # 自定义 Hooks\n│   ├── types/                 # TypeScript 类型\n│   └── config/                # 配置文件\n├── public/                    # 静态资源\n├── prisma/                    # Prisma 数据库\n│   └── schema.prisma\n├── .env.local                 # 环境变量\n├── next.config.js            # Next.js 配置\n├── tailwind.config.ts        # Tailwind 配置\n└── tsconfig.json             # TypeScript 配置\n```\n\n### 1.3 依赖安装\n\n**核心依赖：**\n```bash\nnpm install next@latest react@latest react-dom@latest\n```\n\n{{#eq database \"prisma\"}}\n**Prisma ORM：**\n```bash\nnpm install @prisma/client\nnpm install -D prisma\nnpx prisma init\n```\n{{/eq}}\n\n{{#eq database \"mongodb\"}}\n**MongoDB：**\n```bash\nnpm install mongodb mongoose\n```\n{{/eq}}\n\n{{#eq database \"supabase\"}}\n**Supabase：**\n```bash\nnpm install @supabase/supabase-js\n```\n{{/eq}}\n\n**常用库：**\n```bash\n# UI 组件库\nnpm install @radix-ui/react-dialog @radix-ui/react-dropdown-menu\nnpm install class-variance-authority clsx tailwind-merge\n\n# 表单处理\nnpm install react-hook-form zod @hookform/resolvers\n\n# 状态管理\nnpm install zustand\n\n# 认证\nnpm install next-auth@beta\n\n# 图标\nnpm install lucide-react\n```\n\n---\n\n## 2. App Router 核心概念\n\n### 2.1 服务端组件 (Server Components)\n\n**默认为服务端组件：**\n\n```tsx\n// src/app/posts/page.tsx\nimport { getPosts } from '@/lib/api'\n\nexport default async function PostsPage() {\n  // 直接在组件中获取数据\n  const posts = await getPosts()\n  \n  return (\n    <div>\n      <h1>{{pageTitle}}</h1>\n      <ul>\n        {posts.map(post => (\n          <li key={post.id}>{post.title}</li>\n        ))}\n      </ul>\n    </div>\n  )\n}\n```\n\n**优势：**\n- ✅ 直接访问后端资源（数据库、文件系统）\n- ✅ 减少客户端 JavaScript 体积\n- ✅ 提高首屏加载速度\n- ✅ 更好的 SEO\n\n### 2.2 客户端组件 (Client Components)\n\n**添加 'use client' 指令：**\n\n```tsx\n// src/components/Counter.tsx\n'use client'\n\nimport { useState } from 'react'\n\nexport default function Counter() {\n  const [count, setCount] = useState(0)\n  \n  return (\n    <button onClick={() => setCount(count + 1)}>\n      Count: {count}\n    </button>\n  )\n}\n```\n\n**使用场景：**\n- 使用 React Hooks（useState, useEffect 等）\n- 浏览器 API（localStorage, window 等）\n- 事件处理器（onClick, onChange 等）\n- 第三方库需要客户端环境\n\n### 2.3 路由与导航\n\n**文件系统路由：**\n\n```\napp/\n├── page.tsx              # /\n├── about/page.tsx        # /about\n├── blog/\n│   ├── page.tsx          # /blog\n│   └── [slug]/page.tsx   # /blog/:slug\n└── dashboard/\n    ├── layout.tsx        # 共享布局\n    ├── page.tsx          # /dashboard\n    └── settings/page.tsx # /dashboard/settings\n```\n\n**动态路由：**\n\n```tsx\n// src/app/blog/[slug]/page.tsx\ninterface PageProps {\n  params: { slug: string }\n  searchParams: { [key: string]: string | string[] | undefined }\n}\n\nexport default async function BlogPost({ params }: PageProps) {\n  const post = await getPost(params.slug)\n  \n  return (\n    <article>\n      <h1>{post.title}</h1>\n      <div dangerouslySetInnerHTML={{ __html: post.content }} />\n    </article>\n  )\n}\n\n// 生成静态路径\nexport async function generateStaticParams() {\n  const posts = await getPosts()\n  \n  return posts.map(post => ({\n    slug: post.slug,\n  }))\n}\n```\n\n**程序式导航：**\n\n```tsx\n'use client'\n\nimport { useRouter } from 'next/navigation'\n\nexport default function LoginButton() {\n  const router = useRouter()\n  \n  const handleLogin = () => {\n    // 登录逻辑...\n    router.push('/dashboard')\n  }\n  \n  return <button onClick={handleLogin}>Login</button>\n}\n```\n\n### 2.4 数据获取\n\n{{#eq renderingStrategy \"SSR\"}}\n**服务端渲染 (SSR)：**\n\n```tsx\n// 每次请求都重新获取\nexport const dynamic = 'force-dynamic'\n\nexport default async function Page() {\n  const data = await fetch('{{apiEndpoint}}', {\n    cache: 'no-store'  // 禁用缓存\n  })\n  \n  return <div>{/* ... */}</div>\n}\n```\n{{/eq}}\n\n{{#eq renderingStrategy \"SSG\"}}\n**静态生成 (SSG)：**\n\n```tsx\n// 构建时生成\nexport default async function Page() {\n  const data = await fetch('{{apiEndpoint}}', {\n    cache: 'force-cache'  // 永久缓存\n  })\n  \n  return <div>{/* ... */}</div>\n}\n```\n{{/eq}}\n\n{{#eq renderingStrategy \"ISR\"}}\n**增量静态再生 (ISR)：**\n\n```tsx\n// 定期重新验证\nexport const revalidate = {{revalidateSeconds}} // 秒\n\nexport default async function Page() {\n  const data = await fetch('{{apiEndpoint}}', {\n    next: { revalidate: {{revalidateSeconds}} }\n  })\n  \n  return <div>{/* ... */}</div>\n}\n```\n{{/eq}}\n\n---\n\n## 3. API Routes\n\n### 3.1 基础 API 路由\n\n```typescript\n// src/app/api/{{apiRouteName}}/route.ts\nimport { NextRequest, NextResponse } from 'next/server'\n\n// GET 请求\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams\n  const query = searchParams.get('query')\n  \n  try {\n    const data = await fetchData(query)\n    return NextResponse.json(data)\n  } catch (error) {\n    return NextResponse.json(\n      { error: 'Internal Server Error' },\n      { status: 500 }\n    )\n  }\n}\n\n// POST 请求\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const result = await createItem(body)\n    return NextResponse.json(result, { status: 201 })\n  } catch (error) {\n    return NextResponse.json(\n      { error: 'Bad Request' },\n      { status: 400 }\n    )\n  }\n}\n\n// PUT 请求\nexport async function PUT(request: NextRequest) {\n  const body = await request.json()\n  const result = await updateItem(body)\n  return NextResponse.json(result)\n}\n\n// DELETE 请求\nexport async function DELETE(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const id = searchParams.get('id')\n  await deleteItem(id)\n  return new NextResponse(null, { status: 204 })\n}\n```\n\n### 3.2 动态 API 路由\n\n```typescript\n// src/app/api/posts/[id]/route.ts\ninterface RouteParams {\n  params: { id: string }\n}\n\nexport async function GET(\n  request: NextRequest,\n  { params }: RouteParams\n) {\n  const post = await getPost(params.id)\n  \n  if (!post) {\n    return NextResponse.json(\n      { error: 'Post not found' },\n      { status: 404 }\n    )\n  }\n  \n  return NextResponse.json(post)\n}\n```\n\n### 3.3 中间件 (Middleware)\n\n```typescript\n// src/middleware.ts\nimport { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\n\nexport function middleware(request: NextRequest) {\n  // 认证检查\n  const token = request.cookies.get('token')?.value\n  \n  if (!token && request.nextUrl.pathname.startsWith('/dashboard')) {\n    return NextResponse.redirect(new URL('/login', request.url))\n  }\n  \n  // 添加自定义响应头\n  const response = NextResponse.next()\n  response.headers.set('x-custom-header', 'value')\n  \n  return response\n}\n\n// 配置匹配路径\nexport const config = {\n  matcher: ['/dashboard/:path*', '/api/:path*']\n}\n```\n\n---\n\n## 4. 数据库集成\n\n{{#eq database \"prisma\"}}\n### 4.1 Prisma 设置\n\n**Schema 定义：**\n\n```prisma\n// prisma/schema.prisma\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\ndatasource db {\n  provider = \"{{databaseProvider}}\"\n  url      = env(\"DATABASE_URL\")\n}\n\nmodel {{modelName}} {\n  id        String   @id @default(cuid())\n  title     String\n  content   String?\n  published Boolean  @default(false)\n  authorId  String\n  author    User     @relation(fields: [authorId], references: [id])\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n}\n\nmodel User {\n  id        String   @id @default(cuid())\n  email     String   @unique\n  name      String?\n  posts     Post[]\n  createdAt DateTime @default(now())\n}\n```\n\n**数据库客户端：**\n\n```typescript\n// src/lib/db.ts\nimport { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') {\n  globalForPrisma.prisma = prisma\n}\n```\n\n**使用示例：**\n\n```typescript\nimport { prisma } from '@/lib/db'\n\nexport async function getPosts() {\n  return await prisma.post.findMany({\n    where: { published: true },\n    include: { author: true },\n    orderBy: { createdAt: 'desc' }\n  })\n}\n```\n{{/eq}}\n\n{{#eq database \"mongodb\"}}\n### 4.2 MongoDB 设置\n\n```typescript\n// src/lib/mongodb.ts\nimport { MongoClient } from 'mongodb'\n\nconst uri = process.env.MONGODB_URI!\nconst options = {}\n\nlet client: MongoClient\nlet clientPromise: Promise<MongoClient>\n\nif (process.env.NODE_ENV === 'development') {\n  const globalWithMongo = global as typeof globalThis & {\n    _mongoClientPromise?: Promise<MongoClient>\n  }\n  \n  if (!globalWithMongo._mongoClientPromise) {\n    client = new MongoClient(uri, options)\n    globalWithMongo._mongoClientPromise = client.connect()\n  }\n  clientPromise = globalWithMongo._mongoClientPromise\n} else {\n  client = new MongoClient(uri, options)\n  clientPromise = client.connect()\n}\n\nexport default clientPromise\n```\n{{/eq}}\n\n---\n\n## 5. 认证系统\n\n### 5.1 NextAuth.js 配置\n\n```typescript\n// src/app/api/auth/[...nextauth]/route.ts\nimport NextAuth from 'next-auth'\nimport GithubProvider from 'next-auth/providers/github'\nimport CredentialsProvider from 'next-auth/providers/credentials'\n\nconst handler = NextAuth({\n  providers: [\n    GithubProvider({\n      clientId: process.env.GITHUB_ID!,\n      clientSecret: process.env.GITHUB_SECRET!,\n    }),\n    CredentialsProvider({\n      name: 'Credentials',\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        // 验证逻辑\n        const user = await verifyUser(credentials)\n        if (user) {\n          return user\n        }\n        return null\n      }\n    })\n  ],\n  callbacks: {\n    async session({ session, token }) {\n      session.user.id = token.sub\n      return session\n    }\n  },\n  pages: {\n    signIn: '/login',\n  }\n})\n\nexport { handler as GET, handler as POST }\n```\n\n### 5.2 保护路由\n\n```tsx\n// src/app/dashboard/page.tsx\nimport { getServerSession } from 'next-auth'\nimport { redirect } from 'next/navigation'\n\nexport default async function Dashboard() {\n  const session = await getServerSession()\n  \n  if (!session) {\n    redirect('/login')\n  }\n  \n  return <div>Welcome, {session.user.name}!</div>\n}\n```\n\n---\n\n## 6. 样式与 UI\n\n### 6.1 Tailwind CSS 工具类\n\n```tsx\nimport { cn } from '@/lib/utils'\n\ninterface ButtonProps {\n  variant?: 'primary' | 'secondary' | 'outline'\n  size?: 'sm' | 'md' | 'lg'\n}\n\nexport function Button({ variant = 'primary', size = 'md', ...props }: ButtonProps) {\n  return (\n    <button\n      className={cn(\n        'rounded font-medium transition-colors',\n        {\n          'bg-blue-600 text-white hover:bg-blue-700': variant === 'primary',\n          'bg-gray-200 text-gray-900 hover:bg-gray-300': variant === 'secondary',\n          'border border-gray-300 hover:bg-gray-50': variant === 'outline',\n        },\n        {\n          'px-3 py-1.5 text-sm': size === 'sm',\n          'px-4 py-2 text-base': size === 'md',\n          'px-6 py-3 text-lg': size === 'lg',\n        }\n      )}\n      {...props}\n    />\n  )\n}\n```\n\n### 6.2 CSS Modules\n\n```tsx\n// src/components/Card.tsx\nimport styles from './Card.module.css'\n\nexport function Card({ children }) {\n  return (\n    <div className={styles.card}>\n      {children}\n    </div>\n  )\n}\n```\n\n```css\n/* src/components/Card.module.css */\n.card {\n  @apply rounded-lg border bg-white p-6 shadow-sm;\n}\n\n.card:hover {\n  @apply shadow-md;\n}\n```\n\n---\n\n## 7. 性能优化\n\n### 7.1 图片优化\n\n```tsx\nimport Image from 'next/image'\n\nexport function ProductImage({ src, alt }) {\n  return (\n    <Image\n      src={src}\n      alt={alt}\n      width={500}\n      height={300}\n      priority // 关键图片预加载\n      placeholder=\"blur\" // 模糊占位符\n      blurDataURL=\"data:image/...\"\n    />\n  )\n}\n```\n\n### 7.2 代码分割\n\n```tsx\nimport dynamic from 'next/dynamic'\n\n// 动态导入，减少初始加载体积\nconst HeavyComponent = dynamic(() => import('@/components/HeavyComponent'), {\n  loading: () => <p>Loading...</p>,\n  ssr: false // 仅客户端渲染\n})\n\nexport default function Page() {\n  return <HeavyComponent />\n}\n```\n\n### 7.3 字体优化\n\n```tsx\n// src/app/layout.tsx\nimport { Inter, Roboto_Mono } from 'next/font/google'\n\nconst inter = Inter({\n  subsets: ['latin'],\n  display: 'swap',\n})\n\nconst robotoMono = Roboto_Mono({\n  subsets: ['latin'],\n  display: 'swap',\n})\n\nexport default function RootLayout({ children }) {\n  return (\n    <html lang=\"zh-CN\" className={inter.className}>\n      <body>{children}</body>\n    </html>\n  )\n}\n```\n\n---\n\n## 8. 部署\n\n### 8.1 环境变量\n\n```bash\n# .env.local\nDATABASE_URL=\"{{databaseUrl}}\"\nNEXTAUTH_SECRET=\"{{nextAuthSecret}}\"\nNEXTAUTH_URL=\"http://localhost:3000\"\nGITHUB_ID=\"{{githubId}}\"\nGITHUB_SECRET=\"{{githubSecret}}\"\n```\n\n### 8.2 Vercel 部署\n\n```bash\n# 安装 Vercel CLI\nnpm i -g vercel\n\n# 部署\nvercel\n\n# 生产部署\nvercel --prod\n```\n\n### 8.3 Docker 部署\n\n```dockerfile\n# Dockerfile\nFROM node:18-alpine AS base\n\n# Dependencies\nFROM base AS deps\nRUN apk add --no-cache libc6-compat\nWORKDIR /app\nCOPY package*.json ./\nRUN npm ci\n\n# Builder\nFROM base AS builder\nWORKDIR /app\nCOPY --from=deps /app/node_modules ./node_modules\nCOPY . .\nRUN npm run build\n\n# Runner\nFROM base AS runner\nWORKDIR /app\nENV NODE_ENV production\nRUN addgroup --system --gid 1001 nodejs\nRUN adduser --system --uid 1001 nextjs\n\nCOPY --from=builder /app/public ./public\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static\n\nUSER nextjs\nEXPOSE 3000\nENV PORT 3000\n\nCMD [\"node\", \"server.js\"]\n```\n\n---\n\n## 9. 测试\n\n### 9.1 单元测试 (Jest)\n\n```typescript\n// __tests__/components/Button.test.tsx\nimport { render, screen } from '@testing-library/react'\nimport { Button } from '@/components/Button'\n\ndescribe('Button', () => {\n  it('renders correctly', () => {\n    render(<Button>Click me</Button>)\n    expect(screen.getByText('Click me')).toBeInTheDocument()\n  })\n})\n```\n\n### 9.2 E2E 测试 (Playwright)\n\n```typescript\n// tests/e2e/homepage.spec.ts\nimport { test, expect } from '@playwright/test'\n\ntest('homepage has title', async ({ page }) => {\n  await page.goto('http://localhost:3000')\n  await expect(page).toHaveTitle(/{{projectName}}/)\n})\n```\n\n---\n\n## 10. 最佳实践\n\n### 10.1 项目规范\n\n- ✅ 使用 TypeScript 确保类型安全\n- ✅ 遵循 ESLint 和 Prettier 规则\n- ✅ 服务端组件优先，必要时使用客户端组件\n- ✅ 使用 App Router 而非 Pages Router\n- ✅ 合理使用缓存和重新验证策略\n\n### 10.2 SEO 优化\n\n```tsx\n// src/app/blog/[slug]/page.tsx\nimport { Metadata } from 'next'\n\nexport async function generateMetadata({ params }): Promise<Metadata> {\n  const post = await getPost(params.slug)\n  \n  return {\n    title: post.title,\n    description: post.excerpt,\n    openGraph: {\n      title: post.title,\n      description: post.excerpt,\n      images: [post.coverImage],\n    },\n  }\n}\n```\n\n### 10.3 错误处理\n\n```tsx\n// src/app/error.tsx\n'use client'\n\nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string }\n  reset: () => void\n}) {\n  return (\n    <div>\n      <h2>Something went wrong!</h2>\n      <button onClick={() => reset()}>Try again</button>\n    </div>\n  )\n}\n```\n\n---\n\n## 附录\n\n### A. 常用命令\n\n```bash\n# 开发\nnpm run dev\n\n# 构建\nnpm run build\n\n# 启动生产服务器\nnpm start\n\n# 类型检查\nnpm run type-check\n\n# Lint\nnpm run lint\n\n# Prisma\nnpx prisma generate\nnpx prisma migrate dev\nnpx prisma studio\n```\n\n### B. 参考资源\n\n- [Next.js 官方文档](https://nextjs.org/docs)\n- [App Router 文档](https://nextjs.org/docs/app)\n- [Vercel 部署指南](https://vercel.com/docs)\n- [Prisma 文档](https://www.prisma.io/docs)\n",
  "variables_schema": [
    {
      "name": "projectName",
      "label": "项目名称",
      "type": "string",
      "required": true
    },
    {
      "name": "appType",
      "label": "应用类型",
      "type": "select",
      "required": true,
      "options": [
        {"value": "blog", "label": "博客/内容站"},
        {"value": "ecommerce", "label": "电商平台"},
        {"value": "dashboard", "label": "管理后台"},
        {"value": "saas", "label": "SaaS 应用"},
        {"value": "landing", "label": "落地页"},
        {"value": "portfolio", "label": "作品集"}
      ]
    },
    {
      "name": "renderingStrategy",
      "label": "渲染策略",
      "type": "select",
      "required": false,
      "options": [
        {"value": "SSR", "label": "服务端渲染 (SSR)"},
        {"value": "SSG", "label": "静态生成 (SSG)"},
        {"value": "ISR", "label": "增量静态再生 (ISR)"}
      ]
    },
    {
      "name": "database",
      "label": "数据库选择",
      "type": "select",
      "required": false,
      "options": [
        {"value": "prisma", "label": "Prisma (PostgreSQL/MySQL)"},
        {"value": "mongodb", "label": "MongoDB"},
        {"value": "supabase", "label": "Supabase"},
        {"value": "none", "label": "无数据库"}
      ]
    }
  ],
  "file_structure": {
    "root": "{{projectName}}",
    "files": [
      {"path": "src/app/layout.tsx", "type": "code"},
      {"path": "src/app/page.tsx", "type": "code"},
      {"path": "src/components/", "type": "folder"},
      {"path": "src/lib/utils.ts", "type": "code"},
      {"path": ".env.local", "type": "config"}
    ]
  },
  "default_files": [],
  "is_builtin": true,
  "author": "ChainlessChain Team",
  "version": "1.0.0"
}
