{
  "id": "tpl_tech_docs_deploy_006",
  "name": "deployment_guide",
  "display_name": "éƒ¨ç½²è¿ç»´æ–‡æ¡£",
  "display_name": "éƒ¨ç½²è¿ç»´æ–‡æ¡£",
  "description": "è¯¦ç»†çš„ç³»ç»Ÿéƒ¨ç½²ä¸è¿ç»´æ–‡æ¡£æ¨¡æ¿,åŒ…å«ç¯å¢ƒå‡†å¤‡ã€éƒ¨ç½²æ­¥éª¤ã€é…ç½®è¯´æ˜ã€ç›‘æ§å‘Šè­¦ã€æ•…éšœå¤„ç†ç­‰,é€‚ç”¨äºå„ç§éƒ¨ç½²åœºæ™¯",
  "icon": "ğŸš€",
  "category": "tech-docs",
  "subcategory": "éƒ¨ç½²æ–‡æ¡£",
  "tags": ["éƒ¨ç½²æ–‡æ¡£", "è¿ç»´æ‰‹å†Œ", "DevOps", "æœåŠ¡å™¨é…ç½®"],
  "project_type": "document",
  "prompt_template": "è¯·å¸®æˆ‘ç”Ÿæˆéƒ¨ç½²è¿ç»´æ–‡æ¡£ï¼Œè¦æ±‚:\n\n# {{systemName}} éƒ¨ç½²è¿ç»´æ–‡æ¡£\n\n## 1. æ–‡æ¡£ä¿¡æ¯\n\n| é¡¹ç›® | å†…å®¹ |\n|------|------|\n| ç³»ç»Ÿåç§° | {{systemName}} |\n| æ–‡æ¡£ç‰ˆæœ¬ | {{docVersion}} |\n| éƒ¨ç½²ç¯å¢ƒ | {{deploymentEnv}} |\n| è¿ç»´è´Ÿè´£äºº | {{#if opsOwner}}{{opsOwner}}{{else}}è¿ç»´å›¢é˜Ÿ{{/if}} |\n| æ›´æ–°æ—¥æœŸ | {{#if updateDate}}{{updateDate}}{{else}}{{currentDate}}{{/if}} |\n\n---\n\n## 2. ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ\n\n### 2.1 éƒ¨ç½²æ¶æ„\n\n```\n{{#eq deploymentType \"äº‘åŸç”Ÿ\"}}\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚           è´Ÿè½½å‡è¡¡ (ALB/NLB)            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                   â”‚\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â–¼                   â–¼\n   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   â”‚  K8sé›†ç¾¤  â”‚        â”‚  K8sé›†ç¾¤  â”‚\n   â”‚ (Zone A) â”‚        â”‚ (Zone B) â”‚\n   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚                   â”‚\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                   â–¼\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚   RDSä¸»ä»é›†ç¾¤   â”‚\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n{{/eq}}\n\n{{#eq deploymentType \"ä¼ ç»Ÿéƒ¨ç½²\"}}\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   Nginx(ä¸»/å¤‡)   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”\n    â–¼         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”\nâ”‚åº”ç”¨æœåŠ¡1â”‚ â”‚åº”ç”¨æœåŠ¡2â”‚\nâ””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜\n    â”‚         â”‚\n    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜\n         â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ æ•°æ®åº“  â”‚\n    â”‚(ä¸»/ä») â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n{{/eq}}\n```\n\n### 2.2 æœåŠ¡å™¨æ¸…å•\n\n| æœåŠ¡å™¨åç§° | IPåœ°å€ | è§’è‰² | é…ç½® | ç³»ç»Ÿ |\n|-----------|--------|------|------|------|\n| {{server1Name}} | {{server1IP}} | {{server1Role}} | {{server1Config}} | {{server1OS}} |\n| {{server2Name}} | {{server2IP}} | {{server2Role}} | {{server2Config}} | {{server2OS}} |\n| {{server3Name}} | {{server3IP}} | {{server3Role}} | {{server3Config}} | {{server3OS}} |\n\n**æ¨èé…ç½®**(ç”Ÿäº§ç¯å¢ƒ):\n- **åº”ç”¨æœåŠ¡å™¨**: 8æ ¸16GB, SSD 200GB\n- **æ•°æ®åº“æœåŠ¡å™¨**: 16æ ¸32GB, SSD 500GB\n- **RedisæœåŠ¡å™¨**: 4æ ¸8GB, SSD 100GB\n\n---\n\n## 3. ç¯å¢ƒå‡†å¤‡\n\n### 3.1 æ“ä½œç³»ç»Ÿè¦æ±‚\n\n{{#eq serverOS \"Linux\"}}\n**æ¨èç³»ç»Ÿ**: Ubuntu 20.04 LTS / CentOS 8 / Rocky Linux 8\n\n**ç³»ç»Ÿåˆå§‹åŒ–**:\n\n```bash\n# æ›´æ–°ç³»ç»Ÿ\nsudo apt update && sudo apt upgrade -y  # Ubuntu/Debian\nsudo yum update -y                       # CentOS/Rocky\n\n# è®¾ç½®æ—¶åŒº\nsudo timedatectl set-timezone Asia/Shanghai\n\n# é…ç½®ä¸»æœºå\nsudo hostnamectl set-hostname {{systemName}}-app-01\n\n# å…³é—­SELinux(CentOS)\nsudo setenforce 0\nsudo sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\n\n# é…ç½®é˜²ç«å¢™\nsudo ufw allow 22/tcp    # SSH\nsudo ufw allow 80/tcp    # HTTP\nsudo ufw allow 443/tcp   # HTTPS\nsudo ufw allow 3306/tcp  # MySQL(ä»…æ•°æ®åº“æœåŠ¡å™¨)\nsudo ufw enable\n\n# è°ƒæ•´ç³»ç»Ÿå‚æ•°\nsudo sysctl -w vm.max_map_count=262144\nsudo sysctl -w net.core.somaxconn=1024\necho \"vm.max_map_count=262144\" | sudo tee -a /etc/sysctl.conf\necho \"net.core.somaxconn=1024\" | sudo tee -a /etc/sysctl.conf\n```\n{{/eq}}\n\n### 3.2 ä¾èµ–è½¯ä»¶å®‰è£…\n\n{{#eq techStack \"Java\"}}\n#### å®‰è£…Java\n\n```bash\n# å®‰è£…OpenJDK 17\nsudo apt install openjdk-17-jdk -y  # Ubuntu\nsudo yum install java-17-openjdk -y # CentOS\n\n# éªŒè¯å®‰è£…\njava -version\n\n# é…ç½®JAVA_HOME\necho 'export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64' >> ~/.bashrc\necho 'export PATH=$JAVA_HOME/bin:$PATH' >> ~/.bashrc\nsource ~/.bashrc\n```\n{{/eq}}\n\n{{#eq techStack \"Node.js\"}}\n#### å®‰è£…Node.js\n\n```bash\n# ä½¿ç”¨nvmå®‰è£…\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash\nsource ~/.bashrc\n\nnvm install 18\nnvm use 18\n\n# éªŒè¯å®‰è£…\nnode -v\nnpm -v\n\n# é…ç½®npmé•œåƒ\nnpm config set registry https://registry.npmmirror.com\n```\n{{/eq}}\n\n{{#eq techStack \"Python\"}}\n#### å®‰è£…Python\n\n```bash\n# å®‰è£…Python 3.11\nsudo apt install python3.11 python3.11-venv python3-pip -y\n\n# éªŒè¯å®‰è£…\npython3 --version\npip3 --version\n\n# é…ç½®pipé•œåƒ\npip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple\n```\n{{/eq}}\n\n#### å®‰è£…Docker\n\n```bash\n# å®‰è£…Docker\ncurl -fsSL https://get.docker.com | bash -s docker\n\n# å¯åŠ¨Docker\nsudo systemctl start docker\nsudo systemctl enable docker\n\n# æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„\nsudo usermod -aG docker $USER\n\n# é…ç½®Dockeré•œåƒåŠ é€Ÿ\nsudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\n    \"https://docker.mirrors.ustc.edu.cn\",\n    \"https://hub-mirror.c.163.com\"\n  ],\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  }\n}\nEOF\n\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n\n# éªŒè¯å®‰è£…\ndocker --version\n```\n\n#### å®‰è£…Docker Compose\n\n```bash\nsudo curl -L \"https://github.com/docker/compose/releases/download/v2.24.0/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\n\n# éªŒè¯å®‰è£…\ndocker-compose --version\n```\n\n---\n\n## 4. æ•°æ®åº“éƒ¨ç½²\n\n### 4.1 MySQLéƒ¨ç½²\n\n{{#eq database \"MySQL\"}}\n#### Dockeræ–¹å¼éƒ¨ç½²\n\n```bash\n# åˆ›å»ºæ•°æ®ç›®å½•\nmkdir -p /data/mysql/{data,conf,logs}\n\n# åˆ›å»ºé…ç½®æ–‡ä»¶\ncat > /data/mysql/conf/my.cnf << 'EOF'\n[mysqld]\nuser=mysql\nport=3306\ncharacter-set-server=utf8mb4\ncollation-server=utf8mb4_unicode_ci\ndefault-time-zone='+08:00'\n\n# InnoDBé…ç½®\ninnodb_buffer_pool_size=2G\ninnodb_log_file_size=256M\ninnodb_flush_log_at_trx_commit=2\ninnodb_flush_method=O_DIRECT\n\n# è¿æ¥é…ç½®\nmax_connections=1000\nmax_connect_errors=100000\n\n# æ…¢æŸ¥è¯¢æ—¥å¿—\nslow_query_log=1\nslow_query_log_file=/var/log/mysql/slow.log\nlong_query_time=2\n\n[client]\ndefault-character-set=utf8mb4\nEOF\n\n# å¯åŠ¨MySQLå®¹å™¨\ndocker run -d \\\n  --name mysql \\\n  --restart=always \\\n  -p 3306:3306 \\\n  -e MYSQL_ROOT_PASSWORD={{dbPassword}} \\\n  -v /data/mysql/data:/var/lib/mysql \\\n  -v /data/mysql/conf/my.cnf:/etc/mysql/conf.d/my.cnf \\\n  -v /data/mysql/logs:/var/log/mysql \\\n  mysql:8.0\n\n# ç­‰å¾…MySQLå¯åŠ¨\nsleep 30\n\n# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·\ndocker exec -i mysql mysql -uroot -p{{dbPassword}} << 'EOF'\nCREATE DATABASE IF NOT EXISTS {{dbName}} CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\nCREATE USER IF NOT EXISTS '{{dbUser}}'@'%' IDENTIFIED BY '{{dbPassword}}';\nGRANT ALL PRIVILEGES ON {{dbName}}.* TO '{{dbUser}}'@'%';\nFLUSH PRIVILEGES;\nEOF\n\n# å¯¼å…¥åˆå§‹åŒ–SQL\ndocker exec -i mysql mysql -u{{dbUser}} -p{{dbPassword}} {{dbName}} < init.sql\n```\n{{/eq}}\n\n### 4.2 Rediséƒ¨ç½²\n\n```bash\n# åˆ›å»ºRedisé…ç½®\nmkdir -p /data/redis/{data,conf}\n\ncat > /data/redis/conf/redis.conf << 'EOF'\nbind 0.0.0.0\nprotected-mode yes\nport 6379\nrequirepass {{redisPassword}}\n\n# æŒä¹…åŒ–é…ç½®\nappendonly yes\nappendfilename \"appendonly.aof\"\nappendfsync everysec\n\n# å†…å­˜é…ç½®\nmaxmemory 2gb\nmaxmemory-policy allkeys-lru\n\n# æ…¢æŸ¥è¯¢æ—¥å¿—\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nEOF\n\n# å¯åŠ¨Rediså®¹å™¨\ndocker run -d \\\n  --name redis \\\n  --restart=always \\\n  -p 6379:6379 \\\n  -v /data/redis/data:/data \\\n  -v /data/redis/conf/redis.conf:/etc/redis/redis.conf \\\n  redis:7-alpine redis-server /etc/redis/redis.conf\n\n# éªŒè¯Redis\ndocker exec -it redis redis-cli -a {{redisPassword}} ping\n```\n\n---\n\n## 5. åº”ç”¨éƒ¨ç½²\n\n### 5.1 è·å–éƒ¨ç½²åŒ…\n\n```bash\n# åˆ›å»ºåº”ç”¨ç›®å½•\nmkdir -p /opt/{{systemName}}\ncd /opt/{{systemName}}\n\n# ä»Gitä»“åº“è·å–ä»£ç \ngit clone {{gitRepo}} .\ngit checkout {{deployBranch}}\n\n# æˆ–ä»CI/CDè·å–åˆ¶å“\nwget {{artifactUrl}}/{{systemName}}-{{deployVersion}}.tar.gz\ntar -xzf {{systemName}}-{{deployVersion}}.tar.gz\n```\n\n### 5.2 é…ç½®æ–‡ä»¶\n\n{{#eq deploymentType \"Docker\"}}\n#### docker-compose.yml\n\n```yaml\nversion: '3.8'\n\nservices:\n  app:\n    image: {{dockerRegistry}}/{{systemName}}:{{deployVersion}}\n    container_name: {{systemName}}-app\n    restart: always\n    ports:\n      - \"8080:8080\"\n    environment:\n      - SPRING_PROFILES_ACTIVE={{profileActive}}\n      - DB_HOST={{dbHost}}\n      - DB_PORT=3306\n      - DB_NAME={{dbName}}\n      - DB_USER={{dbUser}}\n      - DB_PASSWORD={{dbPassword}}\n      - REDIS_HOST={{redisHost}}\n      - REDIS_PORT=6379\n      - REDIS_PASSWORD={{redisPassword}}\n    volumes:\n      - ./logs:/app/logs\n      - ./config:/app/config\n    networks:\n      - app-network\n    depends_on:\n      - mysql\n      - redis\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8080/actuator/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\nnetworks:\n  app-network:\n    driver: bridge\n```\n{{/eq}}\n\n{{#eq deploymentType \"äº‘åŸç”Ÿ\"}}\n#### Kuberneteséƒ¨ç½²é…ç½®\n\n```yaml\n# deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: {{systemName}}\n  namespace: {{k8sNamespace}}\nspec:\n  replicas: {{replicaCount}}\n  selector:\n    matchLabels:\n      app: {{systemName}}\n  template:\n    metadata:\n      labels:\n        app: {{systemName}}\n    spec:\n      containers:\n      - name: {{systemName}}\n        image: {{dockerRegistry}}/{{systemName}}:{{deployVersion}}\n        ports:\n        - containerPort: 8080\n        env:\n        - name: SPRING_PROFILES_ACTIVE\n          value: \"{{profileActive}}\"\n        - name: DB_HOST\n          valueFrom:\n            secretKeyRef:\n              name: {{systemName}}-secret\n              key: db-host\n        - name: DB_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: {{systemName}}-secret\n              key: db-password\n        resources:\n          requests:\n            memory: \"512Mi\"\n            cpu: \"500m\"\n          limits:\n            memory: \"2Gi\"\n            cpu: \"2000m\"\n        livenessProbe:\n          httpGet:\n            path: /actuator/health\n            port: 8080\n          initialDelaySeconds: 60\n          periodSeconds: 30\n        readinessProbe:\n          httpGet:\n            path: /actuator/health\n            port: 8080\n          initialDelaySeconds: 30\n          periodSeconds: 10\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: {{systemName}}-service\n  namespace: {{k8sNamespace}}\nspec:\n  type: LoadBalancer\n  ports:\n  - port: 80\n    targetPort: 8080\n  selector:\n    app: {{systemName}}\n```\n{{/eq}}\n\n### 5.3 å¯åŠ¨åº”ç”¨\n\n{{#eq deploymentType \"Docker\"}}\n```bash\n# å¯åŠ¨åº”ç”¨\ndocker-compose up -d\n\n# æŸ¥çœ‹æ—¥å¿—\ndocker-compose logs -f app\n\n# æ£€æŸ¥çŠ¶æ€\ndocker-compose ps\n\n# å¥åº·æ£€æŸ¥\ncurl http://localhost:8080/actuator/health\n```\n{{/eq}}\n\n{{#eq deploymentType \"äº‘åŸç”Ÿ\"}}\n```bash\n# åˆ›å»ºå‘½åç©ºé—´\nkubectl create namespace {{k8sNamespace}}\n\n# åˆ›å»ºSecret\nkubectl create secret generic {{systemName}}-secret \\\n  --from-literal=db-host={{dbHost}} \\\n  --from-literal=db-password={{dbPassword}} \\\n  -n {{k8sNamespace}}\n\n# éƒ¨ç½²åº”ç”¨\nkubectl apply -f deployment.yaml\n\n# æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€\nkubectl get pods -n {{k8sNamespace}}\nkubectl get svc -n {{k8sNamespace}}\n\n# æŸ¥çœ‹æ—¥å¿—\nkubectl logs -f deployment/{{systemName}} -n {{k8sNamespace}}\n\n# æ‰©å®¹\nkubectl scale deployment {{systemName}} --replicas={{replicaCount}} -n {{k8sNamespace}}\n```\n{{/eq}}\n\n---\n\n## 6. Nginxé…ç½®\n\n### 6.1 å®‰è£…Nginx\n\n```bash\nsudo apt install nginx -y\nsudo systemctl start nginx\nsudo systemctl enable nginx\n```\n\n### 6.2 é…ç½®åå‘ä»£ç†\n\n```bash\nsudo tee /etc/nginx/sites-available/{{systemName}} << 'EOF'\nupstream {{systemName}}_backend {\n    server 127.0.0.1:8080;\n    # å¦‚æœæœ‰å¤šä¸ªåº”ç”¨å®ä¾‹\n    # server 192.168.1.11:8080;\n    # server 192.168.1.12:8080;\n}\n\nserver {\n    listen 80;\n    server_name {{serverDomain}};\n    \n    # HTTPSé‡å®šå‘\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name {{serverDomain}};\n    \n    # SSLè¯ä¹¦\n    ssl_certificate /etc/nginx/ssl/{{serverDomain}}.crt;\n    ssl_certificate_key /etc/nginx/ssl/{{serverDomain}}.key;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    \n    # æ—¥å¿—\n    access_log /var/log/nginx/{{systemName}}_access.log;\n    error_log /var/log/nginx/{{systemName}}_error.log;\n    \n    # Gzipå‹ç¼©\n    gzip on;\n    gzip_types text/plain text/css application/json application/javascript;\n    \n    # é™æ€èµ„æº\n    location /static/ {\n        alias /opt/{{systemName}}/static/;\n        expires 30d;\n        add_header Cache-Control \"public, immutable\";\n    }\n    \n    # APIä»£ç†\n    location / {\n        proxy_pass http://{{systemName}}_backend;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        \n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n        \n        proxy_buffering off;\n        proxy_request_buffering off;\n    }\n}\nEOF\n\n# å¯ç”¨ç«™ç‚¹\nsudo ln -s /etc/nginx/sites-available/{{systemName}} /etc/nginx/sites-enabled/\n\n# æµ‹è¯•é…ç½®\nsudo nginx -t\n\n# é‡è½½Nginx\nsudo systemctl reload nginx\n```\n\n---\n\n## 7. ç›‘æ§ä¸å‘Šè­¦\n\n### 7.1 Prometheusç›‘æ§\n\n```yaml\n# prometheus.yml\nglobal:\n  scrape_interval: 15s\n\nscrape_configs:\n  - job_name: '{{systemName}}'\n    static_configs:\n      - targets: ['localhost:8080']\n    metrics_path: '/actuator/prometheus'\n```\n\n### 7.2 Grafana Dashboard\n\nå¯¼å…¥Dashboard ID: 4701 (JVM Micrometer)\n\n### 7.3 å‘Šè­¦è§„åˆ™\n\n```yaml\n# alert-rules.yml\ngroups:\n  - name: {{systemName}}_alerts\n    rules:\n      - alert: HighErrorRate\n        expr: rate(http_server_requests_total{status=~\"5..\"}[5m]) > 0.05\n        for: 5m\n        labels:\n          severity: critical\n        annotations:\n          summary: \"High error rate detected\"\n      \n      - alert: HighResponseTime\n        expr: histogram_quantile(0.95, http_server_requests_seconds) > 1\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: \"P95 response time > 1s\"\n```\n\n---\n\n## 8. æ—¥å¿—ç®¡ç†\n\n### 8.1 æ—¥å¿—é…ç½®\n\næ—¥å¿—è·¯å¾„: `/opt/{{systemName}}/logs/`\n\n- `app.log` - åº”ç”¨æ—¥å¿—\n- `error.log` - é”™è¯¯æ—¥å¿—\n- `access.log` - è®¿é—®æ—¥å¿—\n\n### 8.2 æ—¥å¿—è½®è½¬\n\n```bash\nsudo tee /etc/logrotate.d/{{systemName}} << 'EOF'\n/opt/{{systemName}}/logs/*.log {\n    daily\n    rotate 30\n    compress\n    delaycompress\n    missingok\n    notifempty\n    create 0644 {{appUser}} {{appUser}}\n    sharedscripts\n    postrotate\n        docker-compose -f /opt/{{systemName}}/docker-compose.yml restart app > /dev/null 2>&1 || true\n    endscript\n}\nEOF\n```\n\n---\n\n## 9. å¤‡ä»½ä¸æ¢å¤\n\n### 9.1 æ•°æ®åº“å¤‡ä»½\n\n```bash\n# åˆ›å»ºå¤‡ä»½è„šæœ¬\ncat > /opt/scripts/backup-db.sh << 'EOF'\n#!/bin/bash\nBACKUP_DIR=\"/data/backup/mysql\"\nDATE=$(date +%Y%m%d_%H%M%S)\n\nmkdir -p $BACKUP_DIR\n\ndocker exec mysql mysqldump \\\n  -u{{dbUser}} -p{{dbPassword}} \\\n  {{dbName}} > $BACKUP_DIR/{{dbName}}_$DATE.sql\n\n# å‹ç¼©å¤‡ä»½\ngzip $BACKUP_DIR/{{dbName}}_$DATE.sql\n\n# åˆ é™¤7å¤©å‰çš„å¤‡ä»½\nfind $BACKUP_DIR -name \"*.sql.gz\" -mtime +7 -delete\n\necho \"Backup completed: {{dbName}}_$DATE.sql.gz\"\nEOF\n\nchmod +x /opt/scripts/backup-db.sh\n\n# æ·»åŠ å®šæ—¶ä»»åŠ¡(æ¯å¤©2:00æ‰§è¡Œ)\ncrontab -e\n0 2 * * * /opt/scripts/backup-db.sh >> /var/log/backup.log 2>&1\n```\n\n### 9.2 æ•°æ®æ¢å¤\n\n```bash\n# è§£å‹å¤‡ä»½æ–‡ä»¶\ngunzip {{dbName}}_20240115_020000.sql.gz\n\n# æ¢å¤æ•°æ®åº“\ndocker exec -i mysql mysql -u{{dbUser}} -p{{dbPassword}} {{dbName}} < {{dbName}}_20240115_020000.sql\n```\n\n---\n\n## 10. å¸¸è§è¿ç»´æ“ä½œ\n\n### 10.1 åº”ç”¨æ›´æ–°\n\n```bash\n# 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬\ncp -r /opt/{{systemName}} /opt/{{systemName}}_backup_$(date +%Y%m%d)\n\n# 2. æ‹‰å–æ–°é•œåƒ\ndocker pull {{dockerRegistry}}/{{systemName}}:{{newVersion}}\n\n# 3. æ›´æ–°docker-compose.ymlä¸­çš„é•œåƒç‰ˆæœ¬\n\n# 4. æ»šåŠ¨æ›´æ–°\ndocker-compose up -d --no-deps --build app\n\n# 5. éªŒè¯æ–°ç‰ˆæœ¬\ncurl http://localhost:8080/actuator/info\n\n# 6. å¦‚æœæœ‰é—®é¢˜ï¼Œå›æ»š\n# docker-compose down\n# mv /opt/{{systemName}}_backup_$(date +%Y%m%d) /opt/{{systemName}}\n# docker-compose up -d\n```\n\n### 10.2 æ‰©å®¹\n\n```bash\n# å¢åŠ åº”ç”¨å®ä¾‹\ndocker-compose up -d --scale app=3\n\n# Kubernetesæ‰©å®¹\nkubectl scale deployment {{systemName}} --replicas=5 -n {{k8sNamespace}}\n```\n\n### 10.3 æ•…éšœæ’æŸ¥\n\n**åº”ç”¨æ— æ³•å¯åŠ¨**:\n```bash\n# æŸ¥çœ‹æ—¥å¿—\ndocker logs {{systemName}}-app\n\n# æ£€æŸ¥ç«¯å£å ç”¨\nsudo netstat -tulpn | grep 8080\n\n# æ£€æŸ¥èµ„æºä½¿ç”¨\ndocker stats {{systemName}}-app\n```\n\n**æ•°æ®åº“è¿æ¥å¤±è´¥**:\n```bash\n# æµ‹è¯•æ•°æ®åº“è¿æ¥\ndocker exec -it mysql mysql -u{{dbUser}} -p{{dbPassword}} -e \"SELECT 1\"\n\n# æ£€æŸ¥ç½‘ç»œ\ntelnet {{dbHost}} 3306\n```\n\n---\n\n## 11. å®‰å…¨åŠ å›º\n\n### 11.1 ç³»ç»ŸåŠ å›º\n\n- âœ… ç¦ç”¨root SSHç™»å½•\n- âœ… ä½¿ç”¨SSHå¯†é’¥è®¤è¯\n- âœ… é…ç½®é˜²ç«å¢™è§„åˆ™\n- âœ… å®šæœŸæ›´æ–°ç³»ç»Ÿè¡¥ä¸\n- âœ… æœ€å°æƒé™åŸåˆ™\n\n### 11.2 åº”ç”¨å®‰å…¨\n\n- âœ… HTTPSåŠ å¯†ä¼ è¾“\n- âœ… æ•°æ®åº“å¯†ç å¤æ‚åº¦\n- âœ… APIé™æµé˜²æŠ¤\n- âœ… SQLæ³¨å…¥é˜²æŠ¤\n- âœ… XSSé˜²æŠ¤\n\n---\n\n## 12. åº”æ€¥é¢„æ¡ˆ\n\n### 12.1 æœåŠ¡å®•æœº\n\n**å¤„ç†æ­¥éª¤**:\n1. æ£€æŸ¥åº”ç”¨çŠ¶æ€\n2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—\n3. å°è¯•é‡å¯æœåŠ¡\n4. åˆ‡æ¢å¤‡ç”¨èŠ‚ç‚¹\n5. é€šçŸ¥ç›¸å…³äººå‘˜\n6. è®°å½•æ•…éšœåŸå› \n\n### 12.2 æ•°æ®ä¸¢å¤±\n\n**å¤„ç†æ­¥éª¤**:\n1. åœæ­¢åº”ç”¨å†™å…¥\n2. è¯„ä¼°æ•°æ®ä¸¢å¤±èŒƒå›´\n3. ä»æœ€è¿‘å¤‡ä»½æ¢å¤\n4. éªŒè¯æ•°æ®å®Œæ•´æ€§\n5. æ¢å¤åº”ç”¨æœåŠ¡\n6. äº‹ååˆ†ææ”¹è¿›\n\n---\n\n## 13. è”ç³»ä¿¡æ¯\n\n**è¿ç»´å›¢é˜Ÿ**:\n- è´Ÿè´£äºº: {{#if opsOwner}}{{opsOwner}}{{else}}è¿ç»´ç»ç†{{/if}}\n- é‚®ç®±: {{#if opsEmail}}{{opsEmail}}{{else}}ops@example.com{{/if}}\n- ç”µè¯: {{#if opsPhone}}{{opsPhone}}{{else}}400-XXX-XXXX{{/if}}\n\n**ç´§æ€¥è”ç³»**:\n- 7x24å°æ—¶å€¼ç­: {{#if emergencyPhone}}{{emergencyPhone}}{{else}}138-XXXX-XXXX{{/if}}\n\n---\n\n**æ–‡æ¡£ç‰ˆæœ¬**: {{docVersion}}\n**æœ€åæ›´æ–°**: {{#if updateDate}}{{updateDate}}{{else}}{{currentDate}}{{/if}}",
  "variables_schema": [
    {
      "name": "systemName",
      "type": "text",
      "label": "ç³»ç»Ÿåç§°",
      "default": "example-system",
      "required": true,
      "description": "ç³»ç»Ÿçš„åç§°"
    },
    {
      "name": "docVersion",
      "type": "text",
      "label": "æ–‡æ¡£ç‰ˆæœ¬",
      "default": "v1.0.0",
      "required": true,
      "description": "æ–‡æ¡£ç‰ˆæœ¬å·"
    },
    {
      "name": "deploymentEnv",
      "type": "select",
      "label": "éƒ¨ç½²ç¯å¢ƒ",
      "default": "ç”Ÿäº§ç¯å¢ƒ",
      "required": true,
      "options": [
        {"value": "å¼€å‘ç¯å¢ƒ", "label": "å¼€å‘ç¯å¢ƒ"},
        {"value": "æµ‹è¯•ç¯å¢ƒ", "label": "æµ‹è¯•ç¯å¢ƒ"},
        {"value": "é¢„å‘ç¯å¢ƒ", "label": "é¢„å‘ç¯å¢ƒ"},
        {"value": "ç”Ÿäº§ç¯å¢ƒ", "label": "ç”Ÿäº§ç¯å¢ƒ"}
      ],
      "description": "ç›®æ ‡éƒ¨ç½²ç¯å¢ƒ"
    },
    {
      "name": "deploymentType",
      "type": "select",
      "label": "éƒ¨ç½²æ–¹å¼",
      "default": "Docker",
      "required": true,
      "options": [
        {"value": "Docker", "label": "Docker Compose"},
        {"value": "äº‘åŸç”Ÿ", "label": "Kubernetes"},
        {"value": "ä¼ ç»Ÿéƒ¨ç½²", "label": "ä¼ ç»Ÿéƒ¨ç½²"}
      ],
      "description": "åº”ç”¨éƒ¨ç½²æ–¹å¼"
    },
    {
      "name": "techStack",
      "type": "select",
      "label": "æŠ€æœ¯æ ˆ",
      "default": "Java",
      "required": true,
      "options": [
        {"value": "Java", "label": "Java/Spring Boot"},
        {"value": "Node.js", "label": "Node.js"},
        {"value": "Python", "label": "Python"},
        {"value": "Go", "label": "Go"}
      ],
      "description": "åº”ç”¨ä½¿ç”¨çš„æŠ€æœ¯æ ˆ"
    },
    {
      "name": "serverOS",
      "type": "select",
      "label": "æœåŠ¡å™¨ç³»ç»Ÿ",
      "default": "Linux",
      "required": true,
      "options": [
        {"value": "Linux", "label": "Linux"},
        {"value": "Windows", "label": "Windows Server"}
      ],
      "description": "æœåŠ¡å™¨æ“ä½œç³»ç»Ÿ"
    },
    {
      "name": "database",
      "type": "select",
      "label": "æ•°æ®åº“",
      "default": "MySQL",
      "required": true,
      "options": [
        {"value": "MySQL", "label": "MySQL"},
        {"value": "PostgreSQL", "label": "PostgreSQL"},
        {"value": "MongoDB", "label": "MongoDB"}
      ],
      "description": "ä½¿ç”¨çš„æ•°æ®åº“"
    },
    {
      "name": "dbName",
      "type": "text",
      "label": "æ•°æ®åº“å",
      "default": "app_db",
      "required": true,
      "description": "åº”ç”¨æ•°æ®åº“åç§°"
    },
    {
      "name": "dbUser",
      "type": "text",
      "label": "æ•°æ®åº“ç”¨æˆ·",
      "default": "app_user",
      "required": true,
      "description": "æ•°æ®åº“ç”¨æˆ·å"
    },
    {
      "name": "serverDomain",
      "type": "text",
      "label": "æœåŠ¡å™¨åŸŸå",
      "default": "api.example.com",
      "required": false,
      "description": "æœåŠ¡å™¨åŸŸåæˆ–IP"
    },
    {
      "name": "deployVersion",
      "type": "text",
      "label": "éƒ¨ç½²ç‰ˆæœ¬",
      "default": "v1.0.0",
      "required": false,
      "description": "è¦éƒ¨ç½²çš„ç‰ˆæœ¬å·"
    },
    {
      "name": "opsOwner",
      "type": "text",
      "label": "è¿ç»´è´Ÿè´£äºº",
      "default": "",
      "required": false,
      "description": "è¿ç»´è´Ÿè´£äººå§“åï¼ˆå¯é€‰ï¼‰"
    },
    {
      "name": "opsEmail",
      "type": "text",
      "label": "è¿ç»´é‚®ç®±",
      "default": "",
      "required": false,
      "description": "è¿ç»´å›¢é˜Ÿé‚®ç®±ï¼ˆå¯é€‰ï¼‰"
    },
    {
      "name": "updateDate",
      "type": "text",
      "label": "æ›´æ–°æ—¥æœŸ",
      "default": "",
      "required": false,
      "description": "æ–‡æ¡£æœ€åæ›´æ–°æ—¥æœŸï¼ˆå¯é€‰ï¼‰"
    }
  ],
  "file_structure": {
    "type": "folder",
    "name": "{{systemName}}_éƒ¨ç½²æ–‡æ¡£",
    "children": [
      {"type": "file", "name": "éƒ¨ç½²æ–‡æ¡£.md", "description": "éƒ¨ç½²æ–‡æ¡£ä¸»æ–‡ä»¶"},
      {
        "type": "folder",
        "name": "scripts",
        "children": [
          {"type": "file", "name": "deploy.sh", "description": "éƒ¨ç½²è„šæœ¬"},
          {"type": "file", "name": "backup-db.sh", "description": "æ•°æ®åº“å¤‡ä»½è„šæœ¬"},
          {"type": "file", "name": "health-check.sh", "description": "å¥åº·æ£€æŸ¥è„šæœ¬"}
        ]
      },
      {
        "type": "folder",
        "name": "config",
        "children": [
          {"type": "file", "name": "docker-compose.yml", "description": "Docker Composeé…ç½®"},
          {"type": "file", "name": "nginx.conf", "description": "Nginxé…ç½®"},
          {"type": "file", "name": "prometheus.yml", "description": "Prometheusé…ç½®"}
        ]
      },
      {"type": "file", "name": "åº”æ€¥é¢„æ¡ˆ.md", "description": "åº”æ€¥å¤„ç†é¢„æ¡ˆ"}
    ]
  },
  "is_builtin": true,
  "author": "ChainlessChain Team",
  "version": "1.0.0",
  "usage_count": 0,
  "rating": 0,
  "rating_count": 0,
  "created_at": "2024-01-15T10:00:00Z",
  "updated_at": "2024-01-15T10:00:00Z"
}
