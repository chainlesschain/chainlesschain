{
  "id": "tpl_ds_timeseries_007",
  "name": "time_series_analysis",
  "display_name": "æ—¶é—´åºåˆ—åˆ†æ",
  "description": "æ—¶é—´åºåˆ—æ•°æ®åˆ†æä¸é¢„æµ‹ï¼ŒåŒ…å«è¶‹åŠ¿åˆ†è§£ã€ARIMAã€Prophet ç­‰æ–¹æ³•",
  "icon": "ğŸ“ˆ",
  "category": "data-science",
  "subcategory": "analysis",
  "tags": [
    "æ—¶é—´åºåˆ—",
    "é¢„æµ‹",
    "ARIMA",
    "Prophet",
    "è¶‹åŠ¿åˆ†æ"
  ],
  "project_type": "code",
  "prompt_template": "æ—¶é—´åºåˆ—åˆ†æé¡¹ç›®\n\n**é¡¹ç›®ä¿¡æ¯ï¼š**\n- é¡¹ç›®åç§°ï¼š{{projectName}}\n- æ•°æ®ç±»å‹ï¼š{{dataType}}\n- é¢„æµ‹ç›®æ ‡ï¼š{{forecastTarget}}\n- æ—¶é—´ç²’åº¦ï¼š{{timeGranularity}}\n\n# æ—¶é—´åºåˆ—åˆ†æå®Œæ•´æµç¨‹\n\n## 1. é¡¹ç›®è®¾ç½®\n\n### 1.1 ç¯å¢ƒé…ç½®\n\n```python\n# requirements.txt\npandas>=2.0.0\nnumpy>=1.24.0\nmatplotlib>=3.7.0\nseaborn>=0.12.0\nstatsmodels>=0.14.0\nscikit-learn>=1.3.0\nprophet>=1.1.0  # Facebook Prophet\npmdarima>=2.0.0  # Auto ARIMA\nplotly>=5.14.0\nscipy>=1.10.0\n```\n\n```bash\npip install -r requirements.txt\n```\n\n### 1.2 å¯¼å…¥åº“\n\n```python\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom datetime import datetime, timedelta\nimport warnings\nwarnings.filterwarnings('ignore')\n\n# æ—¶é—´åºåˆ—åˆ†æ\nfrom statsmodels.tsa.seasonal import seasonal_decompose\nfrom statsmodels.tsa.stattools import adfuller, kpss\nfrom statsmodels.tsa.arima.model import ARIMA\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\nfrom statsmodels.tsa.statespace.sarimax import SARIMAX\n\n# Prophet\nfrom prophet import Prophet\n\n# Auto ARIMA\nfrom pmdarima import auto_arima\n\n# æœºå™¨å­¦ä¹ \nfrom sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score\nfrom sklearn.preprocessing import StandardScaler\n\n# å¯è§†åŒ–\nimport plotly.graph_objects as go\nimport plotly.express as px\n\n# è®¾ç½®æ ·å¼\nplt.style.use('seaborn-v0_8')\nsns.set_palette(\"husl\")\n```\n\n---\n\n## 2. æ•°æ®åŠ è½½ä¸æ¢ç´¢\n\n### 2.1 æ•°æ®åŠ è½½\n\n```python\n# è¯»å–æ•°æ®\ndf = pd.read_csv('{{dataFile}}')\n\n# è½¬æ¢æ—¥æœŸåˆ—\ndf['{{dateColumn}}'] = pd.to_datetime(df['{{dateColumn}}'])\n\n# è®¾ç½®æ—¥æœŸä¸ºç´¢å¼•\ndf.set_index('{{dateColumn}}', inplace=True)\n\n# æŒ‰æ—¶é—´æ’åº\ndf.sort_index(inplace=True)\n\nprint(f\"æ•°æ®å½¢çŠ¶: {df.shape}\")\nprint(f\"æ—¶é—´èŒƒå›´: {df.index.min()} åˆ° {df.index.max()}\")\nprint(f\"æ€»å¤©æ•°: {(df.index.max() - df.index.min()).days}å¤©\")\n\ndf.head()\n```\n\n### 2.2 åŸºç¡€ç»Ÿè®¡\n\n```python\n# ç›®æ ‡å˜é‡ç»Ÿè®¡\ntarget = '{{targetColumn}}'\n\nprint(\"=\"*50)\nprint(\"åŸºç¡€ç»Ÿè®¡ä¿¡æ¯\")\nprint(\"=\"*50)\nprint(df[target].describe())\nprint(f\"\\nç¼ºå¤±å€¼: {df[target].isna().sum()}\")\nprint(f\"ç¼ºå¤±ç‡: {df[target].isna().sum() / len(df) * 100:.2f}%\")\n```\n\n### 2.3 æ•°æ®å¯è§†åŒ–\n\n```python\n# åŸå§‹æ—¶é—´åºåˆ—\nfig, axes = plt.subplots(2, 1, figsize=(15, 10))\n\n# æŠ˜çº¿å›¾\naxes[0].plot(df.index, df[target], linewidth=1)\naxes[0].set_title(f'{target} æ—¶é—´åºåˆ—', fontsize=14, fontweight='bold')\naxes[0].set_xlabel('æ—¥æœŸ')\naxes[0].set_ylabel(target)\naxes[0].grid(True, alpha=0.3)\n\n# åˆ†å¸ƒå›¾\naxes[1].hist(df[target], bins=50, edgecolor='black', alpha=0.7)\naxes[1].set_title(f'{target} åˆ†å¸ƒ', fontsize=14, fontweight='bold')\naxes[1].set_xlabel(target)\naxes[1].set_ylabel('é¢‘æ•°')\naxes[1].grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n```\n\n---\n\n## 3. æ•°æ®é¢„å¤„ç†\n\n### 3.1 ç¼ºå¤±å€¼å¤„ç†\n\n```python\n# æ£€æŸ¥ç¼ºå¤±å€¼æ¨¡å¼\nprint(\"ç¼ºå¤±å€¼åˆ†æ:\")\nprint(df[target].isna().sum())\n\n{{#eq missingMethod \"forward_fill\"}}\n# å‰å‘å¡«å……\ndf[target].fillna(method='ffill', inplace=True)\n{{/eq}}\n\n{{#eq missingMethod \"interpolate\"}}\n# çº¿æ€§æ’å€¼\ndf[target].interpolate(method='linear', inplace=True)\n{{/eq}}\n\n{{#eq missingMethod \"mean\"}}\n# å‡å€¼å¡«å……\ndf[target].fillna(df[target].mean(), inplace=True)\n{{/eq}}\n\nprint(f\"\\nå¤„ç†åç¼ºå¤±å€¼: {df[target].isna().sum()}\")\n```\n\n### 3.2 å¼‚å¸¸å€¼æ£€æµ‹\n\n```python\ndef detect_outliers_iqr(data, column, threshold=1.5):\n    \"\"\"\n    ä½¿ç”¨IQRæ–¹æ³•æ£€æµ‹å¼‚å¸¸å€¼\n    \"\"\"\n    Q1 = data[column].quantile(0.25)\n    Q3 = data[column].quantile(0.75)\n    IQR = Q3 - Q1\n    \n    lower_bound = Q1 - threshold * IQR\n    upper_bound = Q3 + threshold * IQR\n    \n    outliers = data[(data[column] < lower_bound) | (data[column] > upper_bound)]\n    \n    return outliers, lower_bound, upper_bound\n\n# æ£€æµ‹å¼‚å¸¸å€¼\noutliers, lower, upper = detect_outliers_iqr(df, target)\nprint(f\"æ£€æµ‹åˆ° {len(outliers)} ä¸ªå¼‚å¸¸å€¼\")\nprint(f\"æ­£å¸¸èŒƒå›´: [{lower:.2f}, {upper:.2f}]\")\n\n{{#eq outlierTreatment \"remove\"}}\n# ç§»é™¤å¼‚å¸¸å€¼\ndf = df[(df[target] >= lower) & (df[target] <= upper)]\nprint(f\"ç§»é™¤åæ•°æ®é‡: {len(df)}\")\n{{/eq}}\n\n{{#eq outlierTreatment \"cap\"}}\n# é™åˆ¶å¼‚å¸¸å€¼\ndf[target] = df[target].clip(lower=lower, upper=upper)\nprint(\"å¼‚å¸¸å€¼å·²é™åˆ¶åœ¨æ­£å¸¸èŒƒå›´å†…\")\n{{/eq}}\n```\n\n### 3.3 é‡é‡‡æ ·\n\n{{#eq timeGranularity \"daily\"}}\n```python\n# ç¡®ä¿æ¯æ—¥æ•°æ®å®Œæ•´\ndf = df.resample('D').mean()\ndf[target].interpolate(method='linear', inplace=True)\n```\n{{/eq}}\n\n{{#eq timeGranularity \"weekly\"}}\n```python\n# è½¬æ¢ä¸ºå‘¨æ•°æ®\ndf_weekly = df.resample('W').mean()\nprint(f\"å‘¨æ•°æ®ç‚¹æ•°: {len(df_weekly)}\")\ndf = df_weekly\n```\n{{/eq}}\n\n{{#eq timeGranularity \"monthly\"}}\n```python\n# è½¬æ¢ä¸ºæœˆæ•°æ®\ndf_monthly = df.resample('M').mean()\nprint(f\"æœˆæ•°æ®ç‚¹æ•°: {len(df_monthly)}\")\ndf = df_monthly\n```\n{{/eq}}\n\n---\n\n## 4. æ—¶é—´åºåˆ—åˆ†è§£\n\n### 4.1 åŠ æ³•åˆ†è§£\n\n```python\n# å­£èŠ‚æ€§åˆ†è§£\ndecomposition = seasonal_decompose(\n    df[target], \n    model='{{decompositionModel}}',  # 'additive' æˆ– 'multiplicative'\n    period={{seasonalPeriod}}  # å­£èŠ‚æ€§å‘¨æœŸ\n)\n\n# å¯è§†åŒ–åˆ†è§£ç»“æœ\nfig, axes = plt.subplots(4, 1, figsize=(15, 12))\n\ndecomposition.observed.plot(ax=axes[0], title='åŸå§‹åºåˆ—')\ndecomposition.trend.plot(ax=axes[1], title='è¶‹åŠ¿')\ndecomposition.seasonal.plot(ax=axes[2], title='å­£èŠ‚æ€§')\ndecomposition.resid.plot(ax=axes[3], title='æ®‹å·®')\n\nfor ax in axes:\n    ax.grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n\n# æå–å„ç»„ä»¶\ntrend = decomposition.trend\nseasonal = decomposition.seasonal\nresidual = decomposition.resid\n\n# è®¡ç®—å„ç»„ä»¶è´¡çŒ®\ntrend_strength = 1 - (residual.var() / (trend + residual).var())\nseasonal_strength = 1 - (residual.var() / (seasonal + residual).var())\n\nprint(f\"è¶‹åŠ¿å¼ºåº¦: {trend_strength:.4f}\")\nprint(f\"å­£èŠ‚æ€§å¼ºåº¦: {seasonal_strength:.4f}\")\n```\n\n---\n\n## 5. å¹³ç¨³æ€§æ£€éªŒ\n\n### 5.1 ADF æ£€éªŒ\n\n```python\ndef adf_test(series, name=''):\n    \"\"\"\n    å¢å¼ºè¿ªåŸº-å¯Œå‹’æ£€éªŒ (Augmented Dickey-Fuller Test)\n    H0: åºåˆ—éå¹³ç¨³\n    \"\"\"\n    result = adfuller(series.dropna())\n    \n    print(f'\\n{name} ADF æ£€éªŒç»“æœ:')\n    print('='*50)\n    print(f'ADFç»Ÿè®¡é‡: {result[0]:.6f}')\n    print(f'på€¼: {result[1]:.6f}')\n    print(f'æ»åé˜¶æ•°: {result[2]}')\n    print(f'è§‚æµ‹æ•°: {result[3]}')\n    print('ä¸´ç•Œå€¼:')\n    for key, value in result[4].items():\n        print(f'  {key}: {value:.3f}')\n    \n    if result[1] <= 0.05:\n        print(\"\\nç»“è®º: æ‹’ç»åŸå‡è®¾ï¼Œåºåˆ—å¹³ç¨³ âœ“\")\n        return True\n    else:\n        print(\"\\nç»“è®º: ä¸èƒ½æ‹’ç»åŸå‡è®¾ï¼Œåºåˆ—éå¹³ç¨³ âœ—\")\n        return False\n\n# åŸå§‹åºåˆ—æ£€éªŒ\nis_stationary = adf_test(df[target], 'åŸå§‹åºåˆ—')\n```\n\n### 5.2 å·®åˆ†å¤„ç†\n\n```python\nif not is_stationary:\n    # ä¸€é˜¶å·®åˆ†\n    df['diff1'] = df[target].diff()\n    adf_test(df['diff1'], 'ä¸€é˜¶å·®åˆ†')\n    \n    # äºŒé˜¶å·®åˆ†ï¼ˆå¦‚æœéœ€è¦ï¼‰\n    df['diff2'] = df['diff1'].diff()\n    adf_test(df['diff2'], 'äºŒé˜¶å·®åˆ†')\n    \n    # å­£èŠ‚æ€§å·®åˆ†\n    df['seasonal_diff'] = df[target].diff({{seasonalPeriod}})\n    adf_test(df['seasonal_diff'], f'{{{seasonalPeriod}}}æœŸå­£èŠ‚æ€§å·®åˆ†')\n```\n\n---\n\n## 6. ACF å’Œ PACF åˆ†æ\n\n### 6.1 è‡ªç›¸å…³åˆ†æ\n\n```python\nfig, axes = plt.subplots(2, 1, figsize=(15, 8))\n\n# ACF å›¾\nplot_acf(df[target].dropna(), lags=40, ax=axes[0])\naxes[0].set_title('è‡ªç›¸å…³å‡½æ•° (ACF)', fontsize=14, fontweight='bold')\n\n# PACF å›¾\nplot_pacf(df[target].dropna(), lags=40, ax=axes[1])\naxes[1].set_title('åè‡ªç›¸å…³å‡½æ•° (PACF)', fontsize=14, fontweight='bold')\n\nplt.tight_layout()\nplt.show()\n```\n\n---\n\n## 7. æ¨¡å‹æ„å»º\n\n### 7.1 æ•°æ®é›†åˆ’åˆ†\n\n```python\n# è®­ç»ƒé›†/æµ‹è¯•é›†åˆ†å‰²\ntrain_size = int(len(df) * {{trainRatio}})\ntrain = df[:train_size]\ntest = df[train_size:]\n\nprint(f\"è®­ç»ƒé›†: {len(train)} ä¸ªæ ·æœ¬ ({train.index.min()} åˆ° {train.index.max()})\")\nprint(f\"æµ‹è¯•é›†: {len(test)} ä¸ªæ ·æœ¬ ({test.index.min()} åˆ° {test.index.max()})\")\n\n# å¯è§†åŒ–åˆ†å‰²\nplt.figure(figsize=(15, 5))\nplt.plot(train.index, train[target], label='è®­ç»ƒé›†', color='blue')\nplt.plot(test.index, test[target], label='æµ‹è¯•é›†', color='orange')\nplt.axvline(x=train.index[-1], color='red', linestyle='--', label='åˆ†å‰²ç‚¹')\nplt.title('è®­ç»ƒé›†/æµ‹è¯•é›†åˆ’åˆ†')\nplt.xlabel('æ—¥æœŸ')\nplt.ylabel(target)\nplt.legend()\nplt.grid(True, alpha=0.3)\nplt.show()\n```\n\n### 7.2 æ–¹æ³•1ï¼šARIMA æ¨¡å‹\n\n```python\n# Auto ARIMA è‡ªåŠ¨é€‰æ‹©å‚æ•°\nauto_model = auto_arima(\n    train[target],\n    start_p=0, start_q=0,\n    max_p=5, max_q=5,\n    seasonal=True,\n    m={{seasonalPeriod}},  # å­£èŠ‚æ€§å‘¨æœŸ\n    d=None,  # è‡ªåŠ¨ç¡®å®šå·®åˆ†é˜¶æ•°\n    trace=True,\n    error_action='ignore',\n    suppress_warnings=True,\n    stepwise=True\n)\n\nprint(\"\\næœ€ä¼˜æ¨¡å‹:\")\nprint(auto_model.summary())\n\n# è·å–æœ€ä¼˜å‚æ•°\norder = auto_model.order\nseasonal_order = auto_model.seasonal_order\n\nprint(f\"\\nARIMAå‚æ•°: {order}\")\nprint(f\"å­£èŠ‚æ€§å‚æ•°: {seasonal_order}\")\n\n# æ‹Ÿåˆ SARIMA æ¨¡å‹\nsarima_model = SARIMAX(\n    train[target],\n    order=order,\n    seasonal_order=seasonal_order\n)\n\nsarima_fit = sarima_model.fit(disp=False)\nprint(\"\\nSARIMAæ¨¡å‹è®­ç»ƒå®Œæˆ\")\n```\n\n### 7.3 æ–¹æ³•2ï¼šProphet æ¨¡å‹\n\n```python\n# å‡†å¤‡ Prophet æ•°æ®æ ¼å¼\ntrain_prophet = train.reset_index()\ntrain_prophet.columns = ['ds', 'y']\n\n# åˆå§‹åŒ– Prophet\nprophet_model = Prophet(\n    yearly_seasonality=True,\n    weekly_seasonality={{weeklySeasonality}},\n    daily_seasonality=False,\n    seasonality_mode='{{seasonalityMode}}',  # 'additive' æˆ– 'multiplicative'\n    changepoint_prior_scale=0.05\n)\n\n{{#if hasHoliday}}\n# æ·»åŠ èŠ‚å‡æ—¥æ•ˆåº”\nholidays = pd.DataFrame({\n    'holiday': '{{holidayName}}',\n    'ds': pd.to_datetime([{{holidayDates}}]),\n    'lower_window': 0,\n    'upper_window': 1,\n})\nprophet_model.add_country_holidays(country_name='CN')\n{{/if}}\n\n# è®­ç»ƒæ¨¡å‹\nprophet_model.fit(train_prophet)\nprint(\"Prophetæ¨¡å‹è®­ç»ƒå®Œæˆ\")\n```\n\n---\n\n## 8. æ¨¡å‹é¢„æµ‹\n\n### 8.1 SARIMA é¢„æµ‹\n\n```python\n# é¢„æµ‹\nforecast_steps = len(test)\nsarima_forecast = sarima_fit.forecast(steps=forecast_steps)\n\n# è·å–ç½®ä¿¡åŒºé—´\nforecast_result = sarima_fit.get_forecast(steps=forecast_steps)\nforecast_ci = forecast_result.conf_int()\n\nprint(f\"SARIMAé¢„æµ‹å®Œæˆ: {forecast_steps} æ­¥\")\n```\n\n### 8.2 Prophet é¢„æµ‹\n\n```python\n# åˆ›å»ºæœªæ¥æ—¶é—´æ¡†æ¶\nfuture = prophet_model.make_future_dataframe(periods=forecast_steps, freq='{{frequency}}')\n\n# é¢„æµ‹\nprophet_forecast = prophet_model.predict(future)\n\n# æå–æµ‹è¯•é›†é¢„æµ‹å€¼\nprophet_test_pred = prophet_forecast.iloc[-forecast_steps:]\n\nprint(f\"Propheté¢„æµ‹å®Œæˆ: {forecast_steps} æ­¥\")\n```\n\n---\n\n## 9. æ¨¡å‹è¯„ä¼°\n\n### 9.1 è¯„ä¼°æŒ‡æ ‡\n\n```python\ndef evaluate_forecast(actual, predicted, model_name):\n    \"\"\"\n    è®¡ç®—é¢„æµ‹è¯„ä¼°æŒ‡æ ‡\n    \"\"\"\n    mae = mean_absolute_error(actual, predicted)\n    rmse = np.sqrt(mean_squared_error(actual, predicted))\n    mape = np.mean(np.abs((actual - predicted) / actual)) * 100\n    r2 = r2_score(actual, predicted)\n    \n    print(f\"\\n{model_name} è¯„ä¼°ç»“æœ:\")\n    print(\"=\"*50)\n    print(f\"MAE (å¹³å‡ç»å¯¹è¯¯å·®): {mae:.4f}\")\n    print(f\"RMSE (å‡æ–¹æ ¹è¯¯å·®): {rmse:.4f}\")\n    print(f\"MAPE (å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®): {mape:.2f}%\")\n    print(f\"RÂ² (å†³å®šç³»æ•°): {r2:.4f}\")\n    \n    return {'MAE': mae, 'RMSE': rmse, 'MAPE': mape, 'R2': r2}\n\n# è¯„ä¼° SARIMA\nsarima_metrics = evaluate_forecast(test[target], sarima_forecast, 'SARIMA')\n\n# è¯„ä¼° Prophet\nprophet_metrics = evaluate_forecast(\n    test[target], \n    prophet_test_pred['yhat'].values, \n    'Prophet'\n)\n\n# æ¯”è¾ƒæ¨¡å‹\ncomparison = pd.DataFrame([sarima_metrics, prophet_metrics], \n                          index=['SARIMA', 'Prophet'])\nprint(\"\\næ¨¡å‹å¯¹æ¯”:\")\nprint(comparison)\n```\n\n### 9.2 æ®‹å·®åˆ†æ\n\n```python\n# SARIMA æ®‹å·®\nresiduals = sarima_fit.resid\n\nfig, axes = plt.subplots(2, 2, figsize=(15, 10))\n\n# æ®‹å·®æ—¶é—´åºåˆ—\naxes[0, 0].plot(residuals)\naxes[0, 0].set_title('æ®‹å·®åºåˆ—')\naxes[0, 0].axhline(y=0, color='r', linestyle='--')\naxes[0, 0].grid(True, alpha=0.3)\n\n# æ®‹å·®åˆ†å¸ƒ\naxes[0, 1].hist(residuals, bins=30, edgecolor='black')\naxes[0, 1].set_title('æ®‹å·®åˆ†å¸ƒ')\naxes[0, 1].grid(True, alpha=0.3)\n\n# æ®‹å·® ACF\nplot_acf(residuals, lags=40, ax=axes[1, 0])\naxes[1, 0].set_title('æ®‹å·® ACF')\n\n# Q-Q å›¾\nfrom scipy import stats\nstats.probplot(residuals, dist=\"norm\", plot=axes[1, 1])\naxes[1, 1].set_title('Q-Q å›¾')\naxes[1, 1].grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n\n# Ljung-Box æ£€éªŒ\nfrom statsmodels.stats.diagnostic import acorr_ljungbox\nlb_test = acorr_ljungbox(residuals, lags=[10], return_df=True)\nprint(\"\\nLjung-Box æ£€éªŒ:\")\nprint(lb_test)\n```\n\n---\n\n## 10. å¯è§†åŒ–ç»“æœ\n\n### 10.1 é¢„æµ‹å¯¹æ¯”å›¾\n\n```python\nfig = go.Figure()\n\n# è®­ç»ƒé›†\nfig.add_trace(go.Scatter(\n    x=train.index,\n    y=train[target],\n    mode='lines',\n    name='è®­ç»ƒé›†',\n    line=dict(color='blue', width=1)\n))\n\n# æµ‹è¯•é›†ï¼ˆå®é™…å€¼ï¼‰\nfig.add_trace(go.Scatter(\n    x=test.index,\n    y=test[target],\n    mode='lines',\n    name='å®é™…å€¼',\n    line=dict(color='green', width=2)\n))\n\n# SARIMA é¢„æµ‹\nfig.add_trace(go.Scatter(\n    x=test.index,\n    y=sarima_forecast,\n    mode='lines',\n    name='SARIMAé¢„æµ‹',\n    line=dict(color='red', width=2, dash='dash')\n))\n\n# Prophet é¢„æµ‹\nfig.add_trace(go.Scatter(\n    x=test.index,\n    y=prophet_test_pred['yhat'].values,\n    mode='lines',\n    name='Propheté¢„æµ‹',\n    line=dict(color='orange', width=2, dash='dot')\n))\n\n# ç½®ä¿¡åŒºé—´\nfig.add_trace(go.Scatter(\n    x=test.index,\n    y=forecast_ci.iloc[:, 0],\n    fill=None,\n    mode='lines',\n    line_color='rgba(255,0,0,0)',\n    showlegend=False\n))\n\nfig.add_trace(go.Scatter(\n    x=test.index,\n    y=forecast_ci.iloc[:, 1],\n    fill='tonexty',\n    mode='lines',\n    line_color='rgba(255,0,0,0)',\n    name='95% ç½®ä¿¡åŒºé—´'\n))\n\nfig.update_layout(\n    title='æ—¶é—´åºåˆ—é¢„æµ‹ç»“æœå¯¹æ¯”',\n    xaxis_title='æ—¥æœŸ',\n    yaxis_title=target,\n    height=600,\n    hovermode='x unified'\n)\n\nfig.show()\n```\n\n### 10.2 Prophet ç»„ä»¶åˆ†è§£\n\n```python\n# Prophet ç»„ä»¶å›¾\nfig = prophet_model.plot_components(prophet_forecast)\nplt.show()\n```\n\n---\n\n## 11. æœªæ¥é¢„æµ‹\n\n### 11.1 é•¿æœŸé¢„æµ‹\n\n```python\n# é¢„æµ‹æœªæ¥ {{futurePeriods}} æœŸ\nfuture_periods = {{futurePeriods}}\n\n# SARIMA æœªæ¥é¢„æµ‹\nfull_model = SARIMAX(df[target], order=order, seasonal_order=seasonal_order)\nfull_fit = full_model.fit(disp=False)\nfuture_forecast = full_fit.forecast(steps=future_periods)\n\n# Prophet æœªæ¥é¢„æµ‹\nfuture_dates = prophet_model.make_future_dataframe(periods=future_periods, freq='{{frequency}}')\nfuture_prophet = prophet_model.predict(future_dates)\n\n# å¯è§†åŒ–æœªæ¥é¢„æµ‹\nfig, ax = plt.subplots(figsize=(15, 6))\n\n# å†å²æ•°æ®\nax.plot(df.index, df[target], label='å†å²æ•°æ®', color='blue', linewidth=1.5)\n\n# æœªæ¥é¢„æµ‹\nfuture_index = pd.date_range(start=df.index[-1], periods=future_periods+1, freq='{{frequency}}')[1:]\nax.plot(future_index, future_forecast, label='SARIMAæœªæ¥é¢„æµ‹', \n        color='red', linewidth=2, linestyle='--')\n\nax.plot(future_index, future_prophet.iloc[-future_periods:]['yhat'].values, \n        label='Prophetæœªæ¥é¢„æµ‹', color='orange', linewidth=2, linestyle=':')\n\nax.axvline(x=df.index[-1], color='green', linestyle='--', alpha=0.7, label='é¢„æµ‹èµ·ç‚¹')\nax.set_title(f'æœªæ¥ {future_periods} æœŸé¢„æµ‹', fontsize=14, fontweight='bold')\nax.set_xlabel('æ—¥æœŸ')\nax.set_ylabel(target)\nax.legend()\nax.grid(True, alpha=0.3)\nplt.tight_layout()\nplt.show()\n\nprint(\"\\næœªæ¥é¢„æµ‹å€¼:\")\nfuture_df = pd.DataFrame({\n    'æ—¥æœŸ': future_index,\n    'SARIMAé¢„æµ‹': future_forecast.values,\n    'Propheté¢„æµ‹': future_prophet.iloc[-future_periods:]['yhat'].values\n})\nprint(future_df)\n```\n\n---\n\n## 12. æ¨¡å‹ä¿å­˜\n\n```python\nimport pickle\n\n# ä¿å­˜ SARIMA æ¨¡å‹\nwith open('sarima_model.pkl', 'wb') as f:\n    pickle.dump(sarima_fit, f)\n\n# ä¿å­˜ Prophet æ¨¡å‹\nwith open('prophet_model.pkl', 'wb') as f:\n    pickle.dump(prophet_model, f)\n\nprint(\"æ¨¡å‹å·²ä¿å­˜\")\n\n# åŠ è½½æ¨¡å‹ç¤ºä¾‹\n# with open('sarima_model.pkl', 'rb') as f:\n#     loaded_model = pickle.load(f)\n```\n\n---\n\n## 13. æ€»ç»“æŠ¥å‘Š\n\n```python\nreport = f\"\"\"\næ—¶é—´åºåˆ—åˆ†ææŠ¥å‘Š\n{'='*60}\n\né¡¹ç›®åç§°: {{projectName}}\næ•°æ®ç±»å‹: {{dataType}}\næ—¶é—´èŒƒå›´: {df.index.min()} åˆ° {df.index.max()}\næ•°æ®ç‚¹æ•°: {len(df)}\n\næ•°æ®ç‰¹å¾:\n- å¹³ç¨³æ€§: {'å¹³ç¨³' if is_stationary else 'éå¹³ç¨³'}\n- è¶‹åŠ¿å¼ºåº¦: {trend_strength:.4f}\n- å­£èŠ‚æ€§å¼ºåº¦: {seasonal_strength:.4f}\n- å­£èŠ‚æ€§å‘¨æœŸ: {{seasonalPeriod}}\n\næ¨¡å‹æ€§èƒ½:\n1. SARIMA {order}x{seasonal_order}\n   - RMSE: {sarima_metrics['RMSE']:.4f}\n   - MAPE: {sarima_metrics['MAPE']:.2f}%\n   - RÂ²: {sarima_metrics['R2']:.4f}\n\n2. Prophet\n   - RMSE: {prophet_metrics['RMSE']:.4f}\n   - MAPE: {prophet_metrics['MAPE']:.2f}%\n   - RÂ²: {prophet_metrics['R2']:.4f}\n\næœ€ä½³æ¨¡å‹: {'SARIMA' if sarima_metrics['RMSE'] < prophet_metrics['RMSE'] else 'Prophet'}\n\næœªæ¥é¢„æµ‹: {future_periods} æœŸ\n\"\"\"\n\nprint(report)\n\n# ä¿å­˜æŠ¥å‘Š\nwith open('time_series_report.txt', 'w', encoding='utf-8') as f:\n    f.write(report)\n```\n\n---\n\n## é™„å½•\n\n### A. å¸¸ç”¨é¢‘ç‡ä»£ç \n\n- 'D': æ—¥\n- 'W': å‘¨\n- 'M': æœˆæœ«\n- 'MS': æœˆåˆ\n- 'Q': å­£åº¦æœ«\n- 'Y': å¹´æœ«\n- 'H': å°æ—¶\n- 'T' æˆ– 'min': åˆ†é’Ÿ\n\n### B. ARIMA å‚æ•°è¯´æ˜\n\n- **p**: AR (è‡ªå›å½’) é¡¹æ•°\n- **d**: å·®åˆ†æ¬¡æ•°\n- **q**: MA (ç§»åŠ¨å¹³å‡) é¡¹æ•°\n- **P, D, Q, m**: å­£èŠ‚æ€§ ARIMA å‚æ•°\n\n### C. æ¨¡å‹é€‰æ‹©å»ºè®®\n\n- **ARIMA/SARIMA**: é€‚åˆçº¿æ€§ã€å¹³ç¨³åºåˆ—ï¼Œå¯è§£é‡Šæ€§å¼º\n- **Prophet**: é€‚åˆæœ‰æ˜æ˜¾å­£èŠ‚æ€§å’ŒèŠ‚å‡æ—¥æ•ˆåº”çš„åºåˆ—\n- **LSTM**: é€‚åˆé•¿åºåˆ—ã€éçº¿æ€§å…³ç³»\n- **XGBoost**: é€‚åˆæœ‰å¤–ç”Ÿå˜é‡çš„é¢„æµ‹\n",
  "variables_schema": [
    {
      "name": "projectName",
      "label": "é¡¹ç›®åç§°",
      "type": "string",
      "required": true
    },
    {
      "name": "dataType",
      "label": "æ•°æ®ç±»å‹",
      "type": "select",
      "required": true,
      "options": [
        {"value": "sales", "label": "é”€å”®æ•°æ®"},
        {"value": "stock", "label": "è‚¡ç¥¨ä»·æ ¼"},
        {"value": "traffic", "label": "ç½‘ç«™æµé‡"},
        {"value": "weather", "label": "æ°”è±¡æ•°æ®"},
        {"value": "energy", "label": "èƒ½æºæ¶ˆè€—"},
        {"value": "other", "label": "å…¶ä»–"}
      ]
    },
    {
      "name": "timeGranularity",
      "label": "æ—¶é—´ç²’åº¦",
      "type": "select",
      "required": false,
      "options": [
        {"value": "hourly", "label": "å°æ—¶"},
        {"value": "daily", "label": "å¤©"},
        {"value": "weekly", "label": "å‘¨"},
        {"value": "monthly", "label": "æœˆ"}
      ]
    },
    {
      "name": "seasonalPeriod",
      "label": "å­£èŠ‚æ€§å‘¨æœŸ",
      "type": "number",
      "required": false
    }
  ],
  "file_structure": {
    "root": "{{projectName}}",
    "files": [
      {"path": "time_series_analysis.ipynb", "type": "notebook"},
      {"path": "data/", "type": "folder"},
      {"path": "models/", "type": "folder"},
      {"path": "reports/", "type": "folder"}
    ]
  },
  "default_files": [],
  "is_builtin": true,
  "author": "ChainlessChain Team",
  "version": "1.0.0"
}
