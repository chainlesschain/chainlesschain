<template>
  <div class="multimedia-demo">
    <div class="demo-header">
      <h1>
        <span class="header-icon">ğŸ¬</span>
        å¤šåª’ä½“å¤„ç†å·¥ä½œå°
      </h1>
      <p class="header-subtitle">
        å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ä¸€ç«™å¼å¤„ç† | æ€§èƒ½æå‡3-5å€ | å†…å­˜é™ä½60%
      </p>
    </div>

    <!-- è¿›åº¦ç›‘æ§é¢æ¿ï¼ˆå›ºå®šåœ¨é¡¶éƒ¨ï¼‰ -->
    <div class="progress-monitor-container">
      <ProgressMonitor ref="progressMonitor" />
    </div>

    <!-- åŠŸèƒ½tabåˆ‡æ¢ -->
    <a-tabs v-model:activeKey="activeTabKey" type="card" size="large" class="main-tabs">
      <!-- å¤šåª’ä½“å¤„ç† -->
      <a-tab-pane key="processor" tab="å¤šåª’ä½“å¤„ç†">
        <template #tab>
          <span>
            <CloudUploadOutlined />
            å¤šåª’ä½“å¤„ç†
          </span>
        </template>
        <MediaProcessor />
      </a-tab-pane>

      <!-- è§†é¢‘ç¼–è¾‘ -->
      <a-tab-pane key="video" tab="è§†é¢‘ç¼–è¾‘">
        <template #tab>
          <span>
            <VideoCameraOutlined />
            è§†é¢‘ç¼–è¾‘
          </span>
        </template>
        <VideoEditor />
      </a-tab-pane>

      <!-- ä½¿ç”¨æ–‡æ¡£ -->
      <a-tab-pane key="docs" tab="ä½¿ç”¨æ–‡æ¡£">
        <template #tab>
          <span>
            <FileTextOutlined />
            ä½¿ç”¨æ–‡æ¡£
          </span>
        </template>

        <a-card title="åŠŸèƒ½è¯´æ˜" :bordered="false">
          <a-collapse accordion>
            <!-- å›¾ç‰‡å¤„ç† -->
            <a-collapse-panel key="1" header="ğŸ“· å›¾ç‰‡å¤„ç†">
              <h4>æ ¸å¿ƒåŠŸèƒ½</h4>
              <ul>
                <li><strong>æ™ºèƒ½å‹ç¼©</strong>: æ”¯æŒè´¨é‡è°ƒèŠ‚ï¼ˆ1-100ï¼‰ï¼Œæœ€å¤§å®½åº¦è‡ªå®šä¹‰</li>
                <li><strong>æ ¼å¼è½¬æ¢</strong>: JPEGã€PNGã€WebPäº’è½¬</li>
                <li><strong>OCRè¯†åˆ«</strong>: æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ç­‰å¤šè¯­è¨€ï¼ŒWorkeræ± å¹¶å‘å¤„ç†</li>
                <li><strong>æ‰¹é‡å¤„ç†</strong>: ä¸€æ¬¡æ€§å¤„ç†å¤šå¼ å›¾ç‰‡ï¼Œè‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾</li>
                <li><strong>çŸ¥è¯†åº“é›†æˆ</strong>: OCRç»“æœè‡ªåŠ¨æ·»åŠ åˆ°çŸ¥è¯†åº“</li>
              </ul>

              <h4>æ€§èƒ½ä¼˜åŒ–</h4>
              <a-descriptions bordered size="small" :column="2">
                <a-descriptions-item label="å¤§æ–‡ä»¶å¤„ç†">
                  10MB+å›¾ç‰‡ä½¿ç”¨æµå¼å¤„ç†ï¼Œå†…å­˜é™ä½67%
                </a-descriptions-item>
                <a-descriptions-item label="æ‰¹é‡OCR">
                  Workeræ± å¹¶å‘ï¼Œé€Ÿåº¦æå‡3.3å€
                </a-descriptions-item>
                <a-descriptions-item label="å‹ç¼©æ•ˆç‡">
                  è‡ªåŠ¨é™çº§ç­–ç•¥ï¼Œå†…å­˜ç´§å¼ æ—¶ä¼˜é›…å¤„ç†
                </a-descriptions-item>
                <a-descriptions-item label="ç¼“å­˜ä¼˜åŒ–">
                  æ™ºèƒ½ç¼“å­˜ï¼Œå‘½ä¸­ç‡æå‡40%
                </a-descriptions-item>
              </a-descriptions>

              <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
              <a-typography-paragraph>
                <pre><code>// ä¸Šä¼ å›¾ç‰‡
import multimediaAPI from '@/utils/multimedia-api';

const result = await multimediaAPI.uploadImage(imagePath, {
  quality: 85,
  maxWidth: 1920,
  compress: true,
  performOCR: true,
  addToKnowledge: true
}, (progress) => {
  console.log('è¿›åº¦:', progress.percent);
});</code></pre>
              </a-typography-paragraph>
            </a-collapse-panel>

            <!-- éŸ³é¢‘è½¬å½• -->
            <a-collapse-panel key="2" header="ğŸµ éŸ³é¢‘è½¬å½•">
              <h4>æ ¸å¿ƒåŠŸèƒ½</h4>
              <ul>
                <li><strong>å¤šå¼•æ“æ”¯æŒ</strong>: Whisper(æœ¬åœ°)ã€Azure Speechã€Google Speech</li>
                <li><strong>è¯­è¨€è¯†åˆ«</strong>: æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€è‡ªåŠ¨æ£€æµ‹</li>
                <li><strong>æ‰¹é‡è½¬å½•</strong>: å¹¶å‘å¤„ç†å¤šä¸ªéŸ³é¢‘æ–‡ä»¶</li>
                <li><strong>æ ¼å¼æ”¯æŒ</strong>: MP3ã€WAVã€M4Aã€OGGç­‰ä¸»æµæ ¼å¼</li>
              </ul>

              <h4>æ€§èƒ½ä¼˜åŒ–</h4>
              <a-descriptions bordered size="small" :column="2">
                <a-descriptions-item label="ç¼“å­˜ç­–ç•¥">
                  å¢å¼ºç¼“å­˜é”®ï¼ˆå¼•æ“+è¯­è¨€+æ¨¡å‹ï¼‰ï¼Œå‘½ä¸­ç‡70%+
                </a-descriptions-item>
                <a-descriptions-item label="æµå¼å“ˆå¸Œ">
                  1MB chunkså¤„ç†ï¼Œå†…å­˜ä»100MBé™è‡³5MB
                </a-descriptions-item>
                <a-descriptions-item label="å¹¶å‘è½¬æ¢">
                  Promise.allå¹¶å‘ï¼Œ10æ®µéŸ³é¢‘ä»60ç§’é™è‡³12ç§’
                </a-descriptions-item>
                <a-descriptions-item label="åŠ¨æ€å¹¶å‘">
                  åŸºäºCPUæ ¸å¿ƒæ•°è‡ªåŠ¨è°ƒæ•´
                </a-descriptions-item>
              </a-descriptions>

              <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
              <a-typography-paragraph>
                <pre><code>// éŸ³é¢‘è½¬å½•
const result = await multimediaAPI.transcribeAudio(audioPath, {
  engine: 'whisper',
  language: 'zh'
}, (progress) => {
  console.log('è½¬å½•è¿›åº¦:', progress.percent);
});</code></pre>
              </a-typography-paragraph>
            </a-collapse-panel>

            <!-- è§†é¢‘ç¼–è¾‘ -->
            <a-collapse-panel key="3" header="ğŸ¬ è§†é¢‘ç¼–è¾‘">
              <h4>æ ¸å¿ƒåŠŸèƒ½</h4>
              <ul>
                <li><strong>13ç§æ»¤é•œ</strong>: æ¨¡ç³Šã€é”åŒ–ã€é»‘ç™½ã€æ€€æ—§ã€æš—è§’ã€äº®åº¦ã€å¯¹æ¯”åº¦ç­‰</li>
                <li><strong>æ»¤é•œé“¾</strong>: ç»„åˆå¤šä¸ªæ»¤é•œæ•ˆæœ</li>
                <li><strong>éŸ³è½¨å¤„ç†</strong>: æå–ã€åˆ†ç¦»ã€æ›¿æ¢ã€éŸ³é‡è°ƒèŠ‚</li>
                <li><strong>é«˜çº§å­—å¹•</strong>: 10+æ ·å¼å‚æ•°ï¼Œ4ç§é¢„è®¾é£æ ¼</li>
                <li><strong>åŸºç¡€ç¼–è¾‘</strong>: è£å‰ªã€è½¬æ¢ã€å‹ç¼©ã€ç¼©ç•¥å›¾</li>
              </ul>

              <h4>æ»¤é•œåˆ—è¡¨</h4>
              <a-row :gutter="[16, 16]">
                <a-col :span="6" v-for="filter in videoFilters" :key="filter.name">
                  <a-tag color="blue">{{ filter.name }}</a-tag>
                </a-col>
              </a-row>

              <h4>å­—å¹•é¢„è®¾</h4>
              <a-descriptions bordered size="small" :column="2">
                <a-descriptions-item label="é»˜è®¤">
                  Arial 24å·ï¼Œç™½è‰²ï¼Œé»‘è‰²æè¾¹
                </a-descriptions-item>
                <a-descriptions-item label="å½±é™¢">
                  Arial 28å·ï¼Œç²—ä½“ï¼Œå¤§æè¾¹
                </a-descriptions-item>
                <a-descriptions-item label="ç®€çº¦">
                  Helvetica 20å·ï¼Œç»†æè¾¹
                </a-descriptions-item>
                <a-descriptions-item label="ç²—ä½“">
                  Arial Black 26å·ï¼Œé»„è‰²ï¼Œå‘å…‰æ•ˆæœ
                </a-descriptions-item>
              </a-descriptions>

              <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
              <a-typography-paragraph>
                <pre><code>// åº”ç”¨æ»¤é•œ
await multimediaAPI.applyVideoFilter(inputPath, outputPath, {
  filterType: 'sepia',
  intensity: 1.5
}, (progress) => {
  console.log('å¤„ç†è¿›åº¦:', progress.percent);
});

// æ·»åŠ å­—å¹•ï¼ˆä½¿ç”¨é¢„è®¾ï¼‰
await multimediaAPI.addSubtitlesWithPreset(
  videoPath,
  subtitlePath,
  outputPath,
  'cinema'
);</code></pre>
              </a-typography-paragraph>
            </a-collapse-panel>

            <!-- è¿›åº¦ç›‘æ§ -->
            <a-collapse-panel key="4" header="ğŸ“Š è¿›åº¦ç›‘æ§">
              <h4>åŠŸèƒ½ç‰¹æ€§</h4>
              <ul>
                <li><strong>å®æ—¶ç›‘æ§</strong>: æ‰€æœ‰ä»»åŠ¡è¿›åº¦å®æ—¶æ˜¾ç¤º</li>
                <li><strong>ä»»åŠ¡åˆ†ç±»</strong>: æ´»åŠ¨ä»»åŠ¡ã€å·²å®Œæˆã€å¤±è´¥ä»»åŠ¡åˆ†ç±»å±•ç¤º</li>
                <li><strong>è¿›åº¦é˜¶æ®µ</strong>: 7ç§ä»»åŠ¡é˜¶æ®µï¼ˆç­‰å¾…ã€å‡†å¤‡ã€å¤„ç†ã€æ”¶å°¾ã€å®Œæˆã€å¤±è´¥ã€å–æ¶ˆï¼‰</li>
                <li><strong>å±‚çº§è¿›åº¦</strong>: çˆ¶å­ä»»åŠ¡è¿›åº¦è‡ªåŠ¨èšåˆ</li>
                <li><strong>è‡ªåŠ¨æ¸…ç†</strong>: è‡ªåŠ¨æ¸…ç†è¿‡æœŸä»»åŠ¡</li>
              </ul>

              <h4>è¿›åº¦äº‹ä»¶</h4>
              <a-descriptions bordered size="small">
                <a-descriptions-item label="task-progress">
                  ä»»åŠ¡è¿›åº¦æ›´æ–°äº‹ä»¶
                </a-descriptions-item>
                <a-descriptions-item label="checkpoint-saved">
                  æ£€æŸ¥ç‚¹ä¿å­˜äº‹ä»¶ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰
                </a-descriptions-item>
                <a-descriptions-item label="task-retry">
                  ä»»åŠ¡é‡è¯•äº‹ä»¶
                </a-descriptions-item>
                <a-descriptions-item label="task-complete">
                  ä»»åŠ¡å®Œæˆäº‹ä»¶
                </a-descriptions-item>
              </a-descriptions>
            </a-collapse-panel>

            <!-- é”™è¯¯æ¢å¤ -->
            <a-collapse-panel key="5" header="ğŸ”„ é”™è¯¯æ¢å¤">
              <h4>åŠŸèƒ½ç‰¹æ€§</h4>
              <ul>
                <li><strong>æ–­ç‚¹ç»­ä¼ </strong>: è‡ªåŠ¨ä¿å­˜æ£€æŸ¥ç‚¹ï¼Œå¤±è´¥åå¯æ¢å¤</li>
                <li><strong>æŒ‡æ•°é€€é¿é‡è¯•</strong>: æœ€å¤šé‡è¯•3æ¬¡ï¼Œæ™ºèƒ½å»¶è¿Ÿ</li>
                <li><strong>æ£€æŸ¥ç‚¹ç®¡ç†</strong>: è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ£€æŸ¥ç‚¹ï¼ˆ1å°æ—¶ï¼‰</li>
                <li><strong>è¿›åº¦æ¢å¤</strong>: ä»ä¸Šæ¬¡å¤±è´¥ç‚¹ç»§ç»­å¤„ç†</li>
              </ul>

              <h4>é…ç½®ç¤ºä¾‹</h4>
              <a-typography-paragraph>
                <pre><code>// ResumableProcessoré…ç½®
const processor = new ResumableProcessor({
  maxRetries: 3,          // æœ€å¤§é‡è¯•æ¬¡æ•°
  retryDelay: 1000,       // åˆå§‹å»¶è¿Ÿ1ç§’
  checkpointInterval: 10, // æ¯10%ä¿å­˜æ£€æŸ¥ç‚¹
  autoCleanup: true       // è‡ªåŠ¨æ¸…ç†
});</code></pre>
              </a-typography-paragraph>
            </a-collapse-panel>
          </a-collapse>
        </a-card>

        <a-card title="æ€§èƒ½æ•°æ®" :bordered="false" style="margin-top: 24px">
          <a-table
            :columns="performanceColumns"
            :data-source="performanceData"
            :pagination="false"
            bordered
          >
            <template #bodyCell="{ column, record }">
              <template v-if="column.key === 'improvement'">
                <a-tag :color="record.improvementColor">
                  {{ record.improvement }}
                </a-tag>
              </template>
            </template>
          </a-table>
        </a-card>
      </a-tab-pane>
    </a-tabs>

    <!-- å¿«æ·æ“ä½œæµ®åŠ¨æŒ‰é’® -->
    <a-float-button-group shape="circle" style="right: 24px; bottom: 24px">
      <a-float-button>
        <template #icon>
          <QuestionCircleOutlined />
        </template>
      </a-float-button>
      <a-float-button type="primary">
        <template #icon>
          <ThunderboltOutlined />
        </template>
      </a-float-button>
      <a-float-button-back-top :visibility-height="100" />
    </a-float-button-group>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import ProgressMonitor from '../components/multimedia/ProgressMonitor.vue';
import MediaProcessor from '../components/multimedia/MediaProcessor.vue';
import VideoEditor from '../components/multimedia/VideoEditor.vue';
import {
  CloudUploadOutlined,
  VideoCameraOutlined,
  FileTextOutlined,
  QuestionCircleOutlined,
  ThunderboltOutlined,
} from '@ant-design/icons-vue';

// çŠ¶æ€
const activeTabKey = ref('processor');
const progressMonitor = ref(null);

// è§†é¢‘æ»¤é•œåˆ—è¡¨
const videoFilters = ref([
  { name: 'æ¨¡ç³Š (blur)' },
  { name: 'é”åŒ– (sharpen)' },
  { name: 'é»‘ç™½ (grayscale)' },
  { name: 'æ€€æ—§ (sepia)' },
  { name: 'æš—è§’ (vignette)' },
  { name: 'äº®åº¦ (brightness)' },
  { name: 'å¯¹æ¯”åº¦ (contrast)' },
  { name: 'é¥±å’Œåº¦ (saturation)' },
  { name: 'è´Ÿç‰‡ (negative)' },
  { name: 'é•œåƒ (mirror)' },
  { name: 'ç¿»è½¬ (flip)' },
  { name: 'å¤å¤ (vintage)' },
  { name: 'å¡é€š (cartoon)' },
]);

// æ€§èƒ½æ•°æ®è¡¨æ ¼åˆ—
const performanceColumns = [
  { title: 'æŒ‡æ ‡', dataIndex: 'metric', key: 'metric', width: 200 },
  { title: 'ä¼˜åŒ–å‰', dataIndex: 'before', key: 'before', align: 'right' },
  { title: 'ä¼˜åŒ–å', dataIndex: 'after', key: 'after', align: 'right' },
  { title: 'æå‡å¹…åº¦', dataIndex: 'improvement', key: 'improvement', align: 'center' },
];

// æ€§èƒ½æ•°æ®
const performanceData = ref([
  {
    key: '1',
    metric: '100MBéŸ³é¢‘å“ˆå¸Œå†…å­˜å³°å€¼',
    before: '100MB',
    after: '5MB',
    improvement: '95% â†“',
    improvementColor: 'green',
  },
  {
    key: '2',
    metric: '10æ®µéŸ³é¢‘å¹¶å‘è½¬æ¢è€—æ—¶',
    before: '60ç§’',
    after: '12ç§’',
    improvement: '5x â†‘',
    improvementColor: 'blue',
  },
  {
    key: '3',
    metric: 'ç¼“å­˜å‘½ä¸­ç‡',
    before: '50%',
    after: '70%+',
    improvement: '40% â†‘',
    improvementColor: 'cyan',
  },
  {
    key: '4',
    metric: '100MB TIFFå‹ç¼©å†…å­˜',
    before: '1.2GB',
    after: '400MB',
    improvement: '67% â†“',
    improvementColor: 'green',
  },
  {
    key: '5',
    metric: '10å¼ å›¾OCRå¤„ç†è€—æ—¶',
    before: '40ç§’',
    after: '12ç§’',
    improvement: '3.3x â†‘',
    improvementColor: 'blue',
  },
  {
    key: '6',
    metric: 'å¹¶å‘ä»»åŠ¡æ•° (8æ ¸CPU)',
    before: '2',
    after: '4',
    improvement: '2x â†‘',
    improvementColor: 'purple',
  },
]);
</script>

<style scoped lang="scss">
.multimedia-demo {
  padding: 24px;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.demo-header {
  text-align: center;
  margin-bottom: 32px;
  color: white;

  h1 {
    font-size: 36px;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;

    .header-icon {
      font-size: 48px;
    }
  }

  .header-subtitle {
    font-size: 16px;
    margin-top: 12px;
    opacity: 0.9;
  }
}

.progress-monitor-container {
  margin-bottom: 24px;
}

.main-tabs {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);

  :deep(.ant-tabs-nav) {
    margin-bottom: 24px;
  }

  :deep(.ant-tabs-tab) {
    font-size: 16px;
    padding: 12px 24px;

    &.ant-tabs-tab-active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 8px;

      .ant-tabs-tab-btn {
        color: white;
      }
    }
  }
}

h4 {
  font-size: 16px;
  font-weight: 600;
  margin: 24px 0 16px;
  color: #262626;
}

ul {
  padding-left: 24px;

  li {
    margin-bottom: 8px;
    line-height: 1.8;

    strong {
      color: #1890ff;
    }
  }
}

pre {
  background: #f6f8fa;
  border: 1px solid #e1e4e8;
  border-radius: 6px;
  padding: 16px;
  overflow-x: auto;

  code {
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    font-size: 13px;
    line-height: 1.6;
    color: #24292e;
  }
}
</style>
