# æ–°å¢åŠŸèƒ½é›†æˆæŒ‡å—

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¶é—´**: 2025-12-23
**é€‚ç”¨äº**: ChainlessChain v0.17.0+

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•å®ŒæˆPPTå¼•æ“ã€æ–‡æ¡£å¯¼å‡ºå’Œé¡¹ç›®åˆ†äº«åŠŸèƒ½çš„æœ€ç»ˆé›†æˆã€‚

---

## ğŸ“¦ å·²å®Œæˆçš„æ–‡ä»¶

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `src/main/engines/ppt-engine.js` | âœ… å·²åˆ›å»º | PPTç”Ÿæˆå¼•æ“ï¼ˆ900+è¡Œï¼‰ |
| `src/main/engines/document-engine.js` | âœ… å·²å¢å¼º | æ–‡æ¡£å¤šæ ¼å¼å¯¼å‡ºï¼ˆ915è¡Œï¼‰ |
| `src/renderer/components/projects/ProjectShareDialog.vue` | âœ… å·²åˆ›å»º | åˆ†äº«å¯¹è¯æ¡†ç»„ä»¶ |
| `src/preload/index.js` | âœ… å·²æ›´æ–° | æ·»åŠ åˆ†äº«API |

---

## ğŸ”§ éœ€è¦å®Œæˆçš„é›†æˆæ­¥éª¤

### æ­¥éª¤1: å®‰è£…ä¾èµ–

```bash
cd desktop-app-vue

# PPTç”Ÿæˆï¼ˆå¿…éœ€ï¼‰
npm install pptxgenjs

# PDFå¯¼å‡ºï¼ˆæ¨èï¼‰
npm install puppeteer

# Wordå¯¼å‡ºï¼ˆå¯é€‰ï¼‰
npm install docx
```

### æ­¥éª¤2: æ·»åŠ IPCå¤„ç†å‡½æ•°

åœ¨ `src/main/index.js` ä¸­çš„é¡¹ç›®ç®¡ç†IPCéƒ¨åˆ†ï¼ˆçº¦5200è¡Œé™„è¿‘ï¼‰ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```javascript
// ==================== é¡¹ç›®åˆ†äº« IPC ====================
// åœ¨ project:cancel-task-plan ä¹‹åæ·»åŠ 

// åˆ†äº«é¡¹ç›®
ipcMain.handle('project:share', async (_event, projectId, shareMode, options) => {
  try {
    const { v4: uuidv4 } = require('uuid');

    if (!this.database) {
      throw new Error('æ•°æ®åº“æœªåˆå§‹åŒ–');
    }

    // ç”Ÿæˆåˆ†äº«ä»¤ç‰Œ
    const shareToken = uuidv4();
    const timestamp = Date.now();

    // æ›´æ–°é¡¹ç›®åˆ†äº«è®¾ç½®
    const sql = `
      UPDATE projects
      SET share_mode = ?, share_token = ?, updated_at = ?
      WHERE id = ?
    `;

    this.database.run(sql, [shareMode, shareToken, timestamp, projectId]);

    // ç”Ÿæˆåˆ†äº«é“¾æ¥
    const shareLink = shareMode === 'public'
      ? `https://chainlesschain.com/share/${shareToken}`
      : null;

    console.log(`[Main] é¡¹ç›®åˆ†äº«è®¾ç½®å·²æ›´æ–°: ${projectId} -> ${shareMode}`);

    // å¦‚æœæ˜¯å…¬å¼€æ¨¡å¼ï¼Œå¯ä»¥å‘å¸ƒåˆ°ç¤¾äº¤æ¨¡å—ï¼ˆå¯é€‰ï¼‰
    if (shareMode === 'public') {
      // TODO: é›†æˆç¤¾äº¤æ¨¡å—å‘å¸ƒ
      // await this.socialModule.publishProject(projectId);
    }

    return {
      success: true,
      shareMode,
      shareLink,
      shareToken: shareMode === 'public' ? shareToken : null
    };
  } catch (error) {
    console.error('[Main] åˆ†äº«é¡¹ç›®å¤±è´¥:', error);
    throw error;
  }
});

// å–æ¶ˆåˆ†äº«ï¼ˆè®¾ä¸ºç§æœ‰ï¼‰
ipcMain.handle('project:unshare', async (_event, projectId) => {
  try {
    if (!this.database) {
      throw new Error('æ•°æ®åº“æœªåˆå§‹åŒ–');
    }

    const timestamp = Date.now();

    const sql = `
      UPDATE projects
      SET share_mode = 'private', share_token = NULL, updated_at = ?
      WHERE id = ?
    `;

    this.database.run(sql, ['private', timestamp, projectId]);

    console.log(`[Main] é¡¹ç›®å·²å–æ¶ˆåˆ†äº«: ${projectId}`);

    return { success: true };
  } catch (error) {
    console.error('[Main] å–æ¶ˆåˆ†äº«å¤±è´¥:', error);
    throw error;
  }
});

// é€šè¿‡åˆ†äº«ä»¤ç‰Œè·å–é¡¹ç›®
ipcMain.handle('project:get-by-share-token', async (_event, shareToken) => {
  try {
    if (!this.database) {
      throw new Error('æ•°æ®åº“æœªåˆå§‹åŒ–');
    }

    const sql = `
      SELECT * FROM projects
      WHERE share_token = ? AND share_mode != 'private'
    `;

    const stmt = this.database.prepare(sql);
    const project = stmt.get(shareToken);

    if (!project) {
      throw new Error('é¡¹ç›®ä¸å­˜åœ¨æˆ–å·²å–æ¶ˆåˆ†äº«');
    }

    console.log(`[Main] é€šè¿‡åˆ†äº«ä»¤ç‰Œè·å–é¡¹ç›®: ${project.id}`);

    return project;
  } catch (error) {
    console.error('[Main] è·å–åˆ†äº«é¡¹ç›®å¤±è´¥:', error);
    throw error;
  }
});
```

### æ­¥éª¤3: åœ¨ProjectsPageä¸­é›†æˆåˆ†äº«åŠŸèƒ½

åœ¨ `src/renderer/pages/projects/ProjectsPage.vue` ä¸­ï¼š

#### 3.1 å¯¼å…¥ç»„ä»¶

```vue
<script setup>
import ProjectShareDialog from '@/components/projects/ProjectShareDialog.vue';
// ... å…¶ä»–å¯¼å…¥
```

#### 3.2 æ·»åŠ å“åº”å¼çŠ¶æ€

```javascript
// åˆ†äº«ç›¸å…³
const showShareDialog = ref(false);
const currentShareProjectId = ref(null);
```

#### 3.3 æ·»åŠ æ–¹æ³•

```javascript
// æ‰“å¼€åˆ†äº«å¯¹è¯æ¡†
const handleShareProject = (projectId) => {
  currentShareProjectId.value = projectId;
  showShareDialog.value = true;
};

// åˆ†äº«å®Œæˆå›è°ƒ
const handleProjectShared = async (result) => {
  console.log('é¡¹ç›®å·²åˆ†äº«:', result);
  message.success('é¡¹ç›®åˆ†äº«è®¾ç½®å·²æ›´æ–°');

  // åˆ·æ–°é¡¹ç›®åˆ—è¡¨
  const userId = authStore.currentUser?.id || 'default-user';
  await projectStore.fetchProjects(userId);
};

// å–æ¶ˆåˆ†äº«å›è°ƒ
const handleProjectUnshared = async () => {
  console.log('é¡¹ç›®å·²å–æ¶ˆåˆ†äº«');
  message.success('é¡¹ç›®å·²è®¾ä¸ºç§æœ‰');

  // åˆ·æ–°é¡¹ç›®åˆ—è¡¨
  const userId = authStore.currentUser?.id || 'default-user';
  await projectStore.fetchProjects(userId);
};
```

#### 3.4 æ·»åŠ åˆ°æ¨¡æ¿

```vue
<template>
  <div class="projects-page-wrapper">
    <!-- ç°æœ‰å†…å®¹... -->

    <!-- æ·»åŠ åˆ†äº«å¯¹è¯æ¡† -->
    <ProjectShareDialog
      v-if="currentShareProjectId"
      v-model="showShareDialog"
      :project-id="currentShareProjectId"
      :current-share-mode="getCurrentShareMode(currentShareProjectId)"
      :current-share-link="getCurrentShareLink(currentShareProjectId)"
      @shared="handleProjectShared"
      @unshared="handleProjectUnshared"
    />
  </div>
</template>
```

#### 3.5 æ·»åŠ è¾…åŠ©æ–¹æ³•

```javascript
// è·å–å½“å‰åˆ†äº«æ¨¡å¼
const getCurrentShareMode = (projectId) => {
  const project = projectStore.projects.find(p => p.id === projectId);
  return project?.share_mode || 'private';
};

// è·å–å½“å‰åˆ†äº«é“¾æ¥
const getCurrentShareLink = (projectId) => {
  const project = projectStore.projects.find(p => p.id === projectId);
  if (project?.share_mode === 'public' && project?.share_token) {
    return `https://chainlesschain.com/share/${project.share_token}`;
  }
  return '';
};
```

### æ­¥éª¤4: åœ¨ProjectCardä¸­æ·»åŠ åˆ†äº«æŒ‰é’®

åœ¨ `src/renderer/components/projects/ProjectCard.vue` ä¸­ï¼š

```vue
<template>
  <div class="project-card">
    <!-- ç°æœ‰å†…å®¹... -->

    <div class="card-actions">
      <!-- ç°æœ‰æŒ‰é’®... -->
      <a-button
        type="text"
        size="small"
        @click.stop="$emit('share', project.id)"
      >
        <ShareAltOutlined /> åˆ†äº«
      </a-button>
    </div>
  </div>
</template>

<script setup>
import { ShareAltOutlined } from '@ant-design/icons-vue';

const emit = defineEmits(['view', 'edit', 'delete', 'share']);
</script>
```

### æ­¥éª¤5: åœ¨ProjectsPageä¸­å¤„ç†å¡ç‰‡åˆ†äº«äº‹ä»¶

```vue
<ProjectCard
  v-for="project in paginatedProjects"
  :key="project.id"
  :project="project"
  @view="handleViewProject"
  @edit="handleEditProject"
  @delete="handleDeleteProject"
  @share="handleShareProject"
/>
```

---

## ğŸ“˜ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ç”ŸæˆPPT

```javascript
// åœ¨ä»»åŠ¡æ‹†è§£ç³»ç»Ÿä¸­ï¼Œå½“ç”¨æˆ·è¾“å…¥ï¼š
"åˆ›å»ºä¸€ä¸ªäº§å“ä»‹ç»PPTï¼ŒåŒ…å«å…¬å¸ç®€ä»‹ã€æ ¸å¿ƒäº§å“ã€å¸‚åœºä¼˜åŠ¿"

// AIä¼šè‡ªåŠ¨è°ƒç”¨ppt-engineç”Ÿæˆï¼š
{
  title: "äº§å“ä»‹ç»",
  slides: [
    { type: "title", title: "äº§å“ä»‹ç»", subtitle: "2025å¹´åº¦" },
    { type: "bullets", title: "å…¬å¸ç®€ä»‹", bullets: [...] },
    { type: "bullets", title: "æ ¸å¿ƒäº§å“", bullets: [...] },
    { type: "content", title: "å¸‚åœºä¼˜åŠ¿", content: "..." }
  ]
}
```

### ç¤ºä¾‹2: å¯¼å‡ºæ–‡æ¡£

```javascript
// ç”¨æˆ·åœ¨é¡¹ç›®è¯¦æƒ…é¡µç‚¹å‡»"å¯¼å‡º"æŒ‰é’®ï¼Œé€‰æ‹©PDFæ ¼å¼

// å‰ç«¯è°ƒç”¨ï¼š
const result = await window.electronAPI.project.exportDocument(
  projectId,
  'pdf'
);

// æˆ–é€šè¿‡ä»»åŠ¡ç³»ç»Ÿï¼š
await taskPlanner.executeSubtask({
  tool: 'document-engine',
  action: 'export_pdf',
  projectPath: '/path/to/project',
  outputFiles: ['report.pdf']
});
```

### ç¤ºä¾‹3: åˆ†äº«é¡¹ç›®

```javascript
// ç”¨æˆ·ç‚¹å‡»é¡¹ç›®å¡ç‰‡ä¸Šçš„"åˆ†äº«"æŒ‰é’®

// 1. æ‰“å¼€ProjectShareDialog
showShareDialog.value = true;

// 2. ç”¨æˆ·é€‰æ‹©"å…¬å¼€è®¿é—®"å¹¶ç‚¹å‡»ç¡®å®š

// 3. è°ƒç”¨IPC
const result = await window.electronAPI.project.share(
  projectId,
  'public',
  {}
);

// 4. è¿”å›åˆ†äº«é“¾æ¥
// result.shareLink = "https://chainlesschain.com/share/uuid-xxx"
```

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### PPTå¼•æ“æµ‹è¯•

- [ ] åˆ›å»ºåŒ…å«ä¸åŒç±»å‹å¹»ç¯ç‰‡çš„PPT
- [ ] æµ‹è¯•ä»Markdownç”ŸæˆPPT
- [ ] æµ‹è¯•ä½¿ç”¨LLMç”ŸæˆPPTå¤§çº²
- [ ] æµ‹è¯•ä¸åŒä¸»é¢˜ï¼ˆlight/dark/business/creativeï¼‰
- [ ] éªŒè¯ç”Ÿæˆçš„PPTXæ–‡ä»¶å¯ä»¥åœ¨PowerPointä¸­æ‰“å¼€

### æ–‡æ¡£å¯¼å‡ºæµ‹è¯•

- [ ] æµ‹è¯•å¯¼å‡ºä¸ºPDFï¼ˆæœ‰puppeteerï¼‰
- [ ] æµ‹è¯•å¯¼å‡ºä¸ºPDFï¼ˆæ— puppeteerï¼Œä½¿ç”¨HTMLæ›¿ä»£ï¼‰
- [ ] æµ‹è¯•å¯¼å‡ºä¸ºWordï¼ˆæœ‰pandocï¼‰
- [ ] æµ‹è¯•å¯¼å‡ºä¸ºWordï¼ˆæ— pandocï¼Œä½¿ç”¨docxåº“ï¼‰
- [ ] æµ‹è¯•å¯¼å‡ºä¸ºWordï¼ˆéƒ½æ— ï¼Œä½¿ç”¨HTMLæ›¿ä»£ï¼‰
- [ ] æµ‹è¯•å¯¼å‡ºä¸ºHTML
- [ ] æµ‹è¯•å¯¼å‡ºä¸ºTXT

### é¡¹ç›®åˆ†äº«æµ‹è¯•

- [ ] æµ‹è¯•è®¾ç½®é¡¹ç›®ä¸ºå…¬å¼€
- [ ] æµ‹è¯•ç”Ÿæˆåˆ†äº«é“¾æ¥
- [ ] æµ‹è¯•å¤åˆ¶åˆ†äº«é“¾æ¥åˆ°å‰ªè´´æ¿
- [ ] æµ‹è¯•å–æ¶ˆåˆ†äº«ï¼ˆè®¾ä¸ºç§æœ‰ï¼‰
- [ ] æµ‹è¯•é€šè¿‡åˆ†äº«ä»¤ç‰Œè®¿é—®é¡¹ç›®
- [ ] æµ‹è¯•åˆ†äº«é“¾æ¥è¿‡æœŸï¼ˆå¦‚æœå®ç°äº†è¿‡æœŸåŠŸèƒ½ï¼‰

---

## ğŸ“Š åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥

| åŠŸèƒ½ | åç«¯ | å‰ç«¯ | IPC | æµ‹è¯• |
|------|------|------|-----|------|
| PPTç”Ÿæˆå¼•æ“ | âœ… | N/A | âœ… | â³ |
| æ–‡æ¡£å¤šæ ¼å¼å¯¼å‡º | âœ… | N/A | âœ… | â³ |
| é¡¹ç›®åˆ†äº« - åç«¯ | âœ… | N/A | âœ… | â³ |
| é¡¹ç›®åˆ†äº« - å‰ç«¯ | N/A | âœ… | âœ… | â³ |
| é¡¹ç›®åˆ†äº« - é›†æˆ | N/A | â³ | âœ… | â³ |

å›¾ä¾‹ï¼š
- âœ… å·²å®Œæˆ
- â³ éœ€è¦ç”¨æˆ·å®Œæˆ
- N/A ä¸é€‚ç”¨

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1: pptxgenjsæœªå®‰è£…

**é”™è¯¯**: `Cannot find module 'pptxgenjs'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
npm install pptxgenjs
```

### é—®é¢˜2: puppeteerå®‰è£…å¤±è´¥

**é”™è¯¯**: `Failed to download Chromium`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä½¿ç”¨å›½å†…é•œåƒ
PUPPETEER_DOWNLOAD_HOST=https://npm.taobao.org/mirrors npm install puppeteer

# æˆ–è·³è¿‡ä¸‹è½½
PUPPETEER_SKIP_DOWNLOAD=1 npm install puppeteer
```

### é—®é¢˜3: PDFå¯¼å‡ºå¤±è´¥

**é”™è¯¯**: `PDF export failed`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥puppeteeræ˜¯å¦æ­£ç¡®å®‰è£…
- å¦‚æœpuppeteerä¸å¯ç”¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”ŸæˆHTMLæ–‡ä»¶ä½œä¸ºæ›¿ä»£
- å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€HTMLæ–‡ä»¶å¹¶æ‰“å°ä¸ºPDF

### é—®é¢˜4: Wordå¯¼å‡ºå¤±è´¥

**é”™è¯¯**: `Docx export failed`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆ1: å®‰è£…ç³»ç»Ÿå·¥å…·pandoc
# Windows
choco install pandoc

# macOS
brew install pandoc

# æ–¹æ¡ˆ2: å®‰è£…docxåº“
npm install docx

# æ–¹æ¡ˆ3: ä½¿ç”¨HTMLæ›¿ä»£ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ï¼‰
```

### é—®é¢˜5: åˆ†äº«åŠŸèƒ½IPCè°ƒç”¨å¤±è´¥

**é”™è¯¯**: `project.share is not a function`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ˜¯å¦å·²åœ¨`src/main/index.js`ä¸­æ·»åŠ äº†IPCå¤„ç†å‡½æ•°
- æ£€æŸ¥æ˜¯å¦å·²åœ¨`src/preload/index.js`ä¸­æ·»åŠ äº†APIå®šä¹‰
- é‡å¯åº”ç”¨ä»¥åŠ è½½æ–°çš„IPCå®šä¹‰

---

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### PPTå¼•æ“ä¼˜åŒ–

1. **æ¨¡æ¿åº“æ‰©å±•**: æ·»åŠ æ›´å¤šä¸»é¢˜å’Œæ ·å¼æ¨¡æ¿
2. **å›¾è¡¨æ”¯æŒ**: å®Œå–„å›¾è¡¨åŠŸèƒ½ï¼Œæ”¯æŒæ›´å¤šå›¾è¡¨ç±»å‹
3. **åŠ¨ç”»æ•ˆæœ**: æ·»åŠ é¡µé¢åˆ‡æ¢å’Œå¯¹è±¡åŠ¨ç”»
4. **æ‰¹é‡ç”Ÿæˆ**: æ”¯æŒæ‰¹é‡ç”Ÿæˆå¤šä¸ªPPT

### æ–‡æ¡£å¯¼å‡ºä¼˜åŒ–

1. **æ ·å¼ä¼˜åŒ–**: æ”¹è¿›PDFå’ŒWordå¯¼å‡ºçš„æ ·å¼
2. **å›¾ç‰‡å¤„ç†**: ä¼˜åŒ–å›¾ç‰‡åœ¨ä¸åŒæ ¼å¼ä¸­çš„æ˜¾ç¤º
3. **æ°´å°æ”¯æŒ**: æ·»åŠ æ°´å°åŠŸèƒ½
4. **æ‰¹é‡å¯¼å‡º**: æ”¯æŒæ‰¹é‡å¯¼å‡ºå¤šä¸ªæ–‡æ¡£

### åˆ†äº«åŠŸèƒ½ä¼˜åŒ–

1. **æƒé™æ§åˆ¶**: ç»†ç²’åº¦çš„è®¿é—®æƒé™è®¾ç½®
2. **è¿‡æœŸæ—¶é—´**: æ”¯æŒè®¾ç½®åˆ†äº«é“¾æ¥è¿‡æœŸæ—¶é—´
3. **è®¿é—®ç»Ÿè®¡**: ç»Ÿè®¡åˆ†äº«é“¾æ¥çš„è®¿é—®æ¬¡æ•°å’Œè®¿é—®è€…
4. **å¾®ä¿¡é›†æˆ**: å®Œæ•´çš„å¾®ä¿¡åˆ†äº«SDKé›†æˆ
5. **äºŒç»´ç **: ç”Ÿæˆåˆ†äº«é“¾æ¥çš„äºŒç»´ç 

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨é›†æˆè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼ˆä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ï¼‰
2. æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„æ˜¯å¦æ­£ç¡®
3. éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
4. å‚è€ƒæœ¬æ–‡æ¡£ä¸­çš„ç¤ºä¾‹ä»£ç 
5. æŸ¥çœ‹ç›¸å…³çš„é”™è¯¯æç¤ºä¿¡æ¯

---

**æœ€åæ›´æ–°**: 2025-12-23
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ä½œè€…**: Claude Code AI Assistant
