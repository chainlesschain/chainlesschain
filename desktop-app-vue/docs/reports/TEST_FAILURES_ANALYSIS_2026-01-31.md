# æµ‹è¯•å¤±è´¥è¯¦ç»†åˆ†æ

**ç”Ÿæˆæ—¥æœŸ**: 2026-01-31
**åŸºäº**: å®Œæ•´æµ‹è¯•è¦†ç›–ç‡è¿è¡Œç»“æœ

---

## ğŸ“Š å¤±è´¥ç»Ÿè®¡æ€»è§ˆ

```
æµ‹è¯•æ‰§è¡Œæ€»æ—¶é•¿: 318.10ç§’

æµ‹è¯•æ–‡ä»¶:
â”œâ”€â”€ âŒ å¤±è´¥: 47ä¸ª (27.5%)
â”œâ”€â”€ âœ… é€šè¿‡: 120ä¸ª (70.2%)
â””â”€â”€ â­ï¸  è·³è¿‡: 4ä¸ª (2.3%)
æ€»è®¡: 171ä¸ª

æµ‹è¯•ç”¨ä¾‹:
â”œâ”€â”€ âŒ å¤±è´¥: 362ä¸ª (5.4%)
â”œâ”€â”€ âœ… é€šè¿‡: 5,749ä¸ª (85.7%)
â””â”€â”€ â­ï¸  è·³è¿‡: 598ä¸ª (8.9%)
æ€»è®¡: 6,709ä¸ª

æœªå¤„ç†é”™è¯¯: 3ä¸ª
```

---

## ğŸ”´ é«˜é¢‘å¤±è´¥æ¨¡å¼åˆ†æ

### Pattern 1: followup-intent-classifier æµ‹è¯•å¤±è´¥

**å½±å“èŒƒå›´**: AIæ„å›¾åˆ†ç±»å™¨
**å¤±è´¥æ•°é‡**: è‡³å°‘4ä¸ªæµ‹è¯•

#### å¤±è´¥ç¤ºä¾‹1: MODIFY_REQUIREMENT æ„å›¾è¯†åˆ«

```javascript
// æ–‡ä»¶: src/main/ai-engine/__tests__/followup-intent-classifier.test.js:57
FAIL: åº”è¯†åˆ« MODIFY_REQUIREMENT æ„å›¾

AssertionError: expected 0.3 to be greater than 0.5

é¢„æœŸç½®ä¿¡åº¦: >0.5
å®é™…ç½®ä¿¡åº¦: 0.3
```

**æ ¹æœ¬åŸå› **: è§„åˆ™å¼•æ“çš„ç½®ä¿¡åº¦é˜ˆå€¼è®¾ç½®è¿‡ä½æˆ–è§„åˆ™æƒé‡ä¸è¶³

**å»ºè®®ä¿®å¤**:

```javascript
// è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼æˆ–æ”¹è¿›è§„åˆ™æƒé‡
const CONFIDENCE_THRESHOLD = {
  MODIFY_REQUIREMENT: 0.3, // é™ä½åˆ°0.3ï¼Œæˆ–æ”¹è¿›è§„åˆ™
  CLARIFICATION: 0.3,
  CANCEL_TASK: 0.5,
};
```

#### å¤±è´¥ç¤ºä¾‹2: CLARIFICATION æ„å›¾è¯†åˆ«

```javascript
// æ–‡ä»¶: src/main/ai-engine/__tests__/followup-intent-classifier.test.js:73
FAIL: åº”è¯†åˆ« CLARIFICATION æ„å›¾

AssertionError: expected 0.3 to be greater than 0.3

é¢„æœŸç½®ä¿¡åº¦: >0.3
å®é™…ç½®ä¿¡åº¦: 0.3 (æ­£å¥½ç­‰äºé˜ˆå€¼)
```

**æ ¹æœ¬åŸå› **: è¾¹ç•Œå€¼æ–­è¨€é—®é¢˜ï¼ˆä½¿ç”¨äº†`>`è€Œä¸æ˜¯`>=`ï¼‰

**å»ºè®®ä¿®å¤**:

```javascript
// é€‰é¡¹1: ä¿®æ”¹æµ‹è¯•æ–­è¨€
expect(result.confidence).toBeGreaterThanOrEqual(0.3);

// é€‰é¡¹2: æé«˜å®é™…ç½®ä¿¡åº¦
// æ”¹è¿›åˆ†ç±»è§„åˆ™ï¼Œä½¿ç½®ä¿¡åº¦>0.3
```

#### å¤±è´¥ç¤ºä¾‹3: CANCEL_TASK æ„å›¾è¯¯åˆ†ç±»

```javascript
// æ–‡ä»¶: src/main/ai-engine/__tests__/followup-intent-classifier.test.js:82
FAIL: åº”è¯†åˆ« CANCEL_TASK æ„å›¾

AssertionError: expected 'CONTINUE_EXECUTION' to be 'CANCEL_TASK'

é¢„æœŸæ„å›¾: CANCEL_TASK
å®é™…æ„å›¾: CONTINUE_EXECUTION
```

**æ ¹æœ¬åŸå› **: å–æ¶ˆä»»åŠ¡çš„å…³é”®è¯è¯†åˆ«è§„åˆ™ç¼ºå¤±æˆ–ä¼˜å…ˆçº§ä½

**å»ºè®®ä¿®å¤**:

```javascript
// åœ¨åˆ†ç±»å™¨ä¸­å¢å¼ºCANCEL_TASKè§„åˆ™
const cancelKeywords = [
  "åœæ­¢",
  "å–æ¶ˆ",
  "ä¸è¦",
  "ç®—äº†",
  "åˆ«ç»§ç»­",
  "stop",
  "cancel",
  "abort",
  "quit",
];

// æé«˜CANCEL_TASKçš„è§„åˆ™æƒé‡
const intentRules = {
  CANCEL_TASK: {
    keywords: cancelKeywords,
    weight: 1.0, // æœ€é«˜æƒé‡
    priority: 1, // æœ€é«˜ä¼˜å…ˆçº§
  },
  CONTINUE_EXECUTION: {
    weight: 0.5,
    priority: 3,
  },
};
```

---

### Pattern 2: Vitest Worker è¶…æ—¶é”™è¯¯ âš ï¸

**å½±å“**: æµ‹è¯•è¿è¡Œç¨³å®šæ€§
**å‡ºç°æ¬¡æ•°**: 3æ¬¡

```
Error: [vitest-worker]: Timeout calling "onTaskUpdate"
```

**æ ¹æœ¬åŸå› åˆ†æ**:

1. æŸäº›æµ‹è¯•è¿è¡Œæ—¶é—´è¿‡é•¿ï¼ˆ>é»˜è®¤è¶…æ—¶æ—¶é—´ï¼‰
2. äº‹ä»¶ç›‘å¬å™¨æ³„æ¼
3. å¼‚æ­¥æ“ä½œæœªæ­£ç¡®æ¸…ç†

**å»ºè®®ä¿®å¤**:

#### æ–¹æ¡ˆ1: å¢åŠ å…¨å±€è¶…æ—¶é…ç½®

```javascript
// vitest.config.js
export default {
  test: {
    testTimeout: 60000, // å¢åŠ åˆ°60ç§’
    hookTimeout: 60000,
    teardownTimeout: 10000,
  },
};
```

#### æ–¹æ¡ˆ2: æ¸…ç†äº‹ä»¶ç›‘å¬å™¨

```javascript
// åœ¨æµ‹è¯•çš„afterEachä¸­
afterEach(() => {
  // æ¸…ç†æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
  if (instance && instance.removeAllListeners) {
    instance.removeAllListeners();
  }

  // æ¸…ç†å®šæ—¶å™¨
  vi.clearAllTimers();

  // å¼ºåˆ¶åƒåœ¾å›æ”¶ï¼ˆå¦‚æœæ”¯æŒï¼‰
  if (global.gc) {
    global.gc();
  }
});
```

#### æ–¹æ¡ˆ3: è¯†åˆ«æ…¢æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•å¹¶è®°å½•è€—æ—¶
npm run test -- --reporter=verbose --outputFile=slow-tests.log

# åˆ†æè€—æ—¶è¶…è¿‡5ç§’çš„æµ‹è¯•
grep -E "âœ“.*[5-9][0-9]{3}ms|âœ“.*[1-9][0-9]{4}ms" slow-tests.log
```

---

## ğŸ“‹ å¤±è´¥æµ‹è¯•åˆ†ç±»

### æŒ‰æ¨¡å—åˆ†ç±»

æ ¹æ®å·²çŸ¥ä¿¡æ¯å’Œæ¨¡å¼ï¼Œé¢„ä¼°å¤±è´¥åˆ†å¸ƒï¼š

| æ¨¡å—              | é¢„ä¼°å¤±è´¥æ•° | å æ¯”  | ä¼˜å…ˆçº§ |
| ----------------- | ---------- | ----- | ------ |
| **AI Engine**     | ~50        | 13.8% | P0     |
| **LLM**           | ~30        | 8.3%  | P0     |
| **P2P**           | ~40        | 11.0% | P1     |
| **Sync**          | ~35        | 9.7%  | P1     |
| **Database**      | ~20        | 5.5%  | P0     |
| **Blockchain**    | ~25        | 6.9%  | P2     |
| **Media**         | ~15        | 4.1%  | P2     |
| **UI Components** | ~30        | 8.3%  | P1     |
| **å…¶ä»–**          | ~117       | 32.3% | P2     |

### æŒ‰å¤±è´¥ç±»å‹åˆ†ç±»

| ç±»å‹         | æè¿°                     | é¢„ä¼°æ•°é‡ | ä¿®å¤éš¾åº¦ |
| ------------ | ------------------------ | -------- | -------- |
| **æ–­è¨€å¤±è´¥** | é¢„æœŸå€¼ä¸å®é™…å€¼ä¸åŒ¹é…     | ~200     | ä¸­       |
| **Mockå¤±è´¥** | Mocké…ç½®é”™è¯¯æˆ–å¤±æ•ˆ       | ~80      | é«˜       |
| **è¶…æ—¶**     | æµ‹è¯•æ‰§è¡Œè¶…æ—¶             | ~30      | ä¸­       |
| **å¼‚æ­¥é—®é¢˜** | Promiseæœªæ­£ç¡®å¤„ç†        | ~25      | é«˜       |
| **èµ„æºæ³„æ¼** | æœªæ¸…ç†çš„èµ„æºå¯¼è‡´é”™è¯¯     | ~15      | é«˜       |
| **ç¯å¢ƒä¾èµ–** | ç¼ºå°‘å¤–éƒ¨ä¾èµ–ï¼ˆå¦‚FFmpegï¼‰ | ~12      | ä½       |

---

## ğŸ” è¯¦ç»†è°ƒæŸ¥å»ºè®®

### Step 1: ç”Ÿæˆè¯¦ç»†å¤±è´¥æŠ¥å‘Š

```bash
cd desktop-app-vue

# è¿è¡Œæµ‹è¯•å¹¶ä¿å­˜è¯¦ç»†è¾“å‡º
npm run test -- --reporter=verbose --outputFile=test-failures-verbose.log 2>&1

# æå–æ‰€æœ‰å¤±è´¥çš„æµ‹è¯•
grep -B 3 "FAIL\|AssertionError" test-failures-verbose.log > failures-summary.txt

# æŒ‰æ–‡ä»¶åˆ†ç»„
grep "FAIL" test-failures-verbose.log | cut -d'>' -f1 | sort | uniq -c | sort -rn > failures-by-file.txt
```

### Step 2: æŒ‰æ¨¡å—åˆ†æ

```bash
# AI Engine æ¨¡å—å¤±è´¥
grep "ai-engine" failures-by-file.txt

# Database æ¨¡å—å¤±è´¥
grep "database" failures-by-file.txt

# P2P æ¨¡å—å¤±è´¥
grep "p2p" failures-by-file.txt
```

### Step 3: è¯†åˆ«æ ¹æœ¬åŸå› 

å¯¹äºæ¯ä¸ªé«˜é¢‘å¤±è´¥æ¨¡å—ï¼š

1. **æ£€æŸ¥æœ€è¿‘æ›´æ”¹**

   ```bash
   git log --oneline --since="1 month ago" -- src/main/ai-engine/
   ```

2. **å¯¹æ¯”é€šè¿‡çš„æµ‹è¯•**
   - æ‰¾å‡ºé€šè¿‡å’Œå¤±è´¥æµ‹è¯•çš„å·®å¼‚
   - è¯†åˆ«å…±åŒçš„å¤±è´¥æ¨¡å¼

3. **æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬**
   ```bash
   npm list vitest @vue/test-utils
   ```

---

## ğŸ› ï¸ ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ (P0) - æœ¬å‘¨ä¿®å¤

#### 1. followup-intent-classifier æµ‹è¯•

**æ–‡ä»¶**: `src/main/ai-engine/__tests__/followup-intent-classifier.test.js`
**å¤±è´¥æ•°**: 4+ä¸ª
**å·¥ä½œé‡**: 2-3å°æ—¶

**ä¿®å¤æ­¥éª¤**:

1. è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼æˆ–ä½¿ç”¨`>=`æ–­è¨€
2. æ”¹è¿›CANCEL_TASKè¯†åˆ«è§„åˆ™
3. å¢åŠ è§„åˆ™æƒé‡é…ç½®
4. éªŒè¯æ‰€æœ‰æ„å›¾åˆ†ç±»åœºæ™¯

#### 2. Vitest Worker è¶…æ—¶

**å½±å“**: å…¨å±€æµ‹è¯•ç¨³å®šæ€§
**å·¥ä½œé‡**: 2-4å°æ—¶

**ä¿®å¤æ­¥éª¤**:

1. å¢åŠ å…¨å±€è¶…æ—¶é…ç½®
2. è¯†åˆ«æ…¢æµ‹è¯•å¹¶ä¼˜åŒ–
3. æ·»åŠ äº‹ä»¶ç›‘å¬å™¨æ¸…ç†
4. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶éªŒè¯

#### 3. database-adapter è·³è¿‡æµ‹è¯•

**å·²æœ‰æ–¹æ¡ˆ**: `DATABASE_ADAPTER_TEST_FIX_PLAN.md`
**å·¥ä½œé‡**: 2-3å°æ—¶

### ä¸­ä¼˜å…ˆçº§ (P1) - 2å‘¨å†…ä¿®å¤

#### 1. Mockç›¸å…³å¤±è´¥ (~80ä¸ª)

**ç­–ç•¥**:

- å®¡æŸ¥æ‰€æœ‰vi.mocké…ç½®
- ç»Ÿä¸€mockç­–ç•¥
- æ·»åŠ mockéªŒè¯

#### 2. å¼‚æ­¥æµ‹è¯•é—®é¢˜ (~25ä¸ª)

**ç­–ç•¥**:

- ç¡®ä¿æ‰€æœ‰asyncå‡½æ•°ä½¿ç”¨await
- æ·»åŠ Promise.allé”™è¯¯å¤„ç†
- ä½¿ç”¨waitForè¾…åŠ©å‡½æ•°

### ä½ä¼˜å…ˆçº§ (P2) - 1ä¸ªæœˆå†…ä¿®å¤

#### 1. UIç»„ä»¶æµ‹è¯•

**ç­–ç•¥**:

- è¡¥å……ç¼ºå¤±çš„ç»„ä»¶æµ‹è¯•
- ä½¿ç”¨@vue/test-utilsæœ€ä½³å®è·µ
- æ·»åŠ E2Eæµ‹è¯•è¦†ç›–

#### 2. ç¯å¢ƒä¾èµ–é—®é¢˜

**ç­–ç•¥**:

- å®‰è£…FFmpegç­‰ä¾èµ–
- é…ç½®CI/CDç¯å¢ƒ
- æ·»åŠ ç¯å¢ƒæ£€æŸ¥

---

## ğŸ“ æ¨èçš„ä¿®å¤æµç¨‹

### æµç¨‹1: å¿«é€Ÿä¿®å¤ï¼ˆé€‚åˆç®€å•æ–­è¨€å¤±è´¥ï¼‰

```javascript
// 1. å®šä½å¤±è´¥æµ‹è¯•
it("åº”è¯†åˆ« MODIFY_REQUIREMENT æ„å›¾", async () => {
  // 2. è¿è¡Œå•ä¸ªæµ‹è¯•
  // npm run test -- -t "åº”è¯†åˆ« MODIFY_REQUIREMENT æ„å›¾"

  const result = await classifier.classify(input);

  // 3. è°ƒè¯•è¾“å‡º
  console.log("Result:", result);

  // 4. è°ƒæ•´æ–­è¨€æˆ–ä¿®å¤ä»£ç 
  expect(result.intent).toBe("MODIFY_REQUIREMENT");
  expect(result.confidence).toBeGreaterThanOrEqual(0.3); // ä¿®æ”¹
});
```

### æµç¨‹2: ç³»ç»Ÿæ€§ä¿®å¤ï¼ˆé€‚åˆæ‰¹é‡å¤±è´¥ï¼‰

```javascript
// 1. åˆ›å»ºä¿®å¤åˆ†æ”¯
git checkout -b fix/ai-engine-intent-classifier

// 2. ä¿®æ”¹æºä»£ç 
// src/main/ai-engine/followup-intent-classifier.js
class FollowupIntentClassifier {
  constructor() {
    this.confidenceThresholds = {
      MODIFY_REQUIREMENT: 0.3,
      CLARIFICATION: 0.3,
      CANCEL_TASK: 0.5
    };
  }

  classify(input) {
    // æ”¹è¿›åˆ†ç±»é€»è¾‘
    // ...
  }
}

// 3. è¿è¡Œæµ‹è¯•éªŒè¯
npm run test src/main/ai-engine/__tests__/followup-intent-classifier.test.js

// 4. æäº¤ä¿®å¤
git add .
git commit -m "fix(ai-engine): ä¿®å¤intentåˆ†ç±»å™¨ç½®ä¿¡åº¦å’Œè§„åˆ™

- è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼é…ç½®
- æ”¹è¿›CANCEL_TASKè§„åˆ™æƒé‡
- ä¿®å¤è¾¹ç•Œå€¼æ–­è¨€é—®é¢˜

Fixes #XXX"
```

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### çŸ­æœŸç›®æ ‡ï¼ˆ1å‘¨ï¼‰

- [ ] followup-intent-classifier: 0ä¸ªå¤±è´¥
- [ ] Vitestè¶…æ—¶: 0ä¸ªé”™è¯¯
- [ ] æ€»å¤±è´¥æ•°: <300ä¸ªï¼ˆå‡å°‘17%ï¼‰

### ä¸­æœŸç›®æ ‡ï¼ˆ2å‘¨ï¼‰

- [ ] æ€»å¤±è´¥æ•°: <180ä¸ªï¼ˆå‡å°‘50%ï¼‰
- [ ] å¤±è´¥ç‡: <3%
- [ ] è¶…æ—¶é”™è¯¯: 0ä¸ª

### é•¿æœŸç›®æ ‡ï¼ˆ1ä¸ªæœˆï¼‰

- [ ] æ€»å¤±è´¥æ•°: <50ä¸ªï¼ˆå‡å°‘86%ï¼‰
- [ ] å¤±è´¥ç‡: <1%
- [ ] æµ‹è¯•é€šè¿‡ç‡: >95%

---

## ğŸ“Š é¢„æœŸæ”¹è¿›æ›²çº¿

```
å½“å‰çŠ¶æ€:     362ä¸ªå¤±è´¥ (5.4%)
1å‘¨å:        300ä¸ªå¤±è´¥ (4.5%)  â¬‡ï¸ 17%æ”¹è¿›
2å‘¨å:        180ä¸ªå¤±è´¥ (2.7%)  â¬‡ï¸ 50%æ”¹è¿›
1ä¸ªæœˆå:      50ä¸ªå¤±è´¥  (0.7%)  â¬‡ï¸ 86%æ”¹è¿›
æœ€ç»ˆç›®æ ‡:     <30ä¸ªå¤±è´¥ (<0.5%) â¬‡ï¸ 92%æ”¹è¿›
```

---

## ğŸ”— ç›¸å…³èµ„æº

### å†…éƒ¨æ–‡æ¡£

- [æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š](./TEST_COVERAGE_REPORT_2026-01-31.md)
- [ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’](./NEXT_STEPS_TEST_IMPROVEMENT.md)
- [Databaseä¿®å¤æ–¹æ¡ˆ](./tests/unit/database/DATABASE_ADAPTER_TEST_FIX_PLAN.md)

### è°ƒè¯•å‘½ä»¤

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
npm run test src/main/ai-engine/__tests__/followup-intent-classifier.test.js

# è¿è¡Œå•ä¸ªæµ‹è¯•ç”¨ä¾‹
npm run test -- -t "åº”è¯†åˆ« MODIFY_REQUIREMENT æ„å›¾"

# å¯ç”¨è¯¦ç»†æ—¥å¿—
DEBUG=* npm run test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### ç¬¬ä¸€é˜¶æ®µï¼ˆæœ¬å‘¨ï¼‰

- [ ] è¯†åˆ«å¹¶åˆ†ç±»æ‰€æœ‰362ä¸ªå¤±è´¥æµ‹è¯•
- [ ] ä¿®å¤followup-intent-classifierçš„4ä¸ªå¤±è´¥
- [ ] è§£å†³3ä¸ªVitestè¶…æ—¶é”™è¯¯
- [ ] åˆ›å»ºGitHub Issuesè¿½è¸ªå‰©ä½™é—®é¢˜

### ç¬¬äºŒé˜¶æ®µï¼ˆ2å‘¨ï¼‰

- [ ] ä¿®å¤50%çš„å¤±è´¥æµ‹è¯•
- [ ] å¤±è´¥ç‡é™è‡³<3%
- [ ] æ— è¶…æ—¶é”™è¯¯

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1ä¸ªæœˆï¼‰

- [ ] ä¿®å¤86%çš„å¤±è´¥æµ‹è¯•
- [ ] å¤±è´¥ç‡é™è‡³<1%
- [ ] æµ‹è¯•é€šè¿‡ç‡>95%

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-31
**æœ€åæ›´æ–°**: 2026-01-31
**çŠ¶æ€**: âœ… åˆ†æå®Œæˆï¼Œå¾…æ‰§è¡Œä¿®å¤
