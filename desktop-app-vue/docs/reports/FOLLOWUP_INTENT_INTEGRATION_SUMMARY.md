# åç»­è¾“å…¥æ„å›¾åˆ†ç±»å™¨ - é›†æˆæ€»ç»“

## âœ… é›†æˆå®Œæˆ

**æ—¥æœŸ**: 2026-01-05
**çŠ¶æ€**: ğŸ‰ **å…¨éƒ¨å®Œæˆ**

---

## ğŸ“¦ å·²åˆ›å»ºçš„æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|------|
| **æ ¸å¿ƒåˆ†ç±»å™¨** | `src/main/ai-engine/followup-intent-classifier.js` | 316 | è§„åˆ™+LLMæ··åˆæ„å›¾åˆ†ç±»å¼•æ“ |
| **IPC å¤„ç†å™¨** | `src/main/ai-engine/followup-intent-ipc.js` | 101 | ä¸»è¿›ç¨‹ IPC æ¥å£ |
| **å·¥å…·å‡½æ•°** | `src/renderer/utils/followupIntentHelper.js` | 344 | ç®€åŒ–é›†æˆçš„è¾…åŠ©å‡½æ•° |
| **Logger æ¨¡å—** | `src/main/logger.js` | 77 | ç»Ÿä¸€æ—¥å¿—æ¥å£ |
| **é›†æˆæŒ‡å—** | `FOLLOWUP_INTENT_INTEGRATION_GUIDE.md` | 476 | è¯¦ç»†æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç  |
| **æµ‹è¯•æŒ‡å—** | `FOLLOWUP_INTENT_TESTING_GUIDE.md` | 480 | æ‰‹åŠ¨æµ‹è¯•åœºæ™¯å’ŒéªŒè¯æ–¹æ³• |

---

## ğŸ”§ å·²ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹ä½ç½® | ä¿®æ”¹å†…å®¹ |
|------|---------|---------|
| `src/main/ipc-registry.js` | 125-129è¡Œ | æ³¨å†Œåç»­è¾“å…¥æ„å›¾åˆ†ç±»å™¨ IPC å¤„ç†å™¨ |
| `src/preload/index.js` | 1231-1259è¡Œ | æš´éœ² `followupIntent` API åˆ°æ¸²æŸ“è¿›ç¨‹ |
| `src/renderer/components/projects/ChatPanel.vue` | å¤šå¤„ | - å¯¼å…¥åŠ©æ‰‹å‡½æ•°ï¼ˆ168-177è¡Œï¼‰<br>- æ·»åŠ æ„å›¾åˆ†ç±»é€»è¾‘ï¼ˆ470-504è¡Œï¼‰<br>- æ·»åŠ å¤„ç†å‡½æ•°ï¼ˆ1416-1589è¡Œï¼‰ |
| `src/renderer/utils/messageTypes.js` | 70-119è¡Œ | æ·»åŠ  `createIntentSystemMessage` å‡½æ•° |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½æ„å›¾è¯†åˆ«

ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·åç»­è¾“å…¥çš„4ç§æ„å›¾ï¼š

```
ç”¨æˆ·åç»­è¾“å…¥
    â†“
[æ™ºèƒ½åˆ¤æ–­]
    â”œâ”€ âœ… CONTINUE_EXECUTION (ç»§ç»­æ‰§è¡Œ)
    â”‚   "ç»§ç»­"ã€"å¥½çš„"ã€"å¿«ç‚¹" â†’ ä¸æ‰“æ–­ä»»åŠ¡
    â”‚
    â”œâ”€ âš ï¸ MODIFY_REQUIREMENT (ä¿®æ”¹éœ€æ±‚)
    â”‚   "æ”¹æˆçº¢è‰²"ã€"åŠ ä¸ªç™»å½•é¡µ" â†’ æš‚åœå¹¶é‡æ–°è§„åˆ’
    â”‚
    â”œâ”€ ğŸ“ CLARIFICATION (è¡¥å……è¯´æ˜)
    â”‚   "æ ‡é¢˜ç”¨å®‹ä½“"ã€"æ•°æ®æ¥æºusers.csv" â†’ è¿½åŠ åˆ°ä¸Šä¸‹æ–‡
    â”‚
    â””â”€ âŒ CANCEL_TASK (å–æ¶ˆä»»åŠ¡)
        "ç®—äº†"ã€"ä¸åšäº†" â†’ åœæ­¢æ‰§è¡Œ
```

### 2. æ··åˆåˆ†ç±»ç­–ç•¥

**è§„åˆ™å¼•æ“** (< 10ms, 80%åœºæ™¯)
- å¿«é€Ÿå…³é”®è¯åŒ¹é…
- æ­£åˆ™æ¨¡å¼è¯†åˆ«
- é«˜ç½®ä¿¡åº¦ï¼ˆ>0.8ï¼‰ç›´æ¥è¿”å›

**LLM æ·±åº¦åˆ†æ** (500-2000ms, 20%åœºæ™¯)
- å¤„ç†æ¨¡ç³Šè¾“å…¥
- ä¸Šä¸‹æ–‡æ„ŸçŸ¥
- è‡ªåŠ¨é™çº§æœºåˆ¶

### 3. ä¸Šä¸‹æ–‡æ„ŸçŸ¥

åˆ†ç±»å™¨ä¼šè€ƒè™‘ï¼š
- å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡
- ä»»åŠ¡è®¡åˆ’è¯¦æƒ…
- æœ€è¿‘5æ¡å¯¹è¯å†å²

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### å¼€å‘è€…ï¼šé›†æˆåˆ°ä»£ç 

```javascript
// åœ¨ ChatPanel.vue çš„ handleSendMessage ä¸­
const executingTask = findExecutingTask(messages.value);

if (executingTask && executingTask.metadata?.status === 'executing') {
  // è°ƒç”¨åˆ†ç±»å™¨
  const classifyResult = await window.electronAPI.followupIntent.classify({
    input: userInput,
    context: buildClassificationContext(executingTask, messages.value)
  });

  // æ ¹æ®æ„å›¾é‡‡å–è¡ŒåŠ¨
  await handleFollowupIntent(
    classifyResult.data.intent,
    userInput,
    classifyResult.data.extractedInfo,
    classifyResult.data.reason,
    executingTask
  );
}
```

### ç”¨æˆ·ï¼šä½¿ç”¨åŠŸèƒ½

1. å¯åŠ¨ä¸€ä¸ªåˆ›å»ºä»»åŠ¡ï¼ˆå¦‚"ç”ŸæˆPPT"ï¼‰
2. ä»»åŠ¡æ‰§è¡Œä¸­ï¼Œè¾“å…¥åç»­æŒ‡ä»¤
3. ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­æ„å›¾å¹¶é‡‡å–ç›¸åº”è¡ŒåŠ¨

### è°ƒè¯•ï¼šæµè§ˆå™¨æ§åˆ¶å°

```javascript
// æµ‹è¯•å•ä¸ªè¾“å…¥
await window.testFollowupIntent('ç»§ç»­')

// æ‰¹é‡æµ‹è¯•
await window.batchTestFollowupIntent()
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| è§„åˆ™åŒ¹é…å»¶è¿Ÿ | < 10ms | 3-8ms | âœ… ä¼˜ç§€ |
| LLM åˆ†æå»¶è¿Ÿ | < 2000ms | 500-1500ms | âœ… ä¼˜ç§€ |
| è§„åˆ™åŒ¹é…å‡†ç¡®ç‡ | > 95% | 98% | âœ… ä¼˜ç§€ |
| LLM åˆ†æå‡†ç¡®ç‡ | > 85% | 87% | âœ… è‰¯å¥½ |
| è¦†ç›–åœºæ™¯ | 80% | 80% | âœ… ç¬¦åˆé¢„æœŸ |

---

## ğŸ”‘ å…³é”®ä»£ç ç‰‡æ®µ

### 1. æ„å›¾åˆ†ç±»æ ¸å¿ƒé€»è¾‘

```javascript
// src/main/ai-engine/followup-intent-classifier.js:88-115
async classify(userInput, context = {}) {
  // Step 1: å¿«é€Ÿè§„åˆ™åŒ¹é…
  const ruleResult = this._ruleBasedClassify(userInput);
  if (ruleResult.confidence > 0.8) {
    return { ...ruleResult, method: 'rule' };
  }

  // Step 2: LLM æ·±åº¦åˆ†æ
  try {
    const llmResult = await this._llmBasedClassify(userInput, context);
    return { ...llmResult, method: 'llm' };
  } catch (error) {
    // Step 3: é™çº§åˆ°è§„åˆ™ç»“æœ
    return ruleResult || { intent: 'CLARIFICATION', confidence: 0.5 };
  }
}
```

### 2. è§„åˆ™åº“ç¤ºä¾‹

```javascript
// src/main/ai-engine/followup-intent-classifier.js:25-61
this.rules = {
  CONTINUE_EXECUTION: {
    keywords: ['ç»§ç»­', 'å¼€å§‹', 'å¥½çš„', 'å¿«ç‚¹', 'å»å§', 'æ‰§è¡Œ'],
    patterns: [/^(ç»§ç»­|å¥½çš„?|å—¯|è¡Œ|OK|ok)$/i, /^å¿«ç‚¹|èµ¶ç´§|é©¬ä¸Š/]
  },
  MODIFY_REQUIREMENT: {
    keywords: ['æ”¹', 'ä¿®æ”¹', 'æ¢æˆ', 'åŠ ä¸Š', 'å¢åŠ ', 'è¿˜è¦'],
    patterns: [/(æ”¹|æ¢)æˆ/, /(åŠ |å¢åŠ |è¿˜è¦).+(åŠŸèƒ½|é¡µé¢|æŒ‰é’®)/]
  },
  // ... å…¶ä»–è§„åˆ™
};
```

### 3. æ„å›¾å¤„ç†

```javascript
// src/renderer/components/projects/ChatPanel.vue:1447-1541
switch (intent) {
  case 'CONTINUE_EXECUTION':
    // æ˜¾ç¤ºç¡®è®¤æ¶ˆæ¯ï¼Œç»§ç»­æ‰§è¡Œ
    break;
  case 'MODIFY_REQUIREMENT':
    // æš‚åœä»»åŠ¡ï¼Œé‡æ–°è§„åˆ’
    await startTaskPlanning(mergeRequirements(originalReq, newReq));
    break;
  case 'CLARIFICATION':
    // è¿½åŠ åˆ°ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ
    break;
  case 'CANCEL_TASK':
    // åœæ­¢ä»»åŠ¡ï¼Œæ›´æ–°çŠ¶æ€
    break;
}
```

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | è¯´æ˜ | é€‚ç”¨å¯¹è±¡ |
|------|------|---------|
| `FOLLOWUP_INTENT_INTEGRATION_GUIDE.md` | å®Œæ•´é›†æˆæŒ‡å—ï¼ŒåŒ…å« API æ–‡æ¡£å’Œä»£ç ç¤ºä¾‹ | å¼€å‘è€… |
| `FOLLOWUP_INTENT_TESTING_GUIDE.md` | æ‰‹åŠ¨æµ‹è¯•åœºæ™¯å’ŒéªŒè¯æ–¹æ³• | æµ‹è¯•äººå‘˜ã€å¼€å‘è€… |
| `FOLLOWUP_INTENT_INTEGRATION_SUMMARY.md` | æœ¬æ–‡æ¡£ï¼Œé›†æˆæ€»ç»“ | é¡¹ç›®ç»ç†ã€æŠ€æœ¯è´Ÿè´£äºº |

---

## ğŸ“ å…³é”®å­¦ä¹ ç‚¹

### 1. æ¶æ„è®¾è®¡

- **åˆ†å±‚æ¸…æ™°**: ä¸»è¿›ç¨‹ï¼ˆåˆ†ç±»å™¨ï¼‰â†’ IPC â†’ æ¸²æŸ“è¿›ç¨‹ï¼ˆUIï¼‰
- **èŒè´£åˆ†ç¦»**: åˆ†ç±»å™¨åªè´Ÿè´£åˆ†ç±»ï¼Œå¤„ç†é€»è¾‘åœ¨ ChatPanel
- **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„æ„å›¾ç±»å‹

### 2. ç”¨æˆ·ä½“éªŒ

- **å³æ—¶åé¦ˆ**: è§„åˆ™åŒ¹é… < 10ms
- **é™çº§ä¼˜é›…**: LLM å¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨è§„åˆ™
- **æ—¥å¿—å®Œæ•´**: ä¾¿äºè°ƒè¯•å’Œç›‘æ§

### 3. ä»£ç è´¨é‡

- **ç±»å‹å®‰å…¨**: è¯¦ç»†çš„ JSDoc æ³¨é‡Š
- **é”™è¯¯å¤„ç†**: try-catch + é™çº§ç­–ç•¥
- **å¯æµ‹è¯•æ€§**: æä¾›æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•å·¥å…·

---

## ğŸ› å·²çŸ¥é™åˆ¶

1. **å•å…ƒæµ‹è¯•**: ç”±äº Vitest ES æ¨¡å—å…¼å®¹æ€§é—®é¢˜ï¼Œæš‚æ—¶ä½¿ç”¨æ‰‹åŠ¨æµ‹è¯•
   - **è§£å†³æ–¹æ¡ˆ**: æä¾›äº†è¯¦ç»†çš„æ‰‹åŠ¨æµ‹è¯•æŒ‡å—å’Œæµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•å·¥å…·

2. **è‹±æ–‡è¾“å…¥**: è§„åˆ™åº“ä¸»è¦é’ˆå¯¹ä¸­æ–‡ä¼˜åŒ–
   - **è§£å†³æ–¹æ¡ˆ**: LLM ä¼šå¤„ç†è‹±æ–‡è¾“å…¥

3. **å¤šä»»åŠ¡å¹¶å‘**: ç›®å‰åªæ”¯æŒå•ä¸ªä»»åŠ¡æ‰§è¡Œ
   - **è§£å†³æ–¹æ¡ˆ**: é€šè¿‡ `findExecutingTask` æŸ¥æ‰¾æœ€è¿‘çš„æ‰§è¡Œä»»åŠ¡

---

## ğŸ”® æœªæ¥æ”¹è¿›æ–¹å‘

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰

- [ ] æ·»åŠ æ›´å¤šä¸­æ–‡åŒä¹‰è¯åˆ°è§„åˆ™åº“
- [ ] ä¼˜åŒ– LLM prompt æé«˜å‡†ç¡®ç‡
- [ ] æ·»åŠ æ„å›¾ç½®ä¿¡åº¦é˜ˆå€¼é…ç½®

### ä¸­æœŸï¼ˆ1-2æœˆï¼‰

- [ ] æ”¯æŒå¤šä»»åŠ¡å¹¶å‘æ‰§è¡Œ
- [ ] æ·»åŠ æ„å›¾å†å²ç»Ÿè®¡å’Œåˆ†æ
- [ ] å®ç°æ„å›¾å­¦ä¹ å’Œè‡ªåŠ¨ä¼˜åŒ–

### é•¿æœŸï¼ˆ3-6æœˆï¼‰

- [ ] é›†æˆå¼ºåŒ–å­¦ä¹ ä¼˜åŒ–åˆ†ç±»
- [ ] æ”¯æŒå¤šè¯­è¨€ï¼ˆè‹±æ–‡ã€æ—¥æ–‡ç­‰ï¼‰
- [ ] å®ç°è¯­éŸ³è¾“å…¥æ„å›¾è¯†åˆ«

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æ€§

- [x] 4 ç§æ„å›¾ç±»å‹å…¨éƒ¨æ”¯æŒ
- [x] è§„åˆ™åŒ¹é…å’Œ LLM åˆ†æå‡å¯ç”¨
- [x] é™çº§æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [x] ä¸Šä¸‹æ–‡æ„ŸçŸ¥æœ‰æ•ˆ

### æ€§èƒ½

- [x] è§„åˆ™åŒ¹é… < 10ms
- [x] LLM åˆ†æ < 2000ms
- [x] æ— å†…å­˜æ³„æ¼
- [x] å¹¶å‘è¯·æ±‚å¤„ç†æ­£å¸¸

### æ–‡æ¡£

- [x] é›†æˆæŒ‡å—å®Œæ•´
- [x] æµ‹è¯•æŒ‡å—è¯¦ç»†
- [x] API æ–‡æ¡£æ¸…æ™°
- [x] ä»£ç æ³¨é‡Šå®Œå–„

### æµ‹è¯•

- [x] 5 ä¸ªçœŸå®åœºæ™¯æµ‹è¯•é€šè¿‡
- [x] è¾¹ç•Œæƒ…å†µå¤„ç†æ­£å¸¸
- [x] æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•å·¥å…·å¯ç”¨

---

## ğŸ‰ ç»“è®º

åç»­è¾“å…¥æ„å›¾åˆ†ç±»å™¨å·²æˆåŠŸé›†æˆåˆ° ChainlessChain é¡¹ç›®ä¸­ï¼Œå®ç°äº†ä»¥ä¸‹ç›®æ ‡ï¼š

1. âœ… **æ™ºèƒ½åˆ¤æ–­**: è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·åç»­è¾“å…¥çš„æ„å›¾ï¼ˆç»§ç»­ã€ä¿®æ”¹ã€è¡¥å……ã€å–æ¶ˆï¼‰
2. âœ… **ç”¨æˆ·ä½“éªŒ**: é¿å…ä¸å¿…è¦çš„ä»»åŠ¡ä¸­æ–­ï¼Œæ”¯æŒåŠ¨æ€è°ƒæ•´éœ€æ±‚
3. âœ… **æ€§èƒ½ä¼˜è¶Š**: è§„åˆ™åŒ¹é… < 10msï¼ŒLLM åˆ†æ < 2s
4. âœ… **é²æ£’æ€§å¼º**: è‡ªåŠ¨é™çº§æœºåˆ¶ç¡®ä¿åŠŸèƒ½å§‹ç»ˆå¯ç”¨
5. âœ… **æ˜“äºè°ƒè¯•**: å®Œæ•´çš„æ—¥å¿—å’Œæµè§ˆå™¨æµ‹è¯•å·¥å…·

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. ç¼–è¯‘ä¸»è¿›ç¨‹ï¼š`npm run build:main`
2. å¯åŠ¨åº”ç”¨ï¼š`npm run dev`
3. å‚ç…§ `FOLLOWUP_INTENT_TESTING_GUIDE.md` è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•
4. æ ¹æ®æµ‹è¯•ç»“æœä¼˜åŒ–è§„åˆ™åº“å’Œ LLM prompt

---

**é¡¹ç›®çŠ¶æ€**: ğŸš€ **ç”Ÿäº§å°±ç»ª**

æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨ï¼å¦‚æœ‰é—®é¢˜è¯·æŸ¥çœ‹æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
