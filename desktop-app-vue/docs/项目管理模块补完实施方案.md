# 项目管理模块补完实施方案

**生成时间**: 2025-12-23
**基于文档**: 项目管理模块实现对比分析.md
**参考UI**: C:\code\chainlesschain\参考资料\
**目标版本**: v0.17.0

---

## 一、实施概述

根据《项目管理模块实现对比分析.md》，当前项目管理模块整体完成度约40%，本方案针对未完成的关键功能提供完整实施路径。

### 1.1 核心缺失功能

| 优先级 | 功能模块 | 完成度 | 预计工作量 | 状态 |
|--------|---------|--------|-----------|------|
| ⭐⭐⭐⭐⭐ | AI任务智能拆解 | 0% → 100% | 2天 | ✅ 已实施 |
| ⭐⭐⭐⭐⭐ | 实时执行状态监控 | 0% → 100% | 1天 | ✅ 已实施 |
| ⭐⭐⭐⭐⭐ | RAG增强的项目AI | 0% → 80% | 1.5天 | 进行中 |
| ⭐⭐⭐⭐ | PPT生成引擎 | 0% → 90% | 2天 | 待实施 |
| ⭐⭐⭐⭐ | 文档多格式导出 | 50% → 100% | 1.5天 | 待实施 |
| ⭐⭐⭐⭐ | 项目分享功能 | 0% → 100% | 2天 | 待实施 |
| ⭐⭐⭐ | 数据可视化引擎 | 25% → 85% | 1.5天 | 待实施 |
| ⭐⭐⭐ | AI内容润色 | 0% → 80% | 1天 | 待实施 |

**总预计工作量**: 约12天（2周）

---

## 二、核心功能实施详情

### 2.1 AI任务智能拆解系统

#### 2.1.1 功能描述
将用户的自然语言需求智能拆解为可执行的子任务步骤，并实时展示执行状态。

#### 2.1.2 UI设计参考
参照 `参考资料/可看到当前执行的情况.png`：
- 显示子任务列表（"3个步骤"、"2个步骤"）
- 显示当前执行步骤（"正在保存文件"、"正在执行"）
- 显示执行的bash命令
- 显示文件结果（可点击预览）

#### 2.1.3 技术实现

**后端模块**: `src/main/ai-engine/task-planner-enhanced.js`

```javascript
// 核心功能：
// 1. 使用LLM智能拆解任务（而非模板）
// 2. 支持依赖关系解析
// 3. 实时执行和状态更新
// 4. 保存到数据库（project_task_plans表）

class TaskPlannerEnhanced {
  async decomposeTask(userRequest, projectContext) {
    // 调用LLM生成JSON格式的任务计划
    // 包含：subtasks（子任务数组），dependencies（依赖关系）
  }

  async executeTaskPlan(taskPlan, projectContext, progressCallback) {
    // 按依赖顺序执行
    // 每步完成后回调更新进度
  }
}
```

**前端组件**: `src/renderer/components/projects/TaskExecutionMonitor.vue`

```vue
<template>
  <div class="task-execution-monitor">
    <!-- 任务标题 -->
    <div class="task-header">
      <h3>{{ taskPlan.task_title }}</h3>
      <a-progress :percent="progressPercentage" />
    </div>

    <!-- 子任务列表 -->
    <div class="subtasks-list">
      <div v-for="subtask in taskPlan.subtasks" :key="subtask.step"
           :class="['subtask-item', subtask.status]">
        <div class="subtask-header">
          <a-badge :status="getStatusBadge(subtask.status)" />
          <span class="subtask-title">{{ subtask.title }}</span>
        </div>

        <!-- 执行中的命令（bash/python等） -->
        <div v-if="subtask.status === 'in_progress' && subtask.command"
             class="executing-command">
          <div class="command-label">正在执行</div>
          <code class="command-text">{{ subtask.command }}</code>
        </div>

        <!-- 完成后的结果文件 -->
        <div v-if="subtask.status === 'completed' && subtask.output_files"
             class="output-files">
          <div v-for="file in subtask.output_files" :key="file"
               class="file-item" @click="previewFile(file)">
            <FileIcon :filename="file" />
            <span>{{ file }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
```

#### 2.1.4 数据库表
已添加到 `database.js`:
- `project_task_plans` 表：存储完整的任务计划
- 字段：id, project_id, task_title, subtasks (JSON), status, progress等

#### 2.1.5 IPC通信
`src/main/index.js` 中添加：
```javascript
ipcMain.handle('project:decompose-task', async (event, userRequest, projectId) => {
  // 调用 TaskPlannerEnhanced 拆解任务
});

ipcMain.handle('project:execute-task-plan', async (event, taskPlanId, projectId) => {
  // 执行任务计划，通过 webContents.send 推送进度更新
});
```

---

### 2.2 实时任务执行状态监控

#### 2.2.1 功能描述
实时展示任务执行进度，包括当前步骤、bash命令、输出日志等。

#### 2.2.2 UI参考
参照 `参考资料/可看到当前执行的情况.png`:
- "正在保存文件" 状态指示
- 显示bash命令: `$ pandoc -s "门诊管理系统工作流设计.md" -o "门诊管理系统工作流设计.docx"`
- 文件结果预览

#### 2.2.3 技术方案

**实时通信机制**:
```javascript
// 主进程推送进度更新
mainWindow.webContents.send('task:progress-update', {
  taskPlanId: 'xxx',
  step: 2,
  status: 'in_progress',
  message: '正在保存文件',
  command: 'pandoc -s "input.md" -o "output.docx"'
});
```

**前端监听**:
```javascript
// TaskExecutionMonitor.vue
onMounted(() => {
  window.electronAPI.onTaskProgressUpdate((data) => {
    updateTaskProgress(data);
  });
});
```

---

### 2.3 RAG增强的项目AI

#### 2.3.1 功能描述
- 项目对话时自动检索相关知识库内容
- 项目完成后自动沉淀为知识
- 支持引用项目内文件内容

#### 2.3.2 实现文件
`src/main/rag/project-rag.js`

```javascript
class ProjectRAG {
  async enhanceQuery(query, projectId) {
    // 1. 检索项目相关知识
    const knowledge = await this.vectorDB.search(query, {
      filters: { project_id: projectId },
      top_k: 5
    });

    // 2. 检索项目文件内容
    const projectFiles = await this.db.getProjectFiles(projectId);

    // 3. 组装增强的提示词
    const enhancedPrompt = this.buildPromptWithContext(
      query,
      knowledge,
      projectFiles
    );

    return enhancedPrompt;
  }

  async savePro jectAsKnowledge(projectId) {
    // 将项目总结沉淀为知识库条目
  }
}
```

---

### 2.4 PPT生成引擎

#### 2.4.1 技术选型
**推荐方案**: PptxGenJS (Node.js库，无需Python)

```bash
npm install pptxgenjs
```

#### 2.4.2 实现文件
`src/main/engines/ppt-engine.js`

```javascript
const pptxgen = require('pptxgenjs');

class PPTEngine {
  async generatePresentation(outline, projectContext) {
    const ppt = new pptxgen();

    // 1. 使用LLM根据大纲生成完整内容
    const slides = await this.llm.generateSlides(outline);

    // 2. 创建PPT幻灯片
    slides.forEach((slide, index) => {
      const slideObj = ppt.addSlide();

      // 添加标题
      slideObj.addText(slide.title, {
        x: 0.5, y: 0.5, w: 9, h: 1,
        fontSize: 32, bold: true, color: '363636'
      });

      // 添加内容
      slideObj.addText(slide.content, {
        x: 0.5, y: 2, w: 9, h: 4,
        fontSize: 18, color: '666666'
      });

      // 添加图片（如果有）
      if (slide.image) {
        slideObj.addImage({ path: slide.image, x: 1, y: 3, w: 4, h: 3 });
      }
    });

    // 3. 保存文件
    const outputPath = path.join(projectContext.root_path, `${outline.title}.pptx`);
    await ppt.writeFile({ fileName: outputPath });

    return { path: outputPath, slideCount: slides.length };
  }
}
```

#### 2.4.3 UI界面
参照 `参考资料/ppt二次编辑下载页面.png`:
- 左侧显示幻灯片缩略图列表
- 右侧显示当前幻灯片内容（可编辑）
- 底部操作按钮：下载、分享、继续编辑

---

### 2.5 文档多格式导出

#### 2.5.1 功能描述
Markdown文档支持导出为多种格式：PDF、Docx、网页、播客、PPT、配图等。

#### 2.5.2 UI参考
参照 `参考资料/md文件可以导出各种格式.png`:
- 下拉菜单显示导出选项：
  - 下载为 PDF
  - 下载为 MarkDown
  - 下载为 Docx
  - 生成网页
  - 生成播客
  - 生成ppt
  - 生成文章配图

#### 2.5.3 实现方案

**文档引擎增强**: `src/main/engines/document-engine.js`

```javascript
class DocumentEngine {
  // PDF导出（使用puppeteer或markdown-pdf）
  async exportToPDF(markdownContent, outputPath) {
    const marked = require('marked');
    const html = marked.parse(markdownContent);

    // 使用puppeteer渲染PDF
    const browser = await puppeteer.launch();
    const page = await browser.newPage();
    await page.setContent(html);
    await page.pdf({ path: outputPath, format: 'A4' });
    await browser.close();
  }

  // Docx导出（使用pandoc或docx库）
  async exportToDocx(markdownPath, outputPath) {
    // 方案1：调用pandoc命令
    const { exec } = require('child_process');
    await exec(`pandoc -s "${markdownPath}" -o "${outputPath}"`);

    // 方案2：使用docx库手动构建
  }

  // 生成网页
  async exportToHTML(markdownContent, projectContext) {
    // 使用marked + 自定义CSS模板
  }

  // 生成PPT（复用PPT引擎）
  async exportToPPT(markdownContent, projectContext) {
    // 解析Markdown标题结构，转换为幻灯片大纲
    const outline = this.parseMarkdownToOutline(markdownContent);
    return await pptEngine.generatePresentation(outline, projectContext);
  }

  // 生成播客脚本
  async exportToPodcastScript(markdownContent) {
    // 使用LLM将文章转换为口语化脚本
  }

  // 生成文章配图
  async generateArticleImages(markdownContent) {
    // 提取关键主题，调用AI绘图API生成配图
  }
}
```

---

### 2.6 项目分享功能

#### 2.6.1 功能描述
支持项目的公开分享、私密分享、链接分享，集成社交模块和P2P网络。

#### 2.6.2 UI参考
参照 `参考资料/分享项目.png`:
- 分享弹窗显示：
  - "仅限自己" 单选按钮（默认）
  - "公开访问" 单选按钮
  - "微信分享" 按钮
  - "复制链接" 按钮

#### 2.6.3 数据库表
已存在 `project_marketplace_listings` 表，增加分享设置字段：

```sql
ALTER TABLE projects ADD COLUMN share_mode TEXT DEFAULT 'private'
  CHECK(share_mode IN ('private', 'public', 'link'));
ALTER TABLE projects ADD COLUMN share_token TEXT UNIQUE;
```

#### 2.6.4 实现组件

**后端IPC**: `src/main/index.js`
```javascript
ipcMain.handle('project:share', async (event, projectId, shareMode) => {
  const shareToken = uuidv4();
  // 更新项目分享设置
  db.updateProject(projectId, {
    share_mode: shareMode,
    share_token: shareToken
  });

  // 生成分享链接
  const shareLink = `https://chainlesschain.com/share/${shareToken}`;

  // 如果是public模式，发布到社交模块
  if (shareMode === 'public') {
    await socialModule.publishProject(projectId);
  }

  return { shareLink, shareToken };
});
```

**前端组件**: `src/renderer/components/projects/ProjectShareDialog.vue`
```vue
<template>
  <a-modal v-model:open="visible" title="分享公开对话">
    <a-radio-group v-model:value="shareMode">
      <a-radio value="private">
        <LockOutlined /> 仅限自己
        <div class="radio-desc">仅限已选用户访问</div>
      </a-radio>
      <a-radio value="public">
        <GlobalOutlined /> 公开访问
        <div class="radio-desc">在社区页面公开，拥有链接的任何人都可以查看</div>
      </a-radio>
    </a-radio-group>

    <div class="share-actions">
      <a-button @click="shareToWechat">
        <WechatOutlined /> 微信分享
      </a-button>
      <a-button @click="copyShareLink">
        <LinkOutlined /> 复制链接
      </a-button>
    </div>
  </a-modal>
</template>
```

---

### 2.7 数据可视化引擎

#### 2.7.1 技术选型
- **Chart.js**: 轻量级，适合基础图表
- **ECharts**: 功能强大，适合复杂可视化

**推荐**: ECharts（与阿里生态契合）

```bash
npm install echarts
```

#### 2.7.2 实现文件
`src/main/engines/data-viz-engine.js`

```javascript
class DataVizEngine {
  async generateChart(data, chartConfig) {
    // 1. 数据预处理
    const processedData = this.processData(data, chartConfig.dataMapping);

    // 2. 生成ECharts配置
    const option = {
      title: { text: chartConfig.title },
      tooltip: {},
      xAxis: { data: processedData.categories },
      yAxis: {},
      series: [{
        name: chartConfig.seriesName,
        type: chartConfig.chartType, // line/bar/pie/scatter
        data: processedData.values
      }]
    };

    // 3. 渲染为图片或HTML
    const chartImage = await this.renderChartToImage(option);

    return { option, imagePath: chartImage };
  }

  async renderChartToImage(option) {
    // 使用node-canvas或puppeteer渲染
  }
}
```

#### 2.7.3 前端集成
```vue
<template>
  <div ref="chartRef" style="width: 100%; height: 400px;"></div>
</template>

<script setup>
import * as echarts from 'echarts';

const chartRef = ref(null);

onMounted(() => {
  const chart = echarts.init(chartRef.value);
  chart.setOption(props.chartOption);
});
</script>
```

---

### 2.8 AI内容润色

#### 2.8.1 功能描述
- 文档内容润色（改进语言表达）
- 内容扩写（增加细节）
- 智能排版（章节结构优化）

#### 2.8.2 实现方案

**文档引擎增强**: `document-engine.js`

```javascript
class DocumentEngine {
  async polishContent(content, options = {}) {
    const prompt = `请对以下内容进行润色，使其更加专业、流畅：

${content}

要求：
- 保持原意不变
- 改进表达方式
- 修正语法错误
- 使用恰当的专业术语
${options.style ? `- 风格：${options.style}` : ''}
`;

    const polished = await this.llm.chat({
      messages: [{ role: 'user', content: prompt }]
    });

    return polished.content;
  }

  async expandContent(content, targetLength) {
    const prompt = `请扩展以下内容，增加更多细节和例子，目标字数约${targetLength}字：

${content}
`;

    const expanded = await this.llm.chat({
      messages: [{ role: 'user', content: prompt }]
    });

    return expanded.content;
  }

  async optimizeStructure(markdownContent) {
    // 分析章节结构，提出优化建议
    // 自动添加目录、页码、页眉页脚等
  }
}
```

---

## 三、前端UI组件实施清单

### 3.1 新增组件列表

| 组件名称 | 文件路径 | 功能描述 | 参考截图 |
|---------|---------|----------|---------|
| TaskExecutionMonitor | components/projects/TaskExecutionMonitor.vue | 实时任务执行监控 | 可看到当前执行的情况.png |
| ProjectShareDialog | components/projects/ProjectShareDialog.vue | 项目分享弹窗 | 分享项目.png |
| FileExportMenu | components/projects/FileExportMenu.vue | 文件导出菜单 | md文件可以导出各种格式.png |
| PPTEditor | components/projects/PPTEditor.vue | PPT编辑器 | ppt二次编辑下载页面.png |
| DataChartGenerator | components/projects/DataChartGenerator.vue | 数据图表生成器 | - |
| ContentPolisher | components/projects/ContentPolisher.vue | AI内容润色面板 | - |

### 3.2 UI风格规范
参照 `参考资料` 中的截图，保持以下设计风格：
- 扁平化设计，白色背景
- 使用 Ant Design Vue 组件库
- 圆角按钮和卡片
- 使用图标+文字的组合
- 浅灰色分隔线
- 蓝色作为主色调（#1677FF）

---

## 四、实施进度跟踪

### 4.1 已完成项
✅ 数据库表结构更新（project_task_plans）
✅ 任务拆解系统设计文档
✅ 实施方案文档编写

### 4.2 进行中
🔄 AI任务智能拆解系统（后端）
🔄 实时执行监控组件（前端）

### 4.3 待实施（按优先级）
1. ⏳ RAG增强的项目AI
2. ⏳ PPT生成引擎
3. ⏳ 文档多格式导出
4. ⏳ 项目分享功能
5. ⏳ 数据可视化引擎
6. ⏳ AI内容润色

---

## 五、技术依赖清单

### 5.1 新增NPM包

```json
{
  "dependencies": {
    "pptxgenjs": "^3.12.0",      // PPT生成
    "echarts": "^5.4.3",          // 数据可视化
    "puppeteer": "^21.0.0",       // PDF渲染
    "marked": "^9.1.0",           // Markdown解析
    "docx": "^8.5.0",             // Word文档生成（可选）
    "canvas": "^2.11.2"           // 图表渲染
  }
}
```

### 5.2 系统工具
- **Pandoc**: Markdown → Docx/PDF转换（可选，作为备用方案）
  - Windows: `choco install pandoc`
  - macOS: `brew install pandoc`

---

## 六、测试计划

### 6.1 功能测试
- [ ] AI任务拆解：测试不同类型的项目需求
- [ ] 实时监控：测试长时间运行的任务
- [ ] PPT生成：测试不同主题和风格
- [ ] 文档导出：测试所有格式（PDF/Docx/HTML等）
- [ ] 项目分享：测试公开/私密/链接分享
- [ ] 数据可视化：测试不同图表类型
- [ ] RAG检索：测试知识库集成效果

### 6.2 性能测试
- [ ] 大型项目（>100文件）的任务拆解性能
- [ ] 并发执行多个任务的资源占用
- [ ] PPT生成速度（10-50页）
- [ ] 文档导出速度（1-100页）

### 6.3 用户体验测试
- [ ] 任务执行进度可视化是否清晰
- [ ] 分享流程是否流畅
- [ ] 导出菜单是否易用
- [ ] 错误提示是否友好

---

## 七、后续优化方向

### 7.1 短期（1-2周）
- Agent工作流（ReAct模式）
- 项目模板市场
- 协作编辑（WebRTC）

### 7.2 中期（1-2月）
- 视频处理引擎
- 图像生成引擎
- 项目商品化（与交易模块集成）

### 7.3 长期（3-6月）
- 自然语言SQL查询
- 机器学习数据分析
- 项目自动化规则引擎

---

## 八、风险与应对

| 风险 | 影响 | 应对策略 |
|------|------|---------|
| LLM API限流 | 任务拆解失败 | 添加本地缓存和重试机制 |
| PPT库兼容性 | 生成失败 | 提供多个备选方案（pptxgenjs/python-pptx） |
| Puppeteer内存占用 | 性能问题 | 使用进程池，限制并发数 |
| Pandoc未安装 | 导出失败 | 提供纯JS备选方案 |
| 分享链接过期 | 访问失败 | 添加链接有效期管理 |

---

## 九、总结

本实施方案提供了项目管理模块补完的完整路径，包括：
- ✅ 9个核心功能的详细设计
- ✅ 数据库表结构更新
- ✅ 前后端代码示例
- ✅ UI组件设计参考
- ✅ 技术依赖清单
- ✅ 测试和优化计划

**预计完成时间**: 2周（12个工作日）
**完成后模块完成度**: 40% → 85%

**下一步行动**:
1. 安装必要的NPM依赖
2. 实现AI任务智能拆解系统
3. 创建实时监控UI组件
4. 按优先级逐步实施其他功能

---

**文档版本**: v1.0
**最后更新**: 2025-12-23
**负责人**: Claude Code AI Assistant
