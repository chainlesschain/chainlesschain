# P2P通话功能用户使用指南

## 目录
1. [功能概述](#功能概述)
2. [快速开始](#快速开始)
3. [语音通话](#语音通话)
4. [视频通话](#视频通话)
5. [屏幕共享](#屏幕共享)
6. [通话历史](#通话历史)
7. [常见问题](#常见问题)
8. [故障排除](#故障排除)

## 功能概述

ChainlessChain提供完整的P2P通话功能，包括：

- **语音通话** - 高质量的点对点语音通话
- **视频通话** - 支持720p/1080p的视频通话
- **屏幕共享** - 共享整个屏幕或特定窗口
- **通话历史** - 查看所有通话记录和统计信息
- **自动重连** - 网络中断后自动恢复连接

### 技术特性

- ✅ 端到端加密（DTLS/SRTP）
- ✅ NAT穿透（STUN/TURN）
- ✅ 自动质量调节
- ✅ 回声消除和噪声抑制
- ✅ 低延迟（<200ms）

## 快速开始

### 前置条件

1. **网络连接** - 确保设备已连接到互联网
2. **设备权限** - 授予麦克风和摄像头权限
3. **好友关系** - 需要先添加对方为好友

### 首次使用

1. 打开ChainlessChain应用
2. 进入"聊天"或"好友"页面
3. 选择要通话的好友
4. 点击通话按钮开始

## 语音通话

### 发起语音通话

1. **从聊天窗口发起**
   - 打开与好友的聊天窗口
   - 点击顶部的电话图标 📞
   - 等待对方接听

2. **从好友列表发起**
   - 打开好友列表
   - 找到要通话的好友
   - 点击好友卡片上的电话图标

### 接听来电

当收到来电时：

1. 屏幕会弹出来电通知
2. 显示来电者的信息
3. 点击"接听"按钮接听通话
4. 或点击"拒绝"按钮拒绝通话

### 通话控制

在通话过程中，您可以：

- **静音/取消静音** - 点击麦克风图标
- **挂断通话** - 点击红色挂断按钮
- **查看通话时长** - 显示在通话窗口顶部
- **查看通话质量** - 信号强度指示器

### 通话质量指标

- 🟢 **优秀** - 延迟 < 100ms
- 🟡 **良好** - 延迟 100-200ms
- 🟠 **一般** - 延迟 200-500ms
- 🔴 **较差** - 延迟 > 500ms

## 视频通话

### 发起视频通话

1. 打开聊天窗口
2. 点击顶部的视频图标 📹
3. 等待对方接听
4. 接听后会显示双方的视频画面

### 视频画面布局

- **远程视频** - 占据主要区域
- **本地视频** - 画中画模式，显示在右下角
- **可拖动** - 本地视频可以拖动到其他位置

### 视频控制

- **开启/关闭视频** - 点击摄像头图标
- **静音/取消静音** - 点击麦克风图标
- **切换摄像头** - 在设置中选择（如果有多个摄像头）
- **调整分辨率** - 自动根据网络状况调整

### 视频质量设置

支持的分辨率：
- **720p** (1280x720) - 推荐，平衡质量和带宽
- **1080p** (1920x1080) - 高质量，需要更好的网络
- **480p** (640x480) - 低带宽模式

## 屏幕共享

### 发起屏幕共享

1. 打开聊天窗口
2. 点击顶部的屏幕共享图标 🖥️
3. 选择要共享的屏幕或窗口

### 选择共享内容

屏幕共享选择器提供两个选项：

#### 1. 整个屏幕
- 共享整个屏幕的所有内容
- 适合演示和教学
- 对方可以看到您的所有操作

#### 2. 应用窗口
- 只共享特定应用程序的窗口
- 更加隐私和专注
- 对方只能看到选定的窗口

### 屏幕共享控制

- **暂停共享** - 临时停止共享（计划中）
- **停止共享** - 结束屏幕共享
- **切换共享源** - 更换共享的屏幕或窗口（计划中）

### 注意事项

⚠️ **隐私提示**
- 共享屏幕前请关闭敏感信息
- 注意通知和弹窗可能被对方看到
- 建议使用窗口共享而非全屏共享

⚠️ **性能提示**
- 屏幕共享会占用更多带宽
- 建议在良好的网络环境下使用
- 关闭不必要的后台程序

## 通话历史

### 查看通话记录

1. 点击侧边栏的"通话记录"
2. 或访问 `/call-history` 路由
3. 查看所有通话记录

### 通话记录信息

每条记录显示：
- **通话类型** - 语音/视频/屏幕共享
- **对方信息** - 昵称或DID
- **通话状态** - 已接通/已拒绝/未接听/失败
- **通话时间** - 开始时间
- **通话时长** - 持续时间（如果接通）

### 过滤和搜索

- **按类型过滤** - 全部/语音/视频/屏幕共享
- **刷新列表** - 点击刷新按钮
- **查看详情** - 点击记录查看详细信息

### 通话详情

点击记录可查看：
- 通话类型和状态
- 对方信息
- 开始和结束时间
- 通话时长
- 发起方
- **通话质量统计**
  - 发送/接收字节数
  - 丢包率
  - 抖动
  - 往返时间（RTT）

### 管理记录

- **再次呼叫** - 快速发起新通话
- **删除记录** - 删除单条记录
- **清空所有** - 清空所有通话记录

## 常见问题

### Q: 为什么听不到对方的声音？

A: 请检查：
1. 音量是否调到最低
2. 是否开启了静音
3. 扬声器是否正常工作
4. 对方是否开启了静音

### Q: 为什么对方看不到我的视频？

A: 请检查：
1. 是否授予了摄像头权限
2. 摄像头是否被其他应用占用
3. 是否关闭了视频
4. 网络连接是否稳定

### Q: 通话质量不好怎么办？

A: 建议：
1. 检查网络连接质量
2. 关闭其他占用带宽的应用
3. 尝试切换到语音通话
4. 移动到网络信号更好的位置

### Q: 屏幕共享看不清楚？

A: 可以：
1. 检查网络带宽是否足够
2. 降低共享的分辨率
3. 关闭不必要的窗口和动画
4. 使用窗口共享而非全屏共享

### Q: 通话突然中断了？

A: 可能原因：
1. 网络连接中断
2. 对方主动挂断
3. 应用崩溃
4. 系统进入休眠

系统会自动尝试重连，如果失败请手动重新发起通话。

### Q: 如何提高通话质量？

A: 建议：
1. 使用有线网络而非WiFi
2. 关闭VPN（如果不需要）
3. 确保网络带宽充足
4. 使用耳机减少回声
5. 在安静的环境中通话

## 故障排除

### 无法发起通话

**症状**: 点击通话按钮没有反应

**解决方案**:
1. 检查是否已登录
2. 确认对方在线
3. 检查P2P连接状态
4. 重启应用

### 无法接听来电

**症状**: 来电通知不显示或无法接听

**解决方案**:
1. 检查通知权限
2. 确认应用在前台运行
3. 检查系统勿扰模式
4. 重启应用

### 音视频不同步

**症状**: 声音和画面不匹配

**解决方案**:
1. 检查网络延迟
2. 关闭其他占用资源的应用
3. 降低视频质量
4. 重新发起通话

### 屏幕共享黑屏

**症状**: 对方看到的是黑屏

**解决方案**:
1. 检查屏幕录制权限（macOS）
2. 重新选择共享源
3. 确认选择了正确的屏幕/窗口
4. 重启应用

### 连接失败

**症状**: 一直显示"连接中"

**解决方案**:
1. 检查网络连接
2. 确认防火墙设置
3. 尝试使用VPN
4. 检查STUN/TURN服务器状态

### 获取更多帮助

如果问题仍未解决：

1. **查看日志** - 在设置中导出日志文件
2. **联系支持** - 发送邮件到 support@chainlesschain.com
3. **提交Issue** - https://github.com/chainlesschain/chainlesschain/issues
4. **社区论坛** - 在社区中寻求帮助

## 快捷键

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 静音/取消静音 | `Ctrl/Cmd + M` | 快速切换静音状态 |
| 挂断通话 | `Ctrl/Cmd + H` | 结束当前通话 |
| 开启/关闭视频 | `Ctrl/Cmd + V` | 切换视频状态 |

*注：快捷键功能计划中*

## 隐私和安全

### 数据加密

- 所有通话使用端到端加密
- 使用DTLS 1.2和SRTP协议
- 密钥仅在通话双方之间交换
- 服务器无法解密通话内容

### 数据存储

- 通话内容不会被存储
- 仅保存通话元数据（时间、时长等）
- 通话历史存储在本地数据库
- 可以随时删除通话记录

### 权限管理

应用需要以下权限：
- **麦克风** - 用于语音通话
- **摄像头** - 用于视频通话
- **屏幕录制** - 用于屏幕共享（macOS）
- **通知** - 用于来电提醒

您可以随时在系统设置中撤销这些权限。

## 更新日志

### v0.18.0 (2026-01-11)
- ✅ 添加屏幕共享功能
- ✅ 添加通话历史记录
- ✅ 优化连接稳定性
- ✅ 改进通话质量监控

### v0.17.0 (2026-01-10)
- ✅ 实现语音通话功能
- ✅ 实现视频通话功能
- ✅ 添加通话控制
- ✅ 添加质量监控

## 反馈和建议

我们欢迎您的反馈和建议！

- **功能建议** - 在GitHub提交Feature Request
- **Bug报告** - 在GitHub提交Issue
- **使用体验** - 发送邮件到 feedback@chainlesschain.com

---

**文档版本**: v1.0.0
**最后更新**: 2026-01-11
**适用版本**: ChainlessChain v0.18.0+
