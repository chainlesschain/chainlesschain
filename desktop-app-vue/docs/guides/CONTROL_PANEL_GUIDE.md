# 控制面板使用指南

ChainlessChain 高级特性控制面板 - 实时监控和控制自适应阈值、在线学习和高级优化器。

## 目录

1. [快速开始](#快速开始)
2. [界面说明](#界面说明)
3. [功能详解](#功能详解)
4. [常用操作](#常用操作)
5. [集成到主应用](#集成到主应用)
6. [故障排查](#故障排查)

---

## 快速开始

### 方式1: 独立启动

```bash
cd desktop-app-vue
start-control-panel.bat
```

访问地址: http://localhost:3001

### 方式2: 从主应用打开

在主应用菜单中选择: `工具` → `高级特性控制面板`

### 首次使用

1. **启动控制面板**
   ```bash
   cd desktop-app-vue
   start-control-panel.bat
   ```

2. **浏览器自动打开**
   - 地址: http://localhost:3001
   - 如果未自动打开,手动访问上述地址

3. **查看系统状态**
   - 总览标签页显示核心指标
   - 检查服务运行状态

4. **执行首次操作**
   - 点击"刷新数据"按钮
   - 查看各项指标是否正常

---

## 界面说明

### 主界面布局

```
┌────────────────────────────────────────────┐
│  🚀 ChainlessChain 高级特性控制面板       │
│  实时监控和控制三大高级特性                │
└────────────────────────────────────────────┘
┌────────────────────────────────────────────┐
│ 📊总览 │ ⚙️阈值 │ 🧠学习 │ ⚡优化 │ 📝日志 │ 🔧设置 │
└────────────────────────────────────────────┘
┌────────────────────────────────────────────┐
│                                            │
│        [标签页内容区域]                   │
│                                            │
└────────────────────────────────────────────┘
```

### 6个标签页

| 标签 | 图标 | 功能 |
|------|------|------|
| **总览** | 📊 | 系统状态、核心指标、快速操作 |
| **自适应阈值** | ⚙️ | 阈值监控、调整、历史记录 |
| **在线学习** | 🧠 | 模型状态、训练、评估 |
| **高级优化器** | ⚡ | 优化功能、瓶颈检测 |
| **日志** | 📝 | 实时日志查看和导出 |
| **设置** | 🔧 | 配置参数、数据管理 |

---

## 功能详解

### 1. 总览页面

#### 1.1 系统状态

显示四大核心指标:

**服务状态**
- 绿色: 运行中 ✓
- 红色: 已停止 ✗
- 黄色: 警告状态 ⚠️

**运行时长**
- 显示服务持续运行时间
- 单位: 小时

**综合评分**
- 范围: 0-100分
- >90: 优秀 (绿色)
- 80-89: 良好 (蓝色)
- 70-79: 需改进 (黄色)
- <70: 严重 (红色)

**今日任务**
- 统计今天处理的总任务数

#### 1.2 核心指标

三个关键性能指标:

**小模型使用率**
- 目标范围: 40-60%
- 实时进度条显示
- 颜色指示:
  - 绿色: 在目标范围内
  - 黄色: 偏离目标
  - 红色: 严重偏离

**成功率**
- 目标: >95%
- 显示任务执行成功的百分比
- 低于85%会触发告警

**成本节约**
- 目标: >60%
- 显示使用小模型节省的成本
- 基于LLM调用成本计算

#### 1.3 快速操作

四个常用快捷按钮:

**🔄 刷新数据**
- 立即更新所有显示的指标
- 快捷键: F5

**⚡ 全面优化**
- 执行完整的优化分析
- 包含4个优化器功能
- 耗时约5分钟

**📊 导出报告**
- 生成PDF/Excel报告
- 包含所有性能数据
- 支持自定义时间范围

**🔧 配置设置**
- 快速跳转到设置页面
- 修改配置参数

#### 1.4 最近活动

表格显示最近的操作记录:
- 时间: 操作发生时间
- 类型: 阈值调整/模型训练/优化
- 操作: 具体执行的操作
- 结果: 成功/失败

---

### 2. 自适应阈值页面

#### 2.1 当前阈值

**复杂度阈值**
- 当前值 (例如: 0.52)
- 范围: 0.3-0.8
- 越高越倾向使用大模型

**上次调整时间**
- 显示最近一次调整的时间
- 例如: "2小时前"

**调整次数(24h)**
- 最近24小时的调整次数
- 过多可能表示不稳定

#### 2.2 性能监控

**监控周期选择**
- 最近1天
- 最近7天 (默认)
- 最近30天

**显示内容**:
- 小模型使用率趋势
- 成功率变化
- 成本节约统计
- 综合评分历史

#### 2.3 手动操作

**📊 性能监控**
- 执行完整的性能分析
- 生成评估报告
- 给出调整建议

**🔮 模拟调整**
- 预测调整效果
- 不实际修改阈值
- 安全的预演功能

**⚙️ 执行调整**
- 应用建议的阈值
- 需要确认操作
- 立即生效

**▶️ 启用自动调整**
- 开启自动调整模式
- 系统自动优化阈值
- 可随时停止

#### 2.4 阈值调整历史

表格显示历史记录:
- 时间: 调整发生时间
- 旧阈值: 调整前的值
- 新阈值: 调整后的值
- 调整幅度: +/-变化量
- 原因: 调整原因说明

---

### 3. 在线学习页面

#### 3.1 学习状态

四个关键指标:

**复杂度预测准确率**
- 目标: >85%
- MAE误差显示
- 权重收敛情况

**意图识别准确率**
- Top-1准确率
- Top-3准确率
- 平均置信度

**工具推荐采纳率**
- 推荐被采纳的比例
- 目标: >75%

**训练样本数**
- 已学习的总样本数
- 数据质量指标

#### 3.2 模型详情

**复杂度估计器**
- 权重配置:
  - 意图复杂度: 0.30
  - 上下文复杂度: 0.25
  - 历史复杂度: 0.20
  - 工具复杂度: 0.25
- 权重动态调整
- 梯度下降优化

**意图识别器**
- 已学习模式数
- 关键词覆盖数
- 平均置信度
- 新增模式(24h)

#### 3.3 训练操作

**训练数据范围**
- 最近7天
- 最近30天 (推荐)
- 最近60天
- 最近90天

**🎯 训练模型**
- 使用选定范围数据训练
- 更新所有4个子模型
- 耗时约3-5分钟

**📈 评估性能**
- 评估当前模型准确率
- 对比训练前后效果
- 生成评估报告

**📊 学习统计**
- 显示详细学习信息
- 权重变化趋势
- 模式增长情况

---

### 4. 高级优化器页面

#### 4.1 优化器状态

四个核心指标:

**预测缓存命中率**
- 目标: >70%
- 实时统计
- 提升响应速度

**并行化任务数**
- 当前可并行的任务组数
- 预期时间节约

**平均时间节约**
- 通过各种优化节省的时间
- 百分比显示

**检测到的瓶颈**
- 当前存在的性能瓶颈数量
- 分严重/中等/轻微

#### 4.2 优化功能

四个可选功能(复选框):

- ✅ 预测性缓存
- ✅ 并行任务优化
- ✅ 智能重试机制
- ✅ 瓶颈检测

可以单独启用/禁用每个功能

#### 4.3 优化操作

**🔮 预测性缓存**
- 分析用户行为模式
- 识别高置信度预测
- 预加载资源

**⚡ 并行优化**
- 分析任务依赖关系
- 识别可并行任务组
- 计算时间节约

**🔄 智能重试**
- 分析失败模式
- 优化重试策略
- 提高恢复率

**🔍 瓶颈检测**
- 检测慢任务
- 检测高失败率
- 检测缓存未命中

**🚀 全面优化**
- 执行所有4种优化
- 生成综合报告
- 给出优化建议

#### 4.4 瓶颈列表

显示检测到的所有瓶颈:

**慢任务瓶颈** (红色)
- 任务名称
- 平均耗时
- 优化建议

**高失败率瓶颈** (黄色)
- 任务名称
- 失败率
- 改进方案

**缓存未命中** (蓝色)
- 缓存项
- 命中率
- 优化策略

---

### 5. 日志页面

#### 5.1 实时日志查看

**日志显示区域**
- 黑色背景,终端风格
- 彩色日志级别
- 自动滚动到最新

**日志级别**
- INFO (绿色): 正常信息
- WARN (黄色): 警告
- ERROR (红色): 错误

#### 5.2 日志操作

**🔄 刷新**
- 加载最新日志
- 更新显示

**🗑️ 清空显示**
- 清空当前显示
- 不删除日志文件

**💾 导出日志**
- 导出为文本文件
- 包含时间范围
- 支持过滤

**级别过滤**
- 全部
- 仅INFO
- 仅WARN
- 仅ERROR

---

### 6. 设置页面

#### 6.1 自适应阈值配置

**检查间隔 (分钟)**
- 默认: 60
- 范围: 10-1440
- 越小检查越频繁

**最小样本量**
- 默认: 50
- 范围: 10-500
- 越大越可靠

**学习率**
- 默认: 0.05
- 范围: 0.01-0.5
- 影响调整速度

**冷却期 (小时)**
- 默认: 1
- 范围: 0.5-24
- 两次调整间隔

#### 6.2 在线学习配置

**训练数据天数**
- 默认: 30
- 范围: 7-365
- 影响模型范围

**置信度阈值**
- 默认: 0.7
- 范围: 0.1-1.0
- 影响识别准确性

#### 6.3 高级优化器配置

**最大并行任务数**
- 默认: 4
- 范围: 1-16
- 建议=CPU核心数

**缓存过期时间 (分钟)**
- 默认: 30
- 范围: 5-120
- 影响内存占用

**最大重试次数**
- 默认: 3
- 范围: 1-10
- 影响容错能力

#### 6.4 配置操作

**💾 保存配置**
- 保存所有修改
- 需要重启生效

**↩️ 重置默认**
- 恢复出厂设置
- 需要确认

**🔄 重启服务**
- 重启所有高级特性服务
- 应用新配置

#### 6.5 数据管理

**💾 备份数据库**
- 创建数据库备份
- 保存到backups目录

**🗑️ 清理旧数据**
- 删除90天前的历史数据
- 释放磁盘空间

**⚠️ 重置所有数据**
- 删除所有历史数据
- 需要双重确认
- **谨慎操作!**

---

## 常用操作

### 场景1: 日常监控

**每日检查清单 (5分钟)**

1. 打开控制面板
   ```bash
   start-control-panel.bat
   ```

2. 查看总览页面
   - 检查综合评分 (应 >85)
   - 查看核心指标颜色
   - 确认服务运行状态

3. 查看日志页面
   - 检查是否有ERROR
   - 查看WARN的数量
   - 确认无异常

4. 如有问题,进入对应页面深入检查

### 场景2: 性能优化

**执行全面优化 (15分钟)**

1. 进入高级优化器页面

2. 点击"瓶颈检测"
   - 查看检测结果
   - 记录严重瓶颈

3. 点击"全面优化"
   - 等待分析完成
   - 查看优化报告

4. 根据建议采取行动
   - 调整配置参数
   - 优化慢任务
   - 启用预测缓存

5. 验证优化效果
   - 等待24小时
   - 对比优化前后数据

### 场景3: 模型训练

**定期训练模型 (30分钟)**

1. 进入在线学习页面

2. 选择训练数据范围
   - 常规: 30天
   - 数据不足: 60天
   - 快速迭代: 7天

3. 点击"训练模型"
   - 等待训练完成
   - 查看训练输出

4. 点击"评估性能"
   - 查看准确率
   - 对比训练前后

5. 点击"学习统计"
   - 查看权重变化
   - 检查收敛情况

### 场景4: 阈值调整

**手动调整阈值 (10分钟)**

1. 进入自适应阈值页面

2. 选择监控周期 (7天)

3. 点击"性能监控"
   - 查看当前评分
   - 查看小模型使用率
   - 查看建议调整

4. 点击"模拟调整"
   - 查看预期效果
   - 评估风险

5. 点击"执行调整"
   - 确认操作
   - 等待完成

6. 查看调整历史
   - 确认记录已保存
   - 记录调整原因

### 场景5: 配置调优

**优化系统配置 (20分钟)**

1. 进入设置页面

2. 根据实际情况调整参数:

   **高负载场景**:
   - 检查间隔: 30分钟
   - 最小样本量: 100
   - 最大并行数: 8

   **低负载场景**:
   - 检查间隔: 120分钟
   - 最小样本量: 30
   - 最大并行数: 2

3. 点击"保存配置"

4. 点击"重启服务"
   - 确认重启
   - 等待完成

5. 返回总览页面
   - 验证服务状态
   - 检查指标变化

---

## 集成到主应用

### 方式1: 菜单集成

在主应用的菜单中添加入口:

```javascript
// src/main/index.js

const { Menu } = require('electron');

const menuTemplate = [
  // ... 其他菜单项
  {
    label: '工具',
    submenu: [
      {
        label: '高级特性控制面板',
        click: () => {
          shell.openExternal('http://localhost:3001');
        }
      }
    ]
  }
];

const menu = Menu.buildFromTemplate(menuTemplate);
Menu.setApplicationMenu(menu);
```

### 方式2: IPC集成

使用提供的IPC处理程序:

```javascript
// src/main/index.js

const AdvancedFeaturesIPC = require('./advanced-features-ipc');

// 创建主窗口后
const advancedFeaturesIPC = new AdvancedFeaturesIPC(mainWindow);
```

在渲染进程中调用:

```javascript
// src/renderer/...

// 获取总览数据
const overview = await window.electron.ipcRenderer.invoke('advanced-features:get-overview', 7);

// 执行阈值监控
const result = await window.electron.ipcRenderer.invoke('advanced-features:threshold-monitor', 7);

// 训练模型
const training = await window.electron.ipcRenderer.invoke('advanced-features:learning-train', 30);

// 全面优化
const optimization = await window.electron.ipcRenderer.invoke('advanced-features:optimizer-optimize');
```

### 方式3: 独立窗口

创建独立的Electron窗口:

```javascript
// src/main/index.js

const { BrowserWindow } = require('electron');

function createControlPanelWindow() {
  const win = new BrowserWindow({
    width: 1400,
    height: 900,
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true
    }
  });

  win.loadURL('http://localhost:3001');
  return win;
}

// 在菜单或按钮中调用
ipcMain.handle('open-control-panel', () => {
  createControlPanelWindow();
});
```

---

## 故障排查

### 问题1: 控制面板无法打开

**症状**: 浏览器显示"无法访问"

**排查步骤**:

1. 检查API服务是否运行
   ```bash
   netstat -ano | findstr :3001
   ```

2. 重新启动API服务
   ```bash
   cd desktop-app-vue
   node control-panel-api.js 3001
   ```

3. 检查防火墙设置
   - 允许端口3001

4. 查看错误日志
   - 检查console输出

### 问题2: 数据不显示

**症状**: 页面打开但指标为"--"

**排查步骤**:

1. 检查数据库连接
   ```bash
   dir ..\data\chainlesschain.db
   ```

2. 检查历史数据
   ```sql
   SELECT COUNT(*) FROM knowledge_distillation_history;
   ```

3. 执行刷新操作
   - 点击"刷新数据"按钮

4. 查看浏览器控制台
   - F12打开开发者工具
   - 查看Console错误

### 问题3: 操作执行失败

**症状**: 点击按钮后显示错误

**排查步骤**:

1. 检查脚本文件
   ```bash
   dir adaptive-threshold.js
   dir online-learning.js
   dir advanced-optimizer.js
   ```

2. 手动测试脚本
   ```bash
   node adaptive-threshold.js monitor
   ```

3. 查看API日志
   - 检查控制台输出

4. 验证权限
   - 确保有文件读写权限

### 问题4: 配置无法保存

**症状**: 点击保存后配置未更新

**排查步骤**:

1. 检查配置文件
   ```bash
   dir config\advanced-features.json
   ```

2. 验证文件权限
   - 确保可写

3. 手动编辑测试
   - 用编辑器打开配置文件
   - 尝试手动修改并保存

4. 重启服务
   ```bash
   stop-production.bat
   start-production.bat
   ```

### 问题5: 页面样式错乱

**症状**: 界面显示不正常

**解决方案**:

1. 清除浏览器缓存
   - Ctrl + Shift + Delete
   - 清除缓存

2. 强制刷新
   - Ctrl + F5

3. 尝试其他浏览器
   - Chrome (推荐)
   - Edge
   - Firefox

4. 检查浏览器版本
   - 确保使用现代浏览器

---

## 性能建议

### 浏览器要求

- Chrome 90+  (推荐)
- Edge 90+
- Firefox 88+
- Safari 14+

### 最佳实践

1. **定期关闭不用的标签页**
   - 减少内存占用

2. **避免长时间开启**
   - 建议每天重启一次

3. **使用现代浏览器**
   - 更好的性能和兼容性

4. **合理的刷新间隔**
   - 避免过于频繁刷新

---

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| F5 | 刷新当前页面 |
| Ctrl + F5 | 强制刷新 (清除缓存) |
| F12 | 打开开发者工具 |
| Ctrl + Shift + I | 打开开发者工具 |
| Tab | 切换到下一个标签 |
| Shift + Tab | 切换到上一个标签 |

---

## 更新日志

### v1.0.0 (2026-01-02)

- ✨ 初始版本发布
- 📊 总览页面
- ⚙️ 自适应阈值控制
- 🧠 在线学习管理
- ⚡ 高级优化器
- 📝 实时日志查看
- 🔧 配置管理

---

**文档版本**: 1.0.0
**最后更新**: 2026-01-02
**维护者**: ChainlessChain Team
