#!/bin/sh

# ChainlessChain Pre-commit Hook
# åŸºäº OpenClaude æœ€ä½³å®è·µ

echo "ğŸ” Running pre-commit checks..."

# 1. è¿è¡Œ lint-staged (ESLint + Prettier)
echo "ğŸ“ [1/3] Linting staged files..."
npx lint-staged
if [ $? -ne 0 ]; then
  echo "âŒ Lint check failed. Please fix the issues and try again."
  exit 1
fi

# 2. è¿è¡Œå®‰å…¨æ£€æŸ¥ (SQLæ³¨å…¥ã€XSSã€ç¡¬ç¼–ç å¯†é’¥ç­‰)
echo "ğŸ”’ [2/3] Running security validation..."
npm run validate:rules --silent 2>/dev/null || true
# æ³¨æ„ï¼šå®‰å…¨æ£€æŸ¥å¤±è´¥ä»…è­¦å‘Šï¼Œä¸é˜»æ­¢æäº¤ï¼ˆå¯é€šè¿‡è®¾ç½® exit 1 æ”¹ä¸ºå¼ºåˆ¶ï¼‰

# 3. è¿è¡Œå…³é”®å•å…ƒæµ‹è¯• (å¯é€‰ï¼ŒåŠ å¿«æäº¤é€Ÿåº¦æ—¶å¯æ³¨é‡Š)
# echo "ğŸ§ª [3/3] Running unit tests..."
# npm run test:unit --silent
# if [ $? -ne 0 ]; then
#   echo "âŒ Unit tests failed. Please fix and try again."
#   exit 1
# fi

echo "âœ… Pre-commit checks passed!"
