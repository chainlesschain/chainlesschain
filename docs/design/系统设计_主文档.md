# 基于U盾和SIMKey的个人移动AI管理系统

## 系统设计文档 v2.14 (更新至 v0.25.0 实际实现状态)

**文档版本**: 2.14
**系统版本**: v0.25.0 (生产就绪,核心功能完成)
**最后更新**: 2026-01-17

> **注意**: 本文档为主文档索引，详细的模块设计已拆分到独立文件中。

---

## 文档索引

### 核心模块设计

| 模块 | 文档 | 说明 |
|------|------|------|
| 知识库管理 | [01_知识库管理模块.md](modules/01_知识库管理模块.md) | 个人第二大脑,RAG检索,向量存储 |
| 去中心化社交 | [02_去中心化社交模块.md](modules/02_去中心化社交模块.md) | DID身份,P2P通信,Signal加密 |
| 交易辅助 | [03_交易辅助模块.md](modules/03_交易辅助模块.md) | 智能合约,信用评分,AI协商 |
| 项目管理 ⭐ | [04_项目管理模块.md](modules/04_项目管理模块.md) | **核心功能**,对话式任务,AI生成 |
| 企业版组织 | [05_企业版组织模块.md](modules/05_企业版组织模块.md) | RBAC权限,组织协作,实时编辑 |
| AI优化系统 | [06_AI优化系统.md](modules/06_AI优化系统.md) | P2优化,高级特性,在线学习 |
| 性能优化 | [07_性能优化系统.md](modules/07_性能优化系统.md) | 三层优化体系,Core Web Vitals |
| MCP与配置 | [08_MCP与配置系统.md](modules/08_MCP与配置系统.md) | Model Context Protocol,统一配置,预算跟踪 |

### 基础设施设计

| 文档 | 说明 |
|------|------|
| [安全机制设计.md](安全机制设计.md) | U盾/SIMKey硬件安全,密钥管理,备份恢复 |
| [数据同步方案.md](数据同步方案.md) | Git同步,HTTP同步,P2P移动端同步 |
| [AI模型部署方案.md](AI模型部署方案.md) | Ollama本地部署,云端API,模型选型 |

### 参考资料

| 文档 | 说明 |
|------|------|
| [实施总结与附录.md](实施总结与附录.md) | 实施完成状态,快速开始指南,API文档,版本历史 |
| [系统设计_个人移动AI管理系统.md](系统设计_个人移动AI管理系统.md) | 原始完整文档(归档) |

---

## 一、系统概述

### 1.1 系统定位

本系统是一个**去中心化的个人AI助手平台**,整合了知识库管理、**项目管理(⭐核心)**、**企业版组织协作(⭐新增)**、社交网络和交易辅助五大核心功能,通过U盾(USB Key)和SIMKey提供硬件级安全保障。

**主要应用**: `desktop-app-vue/` (Electron 39.2.6 + Vue 3.4 + TypeScript)

**当前状态** (v0.25.0 - 生产就绪):

| 模块 | 完成度 | 说明 |
|------|--------|------|
| 知识库管理 | 100% ✅ | 知识图谱可视化,网页剪藏,RAG检索 |
| 项目管理 | 100% ✅ | 对话式任务,AI代码/文档生成 |
| 企业版协作 | 100% ✅ | RBAC权限,实时协作,组织隔离 |
| AI引擎系统 | 100% ✅ | 16个专业引擎,P2优化完成 |
| MCP集成 | POC ✅ | Model Context Protocol v0.1.0 |
| P2P社交 | 100% ✅ | 朋友圈+论坛,音视频通话 |
| 交易系统 | 100% ✅ | 28个UI组件,8个后端模块 |
| 移动端应用 | 95% ✅ | uni-app,核心功能已实现 |
| **Manus优化** | 100% ✅ | Context Engineering + Tool Masking + Multi-Agent ⭐新增 |

**总体完成度**: **100%** (PC端+移动端,220+功能点全部实现)

### 1.2 核心特性

- **完全去中心化**: 数据存储在用户自己的设备上,不依赖第三方云服务
- **硬件安全**: 基于U盾/SIMKey的硬件级密钥保护
- **跨设备同步**: Git同步 + HTTP同步 + P2P移动端同步
- **AI增强**: 集成本地大模型(Ollama)和14+云端LLM API,支持RAG检索增强
- **隐私优先**: 用户完全掌控自己的数据和AI模型
- **对话式项目管理**: AI驱动的项目创建、文件生成和智能任务拆解
- **多身份切换**: 个人身份+多组织身份,数据完全隔离

### 1.3 架构规模 (v0.25.0)

- **449个** 主进程JS文件
- **330个** Vue组件
- **60张** 数据库表
- **802个** IPC接口
- **~180,000行** 核心代码
- **65,000字** 技术文档

### 1.4 技术架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户层                                     │
├──────────────────────┬──────────────────────┬───────────────────┤
│   移动端 (Android/iOS)│ PC端 (Win/Mac/Linux) │   Web端 (可选)    │
│   - SIMKey认证        │      - U盾认证        │   - 浏览器访问     │
│   - P2P同步           │      - P2P桥接        │   - 轻量级界面     │
└──────────────────────┴──────────────────────┴───────────────────┘
              ↕                       ↕                    ↕
┌─────────────────────────────────────────────────────────────────┐
│                     业务逻辑层                                    │
├──────────────────────────────────────────────────────────────────┤
│  项目管理(核心) │ 知识库管理 │ 社交模块 │ 交易模块 │ 企业协作   │
└──────────────────────────────────────────────────────────────────┘
              ↕                       ↕                    ↕
┌─────────────────────────────────────────────────────────────────┐
│                     数据层                                        │
├──────────────────┬─────────────────────┬────────────────────────┤
│  本地存储         │   分布式存储         │   AI模型层             │
│  - SQLite/sql.js │   - Git仓库          │   - Ollama本地         │
│  - ChromaDB      │   - P2P同步          │   - 14+云端API         │
└──────────────────┴─────────────────────┴────────────────────────┘
              ↕                       ↕                    ↕
┌─────────────────────────────────────────────────────────────────┐
│                     安全层                                        │
├──────────────────────────────┬──────────────────────────────────┤
│       U盾 (PC端)              │        SIMKey (移动端)           │
│  - 私钥存储/数字签名          │   - 私钥存储/SIM卡安全芯片       │
└──────────────────────────────┴──────────────────────────────────┘
```

---

## 二、核心模块设计 (详见子文档)

| 序号 | 模块 | 子文档 |
|------|------|--------|
| 2.1 | 知识库管理模块 | [modules/01_知识库管理模块.md](modules/01_知识库管理模块.md) |
| 2.2 | 去中心化社交模块 | [modules/02_去中心化社交模块.md](modules/02_去中心化社交模块.md) |
| 2.3 | 去中心化交易辅助模块 | [modules/03_交易辅助模块.md](modules/03_交易辅助模块.md) |
| 2.4 | 项目管理模块 ⭐核心 | [modules/04_项目管理模块.md](modules/04_项目管理模块.md) |
| 2.5 | 企业版组织模块 | [modules/05_企业版组织模块.md](modules/05_企业版组织模块.md) |
| 2.6-2.7 | AI优化系统 | [modules/06_AI优化系统.md](modules/06_AI优化系统.md) |
| 2.8 | 性能优化系统 | [modules/07_性能优化系统.md](modules/07_性能优化系统.md) |
| 2.9-2.11 | MCP与配置系统 | [modules/08_MCP与配置系统.md](modules/08_MCP与配置系统.md) |

---

## 三、安全机制设计 (详见子文档)

详细设计请参考: [安全机制设计.md](安全机制设计.md)

主要内容:
- 3.1 U盾安全机制 (密钥管理、备份恢复)
- 3.2 SIMKey安全机制
- 3.3 数据加密方案

---

## 四、数据同步方案 (详见子文档)

详细设计请参考: [数据同步方案.md](数据同步方案.md)

主要内容:
- 4.1 Git同步 (PC间版本控制同步)
- 4.2 HTTP同步 (轻量级PC间同步)
- 4.3 P2P移动端同步 (WebRTC实时同步)

---

## 五、AI模型部署方案 (详见子文档)

详细设计请参考: [AI模型部署方案.md](AI模型部署方案.md)

主要内容:
- 5.1 模型选型 (LLM、Embedding、向量数据库)
- 5.2 部署架构 (PC端Docker、移动端轻量级)
- 5.3 混合推理策略

---

## 六、系统实现技术栈

### 6.1 PC端 (跨平台桌面应用)

**核心框架**: Electron 39.2.6 + Vue 3.4

```
实际技术栈:
├── 前端框架: Vue 3.4 + TypeScript
├── UI库: Ant Design Vue 4.1
├── 状态管理: Pinia 2.1.7
├── Markdown编辑器: Milkdown 7.17.3
├── Git操作: isomorphic-git
├── 数据库: sql.js (SQLite WASM)
├── 向量库: ChromaDB 3.1.8
├── 加密: node-forge + U盾SDK
├── P2P: libp2p 3.1.2
├── 图像: Sharp + Tesseract.js (OCR)
├── LLM客户端: Ollama SDK + 云端客户端
├── MCP集成: Model Context Protocol SDK
├── 语音识别: OpenAI Whisper API
├── 打包: Electron Forge 7.2.0
└── 代码规范: ESLint + Prettier
```

### 6.2 移动端

**Android**: Kotlin + Jetpack Compose + Room + SIMKey (OMAPI)

**iOS**: Swift + SwiftUI + Core Data + Core Telephony

### 6.3 后端服务 (可选)

- **中继服务器**: Rust/Go + PostgreSQL + Redis
- **引导节点**: Go + libp2p (DHT网络)

---

## 七、开发路线图

### Phase 1: MVP (最小可行产品) - 已完成 ✅
- 知识库基础功能
- AI集成 (Ollama + RAG)
- Git同步

### Phase 2: 社交功能 - 已完成 ✅
- DID系统
- P2P通信
- Signal协议加密

### Phase 3: 交易功能 - 已完成 ✅
- 交易发布与匹配
- 智能合约
- 信誉系统

### Phase 4: 生态完善 - 进行中 🚧
- [ ] 浏览器扩展完善
- [ ] 更多LLM支持
- [ ] 企业版增强
- [ ] Web端 (PWA)

---

## 八、关键挑战与解决方案

### 8.1 U盾/SIMKey兼容性

**解决方案**: 抽象层设计 + 适配器模式 + 自动检测 + 降级方案

### 8.2 移动端性能优化

**解决方案**: 模型量化 + 混合推理 + 预计算缓存 + 异步处理

### 8.3 数据隐私与合规

**解决方案**: 隐私设计原则 + GDPR/CCPA合规 + 审计日志

### 8.4 P2P网络稳定性

**解决方案**: 多层连接策略 + 离线支持 + 全球中继节点

---

## 九、商业模式 (可选)

### 9.1 免费增值模式

**免费功能**: 完整知识库、基础社交、本地LLM、Git同步

**高级功能**: 云端LLM额度、托管Git仓库、全球加速中继、企业版协作

### 9.2 企业服务

私有化部署、定制开发、技术支持、员工培训

### 9.3 生态收益

硬件销售分成、插件市场抽成、交易手续费

---

## 十、总结

这套**基于U盾和SIMKey的个人移动AI管理系统**整合了:

1. **知识库管理**: 个人第二大脑,本地AI增强检索和问答
2. **去中心化社交**: 基于DID的隐私优先社交网络
3. **去中心化交易**: AI辅助的可信交易平台

**核心优势**:

- **极致安全**: 硬件级密钥保护,端到端加密
- **完全去中心化**: 无需信任第三方平台
- **AI原生**: 本地大模型,保护隐私的同时享受AI能力
- **跨设备**: PC、手机无缝协作
- **开源自主**: 代码开源,数据自己掌控

---

## 附录

详细附录内容请参考: [实施总结与附录.md](实施总结与附录.md)

- 附录A: 快速开始指南
- 附录B: API文档
- 附录C: 版本更新历史
