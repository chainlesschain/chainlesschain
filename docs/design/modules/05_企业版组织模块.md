# ä¼ä¸šç‰ˆç»„ç»‡æ¨¡å— â­æ–°å¢æ ¸å¿ƒæ¨¡å—

> æœ¬æ–‡æ¡£æ˜¯ [ç³»ç»Ÿè®¾è®¡ä¸»æ–‡æ¡£](../ç³»ç»Ÿè®¾è®¡_ä¸»æ–‡æ¡£.md) çš„å­æ–‡æ¡£ï¼Œè¯¦ç»†æè¿°ä¼ä¸šç‰ˆå»ä¸­å¿ƒåŒ–ç»„ç»‡åä½œæ¨¡å—çš„è®¾è®¡ã€‚

---

## 2.5 ä¼ä¸šç‰ˆï¼ˆå»ä¸­å¿ƒåŒ–ç»„ç»‡ï¼‰â­æ–°å¢æ ¸å¿ƒæ¨¡å—

### 2.5.1 åŠŸèƒ½æè¿°

ä¼ä¸šç‰ˆæ˜¯åŸºäºå»ä¸­å¿ƒåŒ–P2Pç½‘ç»œçš„å›¢é˜Ÿåä½œç³»ç»Ÿï¼Œæ”¯æŒå¤šèº«ä»½åˆ‡æ¢ã€ç»„ç»‡ç®¡ç†ã€æƒé™æ§åˆ¶å’ŒçŸ¥è¯†åº“å…±äº«ã€‚æ¯ä¸ªç»„ç»‡æ‹¥æœ‰ç‹¬ç«‹çš„DIDæ ‡è¯†ã€æ•°æ®åº“å’ŒP2Pç½‘ç»œï¼ŒçœŸæ­£å®ç°å»ä¸­å¿ƒåŒ–çš„å›¢é˜Ÿåä½œã€‚

**æ ¸å¿ƒç‰¹æ€§**:

- **å¤šèº«ä»½æ¶æ„**: ä¸€ä¸ªç”¨æˆ·DIDå¯æ‹¥æœ‰ä¸ªäººèº«ä»½+å¤šä¸ªç»„ç»‡èº«ä»½
- **æ•°æ®å®Œå…¨éš”ç¦»**: æ¯ä¸ªèº«ä»½å¯¹åº”ç‹¬ç«‹çš„æ•°æ®åº“æ–‡ä»¶ï¼ˆpersonal.db, org_xxx.dbï¼‰
- **RBACæƒé™ç³»ç»Ÿ**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆOwner/Admin/Member/Viewerï¼‰
- **é‚€è¯·æœºåˆ¶**: æ”¯æŒé‚€è¯·ç å’ŒDIDé‚€è¯·ä¸¤ç§æ–¹å¼
- **P2Pç»„ç»‡ç½‘ç»œ**: åŸºäºlibp2pçš„å»ä¸­å¿ƒåŒ–ç»„ç»‡ç½‘ç»œï¼ˆè§„åˆ’ä¸­ï¼‰
- **æ´»åŠ¨å®¡è®¡**: æ‰€æœ‰æ“ä½œè‡ªåŠ¨è®°å½•ï¼Œæ”¯æŒå®¡è®¡å’Œå›æº¯

**é€‚ç”¨åœºæ™¯**:

- åˆ›ä¸šå›¢é˜Ÿï¼ˆStartupï¼‰- å°å‹å…¬å¸ï¼ˆCompanyï¼‰- æŠ€æœ¯ç¤¾åŒºï¼ˆCommunityï¼‰
- å¼€æºé¡¹ç›®ï¼ˆOpensourceï¼‰
- æ•™è‚²æœºæ„ï¼ˆEducationï¼‰

### 2.5.2 æ¶æ„è®¾è®¡

```
ä¼ä¸šç‰ˆï¼ˆå»ä¸­å¿ƒåŒ–ç»„ç»‡ï¼‰
â”œâ”€â”€ èº«ä»½ç®¡ç†å±‚
â”‚   â”œâ”€â”€ ä¸ªäººèº«ä»½ï¼ˆPrimary DIDï¼‰
â”‚   â”‚   â”œâ”€â”€ personal.dbï¼ˆä¸ªäººæ•°æ®åº“ï¼‰
â”‚   â”‚   â””â”€â”€ ä¸ªäººçŸ¥è¯†åº“ã€é¡¹ç›®
â”‚   â”‚
â”‚   â”œâ”€â”€ ç»„ç»‡èº«ä»½1ï¼ˆOrg DIDï¼‰
â”‚   â”‚   â”œâ”€â”€ org_abc123.dbï¼ˆç»„ç»‡æ•°æ®åº“ï¼‰
â”‚   â”‚   â”œâ”€â”€ ç»„ç»‡çŸ¥è¯†åº“
â”‚   â”‚   â”œâ”€â”€ ç»„ç»‡é¡¹ç›®
â”‚   â”‚   â””â”€â”€ æˆå‘˜åˆ—è¡¨
â”‚   â”‚
â”‚   â””â”€â”€ ç»„ç»‡èº«ä»½2ï¼ˆOrg DIDï¼‰
â”‚       â””â”€â”€ org_xyz789.db
â”‚
â”œâ”€â”€ ç»„ç»‡ç®¡ç†å±‚
â”‚   â”œâ”€â”€ OrganizationManagerï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰âœ…å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ ç»„ç»‡åˆ›å»º/åˆ é™¤
â”‚   â”‚   â”œâ”€â”€ æˆå‘˜ç®¡ç†ï¼ˆæ·»åŠ /ç§»é™¤/è§’è‰²å˜æ›´ï¼‰
â”‚   â”‚   â”œâ”€â”€ é‚€è¯·ç®¡ç†ï¼ˆç”Ÿæˆé‚€è¯·ç ã€DIDé‚€è¯·ï¼‰
â”‚   â”‚   â”œâ”€â”€ æƒé™æ£€æŸ¥ï¼ˆRBACï¼‰
â”‚   â”‚   â””â”€â”€ æ´»åŠ¨æ—¥å¿—è®°å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ IdentityStoreï¼ˆPiniaçŠ¶æ€ç®¡ç†ï¼‰âœ…å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ å½“å‰æ¿€æ´»èº«ä»½
â”‚   â”‚   â”œâ”€â”€ æ‰€æœ‰èº«ä»½ä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ ç»„ç»‡åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ èº«ä»½åˆ‡æ¢é€»è¾‘
â”‚   â”‚
â”‚   â””â”€â”€ DIDManageræ‰©å±• âœ…å·²å®ç°
â”‚       â”œâ”€â”€ ä¸ªäººDIDåˆ›å»º
â”‚       â””â”€â”€ ç»„ç»‡DIDåˆ›å»ºï¼ˆæ”¯æŒorgå‰ç¼€ï¼‰
â”‚
â”œâ”€â”€ æ•°æ®éš”ç¦»å±‚
â”‚   â”œâ”€â”€ DatabaseManageræ‰©å±• âœ…å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ switchDatabase()ï¼ˆæ•°æ®åº“åˆ‡æ¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ getDatabasePath()ï¼ˆæ ¹æ®èº«ä»½è·å–è·¯å¾„ï¼‰
â”‚   â”‚   â””â”€â”€ å¤šæ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ æ•°æ®åº“æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ data/personal.dbï¼ˆä¸ªäººï¼‰
â”‚   â”‚   â”œâ”€â”€ data/org_abc123.dbï¼ˆç»„ç»‡1ï¼‰
â”‚   â”‚   â””â”€â”€ data/org_xyz789.dbï¼ˆç»„ç»‡2ï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ Gitä»“åº“éš”ç¦»
â”‚       â”œâ”€â”€ git-repos/personal/ï¼ˆä¸ªäººä»“åº“ï¼‰
â”‚       â”œâ”€â”€ git-repos/org_abc123/ï¼ˆç»„ç»‡1ä»“åº“ï¼‰
â”‚       â””â”€â”€ git-repos/org_xyz789/ï¼ˆç»„ç»‡2ä»“åº“ï¼‰
â”‚
â”œâ”€â”€ P2Pç½‘ç»œå±‚ï¼ˆè§„åˆ’ä¸­ï¼‰
â”‚   â”œâ”€â”€ ç»„ç»‡Topicè®¢é˜…
â”‚   â”œâ”€â”€ æˆå‘˜å‘ç°æœºåˆ¶
â”‚   â”œâ”€â”€ ç»„ç»‡æ¶ˆæ¯è·¯ç”±
â”‚   â””â”€â”€ BootstrapèŠ‚ç‚¹
â”‚
â”œâ”€â”€ æƒé™æ§åˆ¶å±‚
â”‚   â”œâ”€â”€ RBACï¼ˆåŸºäºè§’è‰²ï¼‰
â”‚   â”‚   â”œâ”€â”€ Ownerï¼ˆæ‰€æœ‰æƒé™ï¼‰
â”‚   â”‚   â”œâ”€â”€ Adminï¼ˆç®¡ç†æƒé™ï¼‰
â”‚   â”‚   â”œâ”€â”€ Memberï¼ˆè¯»å†™æƒé™ï¼‰
â”‚   â”‚   â””â”€â”€ Viewerï¼ˆåªè¯»æƒé™ï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ ACLï¼ˆèµ„æºçº§è®¿é—®æ§åˆ¶ï¼‰
â”‚       â”œâ”€â”€ knowledge.read/write/delete
â”‚       â”œâ”€â”€ project.read/write/delete
â”‚       â”œâ”€â”€ member.read/manage
â”‚       â””â”€â”€ org.manage
â”‚
â””â”€â”€ UIç»„ä»¶å±‚
    â”œâ”€â”€ IdentitySwitcherï¼ˆèº«ä»½åˆ‡æ¢å™¨ï¼‰âœ…å·²å®ç°
    â”‚   â”œâ”€â”€ å½“å‰èº«ä»½æ˜¾ç¤º
    â”‚   â”œâ”€â”€ èº«ä»½åˆ—è¡¨
    â”‚   â”œâ”€â”€ åˆ›å»ºç»„ç»‡å¯¹è¯æ¡†
    â”‚   â””â”€â”€ åŠ å…¥ç»„ç»‡å¯¹è¯æ¡†
    â”‚
    â”œâ”€â”€ OrganizationMembersPageï¼ˆæˆå‘˜ç®¡ç†ï¼‰âœ…å·²å®ç°
    â”‚   â”œâ”€â”€ æˆå‘˜åˆ—è¡¨
    â”‚   â”œâ”€â”€ è§’è‰²ç®¡ç†
    â”‚   â””â”€â”€ é‚€è¯·ç®¡ç†
    â”‚
    â””â”€â”€ OrganizationSettingsPageï¼ˆç»„ç»‡è®¾ç½®ï¼‰âœ…å·²å®ç°
        â”œâ”€â”€ ç»„ç»‡ä¿¡æ¯ç¼–è¾‘
        â”œâ”€â”€ æƒé™é…ç½®
        â””â”€â”€ å®‰å…¨è®¾ç½®
```

### 2.5.3 æ ¸å¿ƒæµç¨‹

**ç»„ç»‡åˆ›å»ºæµç¨‹**:

```
1. ç”¨æˆ·ç‚¹å‡»"åˆ›å»ºç»„ç»‡"
2. å¡«å†™ç»„ç»‡ä¿¡æ¯ï¼ˆåç§°ã€ç±»å‹ã€æè¿°ï¼‰
3. è°ƒç”¨ org:create-organization IPC
4. OrganizationManager åˆ›å»ºç»„ç»‡
   â”œâ”€â”€ ç”Ÿæˆç»„ç»‡IDï¼ˆUUIDï¼‰
   â”œâ”€â”€ åˆ›å»ºç»„ç»‡DIDï¼ˆdid:chainlesschain:org:xxxxxï¼‰
   â”œâ”€â”€ åˆå§‹åŒ–ç»„ç»‡æ•°æ®åº“ï¼ˆorg_xxx.dbï¼‰
   â”œâ”€â”€ åˆ›å»ºç»„ç»‡Gitä»“åº“
   â”œâ”€â”€ è®¾ç½®Ownerè§’è‰²
   â””â”€â”€ è®°å½•æ´»åŠ¨æ—¥å¿—
5. è¿”å›ç»„ç»‡ä¿¡æ¯
6. åˆ·æ–°èº«ä»½åˆ—è¡¨
```

**èº«ä»½åˆ‡æ¢æµç¨‹**:

```
1. ç”¨æˆ·é€‰æ‹©è¦åˆ‡æ¢çš„èº«ä»½ï¼ˆpersonal æˆ– org_xxxï¼‰
2. è°ƒç”¨ identityStore.switchContext(contextId)
3. ä¿å­˜å½“å‰èº«ä»½çŠ¶æ€
4. è°ƒç”¨ db:switch-database IPC
5. DatabaseManager.switchDatabase()
   â”œâ”€â”€ å…³é—­å½“å‰æ•°æ®åº“è¿æ¥
   â”œâ”€â”€ æ ¹æ®contextIdè·å–æ–°æ•°æ®åº“è·¯å¾„
   â”œâ”€â”€ æ‰“å¼€æ–°æ•°æ®åº“
   â””â”€â”€ åˆå§‹åŒ–è¡¨ç»“æ„
6. åŠ è½½æ–°èº«ä»½çš„æ•°æ®
   â”œâ”€â”€ çŸ¥è¯†åº“åˆ—è¡¨
   â”œâ”€â”€ é¡¹ç›®åˆ—è¡¨
   â””â”€â”€ ç»„ç»‡æˆå‘˜ï¼ˆå¦‚æœæ˜¯ç»„ç»‡èº«ä»½ï¼‰
7. æ›´æ–°UIæ˜¾ç¤º
8. åˆ‡æ¢å®Œæˆ
```

**é‚€è¯·åŠ å…¥æµç¨‹**:

```
1. Owner/Adminåˆ›å»ºé‚€è¯·
   â”œâ”€â”€ ç”Ÿæˆ6ä½é‚€è¯·ç ï¼ˆA-Z0-9ï¼‰
   â”œâ”€â”€ è®¾ç½®è§’è‰²å’Œæœ‰æ•ˆæœŸ
   â””â”€â”€ ä¿å­˜åˆ° organization_invitationsè¡¨
2. é‚€è¯·ç åˆ†äº«ç»™æ–°æˆå‘˜
3. æ–°æˆå‘˜è¾“å…¥é‚€è¯·ç 
4. è°ƒç”¨ org:join-organization IPC
5. OrganizationManager.joinOrganization()
   â”œâ”€â”€ éªŒè¯é‚€è¯·ç 
   â”œâ”€â”€ æ£€æŸ¥é‚€è¯·æ˜¯å¦æœ‰æ•ˆï¼ˆæœªè¿‡æœŸã€æœªè¾¾åˆ°ä½¿ç”¨æ¬¡æ•°ï¼‰
   â”œâ”€â”€ æ·»åŠ æˆå‘˜åˆ° organization_membersè¡¨
   â”œâ”€â”€ åˆ›å»ºèº«ä»½ä¸Šä¸‹æ–‡
   â”œâ”€â”€ åˆå§‹åŒ–ç»„ç»‡æ•°æ®åº“
   â””â”€â”€ è®°å½•æ´»åŠ¨æ—¥å¿—
6. è¿”å›ç»„ç»‡ä¿¡æ¯
7. æ–°æˆå‘˜å¯åˆ‡æ¢åˆ°ç»„ç»‡èº«ä»½
```

### 2.5.4 æ•°æ®æ¨¡å‹ âœ…å·²å®ç°

**æ–°å¢ä¼ä¸šç‰ˆè¡¨ç»“æ„ï¼ˆ9ä¸ªè¡¨ï¼‰**:

```sql
-- èº«ä»½ä¸Šä¸‹æ–‡è¡¨ï¼ˆç”¨æˆ·çº§åˆ«ï¼ŒåŠ å¯†ï¼‰
CREATE TABLE IF NOT EXISTS identity_contexts (
    context_id TEXT PRIMARY KEY,           -- 'personal' æˆ– 'org_xxx'
    user_did TEXT NOT NULL,                -- ç”¨æˆ·ä¸»DID
    context_type TEXT NOT NULL,            -- 'personal' æˆ– 'organization'
    org_id TEXT,                           -- ç»„ç»‡IDï¼ˆå¦‚æœæ˜¯ç»„ç»‡èº«ä»½ï¼‰
    org_name TEXT,                         -- ç»„ç»‡åç§°
    org_avatar TEXT,                       -- ç»„ç»‡å¤´åƒ
    role TEXT,                             -- ç”¨æˆ·åœ¨ç»„ç»‡ä¸­çš„è§’è‰²
    display_name TEXT,                     -- æ˜¾ç¤ºåç§°
    db_path TEXT NOT NULL,                 -- æ•°æ®åº“æ–‡ä»¶è·¯å¾„
    is_active INTEGER DEFAULT 0,           -- æ˜¯å¦å½“å‰æ¿€æ´»ï¼ˆå”¯ä¸€ï¼‰
    created_at INTEGER NOT NULL,
    last_accessed_at INTEGER
);

-- ç»„ç»‡æˆå‘˜å…³ç³»è¡¨ï¼ˆç¼“å­˜ï¼‰
CREATE TABLE IF NOT EXISTS organization_memberships (
    id TEXT PRIMARY KEY,
    user_did TEXT NOT NULL,
    org_id TEXT NOT NULL,
    org_did TEXT NOT NULL,                -- ç»„ç»‡DID
    role TEXT NOT NULL,                   -- è§’è‰²
    joined_at INTEGER NOT NULL,
    UNIQUE(user_did, org_id)
);

-- ç»„ç»‡å…ƒæ•°æ®è¡¨
CREATE TABLE IF NOT EXISTS organization_info (
    org_id TEXT PRIMARY KEY,
    org_did TEXT NOT NULL,                -- ç»„ç»‡DID
    name TEXT NOT NULL,
    description TEXT,
    type TEXT CHECK(type IN ('startup', 'company', 'community', 'opensource', 'education')),
    avatar TEXT,
    owner_did TEXT NOT NULL,              -- ç»„ç»‡Owner DID
    settings_json TEXT,                   -- ç»„ç»‡è®¾ç½®JSON
    created_at INTEGER NOT NULL,
    updated_at INTEGER NOT NULL
);

-- ç»„ç»‡æˆå‘˜è¡¨
CREATE TABLE IF NOT EXISTS organization_members (
    id TEXT PRIMARY KEY,
    org_id TEXT NOT NULL,
    member_did TEXT NOT NULL,             -- æˆå‘˜DID
    display_name TEXT,
    avatar TEXT,
    role TEXT NOT NULL CHECK(role IN ('owner', 'admin', 'member', 'viewer')),
    permissions TEXT,                     -- è‡ªå®šä¹‰æƒé™JSON
    joined_at INTEGER NOT NULL,
    last_active_at INTEGER,
    status TEXT DEFAULT 'active' CHECK(status IN ('active', 'inactive', 'removed')),
    UNIQUE(org_id, member_did)
);

-- ç»„ç»‡è§’è‰²è¡¨
CREATE TABLE IF NOT EXISTS organization_roles (
    id TEXT PRIMARY KEY,
    org_id TEXT NOT NULL,
    name TEXT NOT NULL,                   -- è§’è‰²åç§°
    description TEXT,
    permissions TEXT,                     -- æƒé™åˆ—è¡¨JSON
    is_builtin INTEGER DEFAULT 0,         -- æ˜¯å¦å†…ç½®è§’è‰²
    created_at INTEGER NOT NULL,
    UNIQUE(org_id, name)
);

-- ç»„ç»‡é‚€è¯·è¡¨
CREATE TABLE IF NOT EXISTS organization_invitations (
    id TEXT PRIMARY KEY,
    org_id TEXT NOT NULL,
    invite_code TEXT UNIQUE,              -- 6ä½é‚€è¯·ç ï¼ˆA-Z0-9ï¼‰
    invited_by TEXT NOT NULL,             -- é‚€è¯·äººDID
    role TEXT DEFAULT 'member',           -- è¢«é‚€è¯·è€…å°†è·å¾—çš„è§’è‰²
    max_uses INTEGER DEFAULT 1,           -- æœ€å¤§ä½¿ç”¨æ¬¡æ•°
    used_count INTEGER DEFAULT 0,         -- å·²ä½¿ç”¨æ¬¡æ•°
    expire_at INTEGER,                    -- è¿‡æœŸæ—¶é—´
    created_at INTEGER NOT NULL
);

-- ç»„ç»‡é¡¹ç›®è¡¨
CREATE TABLE IF NOT EXISTS organization_projects (
    id TEXT PRIMARY KEY,
    org_id TEXT NOT NULL,
    name TEXT NOT NULL,
    description TEXT,
    owner_did TEXT NOT NULL,              -- é¡¹ç›®Owner
    created_at INTEGER NOT NULL,
    updated_at INTEGER NOT NULL
);

-- ç»„ç»‡æ´»åŠ¨æ—¥å¿—è¡¨
CREATE TABLE IF NOT EXISTS organization_activities (
    id TEXT PRIMARY KEY,
    org_id TEXT NOT NULL,
    actor_did TEXT NOT NULL,              -- æ“ä½œè€…DID
    action TEXT NOT NULL,                 -- æ“ä½œç±»å‹ï¼ˆcreate_organization, add_memberç­‰ï¼‰
    resource_type TEXT,                   -- èµ„æºç±»å‹
    resource_id TEXT,                     -- èµ„æºID
    metadata TEXT,                        -- å…ƒæ•°æ®JSON
    timestamp INTEGER NOT NULL
);

-- P2PåŒæ­¥çŠ¶æ€è¡¨
CREATE TABLE IF NOT EXISTS p2p_sync_state (
    id TEXT PRIMARY KEY,
    org_id TEXT NOT NULL,
    resource_type TEXT NOT NULL,          -- 'knowledge', 'project', 'member'
    resource_id TEXT NOT NULL,
    local_version INTEGER DEFAULT 1,
    remote_version INTEGER DEFAULT 1,
    cid TEXT,                             -- IPFS CIDï¼ˆè§„åˆ’ä¸­ï¼‰
    sync_status TEXT DEFAULT 'synced' CHECK(sync_status IN ('synced', 'pending', 'conflict')),
    last_synced_at INTEGER,
    UNIQUE(org_id, resource_type, resource_id)
);
```

**æ‰©å±•ç°æœ‰è¡¨ï¼ˆknowledge_itemsï¼‰**:

```sql
-- æ–°å¢ä¼ä¸šç‰ˆå­—æ®µ
ALTER TABLE knowledge_items ADD COLUMN org_id TEXT;                   -- æ‰€å±ç»„ç»‡ID
ALTER TABLE knowledge_items ADD COLUMN created_by TEXT;               -- åˆ›å»ºè€…DID
ALTER TABLE knowledge_items ADD COLUMN updated_by TEXT;               -- æ›´æ–°è€…DID
ALTER TABLE knowledge_items ADD COLUMN share_scope TEXT DEFAULT 'private';  -- å…±äº«èŒƒå›´
ALTER TABLE knowledge_items ADD COLUMN permissions TEXT;              -- æƒé™JSON
ALTER TABLE knowledge_items ADD COLUMN version INTEGER DEFAULT 1;    -- ç‰ˆæœ¬å·
ALTER TABLE knowledge_items ADD COLUMN parent_version_id TEXT;        -- çˆ¶ç‰ˆæœ¬ID
ALTER TABLE knowledge_items ADD COLUMN cid TEXT;                      -- IPFS CID
```

### 2.5.5 æƒé™ç³»ç»Ÿè®¾è®¡

**å†…ç½®è§’è‰²æƒé™**:

```javascript
// Owner - æ‰€æœ‰æƒé™
{
  permissions: ["*"]; // é€šé…ç¬¦è¡¨ç¤ºæ‰€æœ‰æƒé™
}

// Admin - ç®¡ç†æƒé™
{
  permissions: [
    "org.manage", // ç»„ç»‡ç®¡ç†
    "member.manage", // æˆå‘˜ç®¡ç†
    "role.manage", // è§’è‰²ç®¡ç†
    "knowledge.*", // çŸ¥è¯†åº“æ‰€æœ‰æƒé™
    "project.*", // é¡¹ç›®æ‰€æœ‰æƒé™
    "invitation.create", // åˆ›å»ºé‚€è¯·
  ];
}

// Member - è¯»å†™æƒé™
{
  permissions: [
    "knowledge.read",
    "knowledge.create",
    "knowledge.write",
    "project.read",
    "project.create",
    "project.write",
    "member.read",
  ];
}

// Viewer - åªè¯»æƒé™
{
  permissions: ["knowledge.read", "project.read", "member.read"];
}
```

**æƒé™æ£€æŸ¥é€»è¾‘**:

```javascript
async checkPermission(orgId, userDID, permission) {
  // 1. è·å–ç”¨æˆ·è§’è‰²
  const member = await this.getMember(orgId, userDID);

  // 2. è·å–è§’è‰²æƒé™
  const role = await this.getRole(orgId, member.role);

  // 3. æ£€æŸ¥é€šé…ç¬¦æƒé™
  if (role.permissions.includes('*')) {
    return true;
  }

  // 4. æ£€æŸ¥ç²¾ç¡®åŒ¹é…
  if (role.permissions.includes(permission)) {
    return true;
  }

  // 5. æ£€æŸ¥å‰ç¼€åŒ¹é…ï¼ˆknowledge.* åŒ¹é… knowledge.readï¼‰
  const prefix = permission.split('.')[0];
  if (role.permissions.includes(`${prefix}.*`)) {
    return true;
  }

  // 6. æ— æƒé™
  return false;
}
```

### 2.5.6 æŠ€æœ¯é€‰å‹

**åç«¯æ¨¡å—**:

- **OrganizationManager**: ç»„ç»‡ç®¡ç†æ ¸å¿ƒé€»è¾‘ï¼ˆ701è¡Œä»£ç ï¼‰
- **DIDManageræ‰©å±•**: æ”¯æŒç»„ç»‡DIDåˆ›å»ºï¼ˆdid:chainlesschain:org:xxxxï¼‰
- **DatabaseManageræ‰©å±•**: å¤šæ•°æ®åº“åˆ‡æ¢å’Œéš”ç¦»

**å‰ç«¯æ¨¡å—**:

- **IdentityStore** (Pinia): çŠ¶æ€ç®¡ç†ï¼ˆ385è¡Œä»£ç ï¼‰
- **IdentitySwitcher.vue**: èº«ä»½åˆ‡æ¢UIç»„ä»¶ï¼ˆ361è¡Œä»£ç ï¼‰
- **OrganizationMembersPage.vue**: æˆå‘˜ç®¡ç†é¡µé¢ï¼ˆæ–°å¢ï¼‰
- **OrganizationSettingsPage.vue**: ç»„ç»‡è®¾ç½®é¡µé¢ï¼ˆæ–°å¢ï¼‰

**P2Pç½‘ç»œ**ï¼ˆè§„åˆ’ä¸­ï¼‰:

- **libp2p**: P2Pç½‘ç»œåŸºç¡€
- **GossipSub**: ç»„ç»‡Topicè®¢é˜…
- **Signal Protocol**: E2EåŠ å¯†æ¶ˆæ¯

**æ•°æ®åŒæ­¥**ï¼ˆè§„åˆ’ä¸­ï¼‰:

- **IPFS**: å†…å®¹å¯»å€å­˜å‚¨
- **OrbitDB**: å»ä¸­å¿ƒåŒ–æ•°æ®åº“ï¼ˆè€ƒè™‘ä¸­ï¼‰
- **Y.js**: CRDTååŒç¼–è¾‘

### 2.5.7 å®ç°è¿›åº¦

| æ¨¡å—                | çŠ¶æ€        | å®Œæˆåº¦ |
| ------------------- | ----------- | ------ |
| æ•°æ®åº“æ¶æ„ï¼ˆ8ä¸ªè¡¨ï¼‰ | âœ… å®Œæˆ     | 100%   |
| OrganizationManager | âœ… å®Œæˆ     | 100%   |
| IdentityStore       | âœ… å®Œæˆ     | 100%   |
| IdentitySwitcher UI | âœ… å®Œæˆ     | 95%    |
| æˆå‘˜ç®¡ç†UI          | âœ… å®Œæˆ     | 95%    |
| å¤šèº«ä»½æ•°æ®åº“éš”ç¦»    | âœ… å®Œæˆ     | 90%    |
| ç»„ç»‡DIDåˆ›å»º         | âœ… å®Œæˆ     | 100%   |
| é‚€è¯·ç ç³»ç»Ÿ          | âœ… å®Œæˆ     | 100%   |
| RBACæƒé™ç³»ç»Ÿ        | âœ… å®Œæˆ     | 100%   |
| æ´»åŠ¨æ—¥å¿—            | âœ… å®Œæˆ     | 100%   |
| è§’è‰²ç®¡ç†            | âœ… å®Œæˆ     | 100%   |
| DIDé‚€è¯·æœºåˆ¶         | âœ… å®Œæˆ     | 85%    |
| åä½œç®¡ç†å™¨          | âœ… å®Œæˆ     | 85%    |
| ç»„ç»‡é¡¹ç›®ç®¡ç†        | âœ… å®Œæˆ     | 90%    |
| P2Pç»„ç»‡ç½‘ç»œ         | âš ï¸ åŸºç¡€æ¡†æ¶ | 30%    |
| æ•°æ®åŒæ­¥            | âš ï¸ å¼€å‘ä¸­   | 40%    |

**æ€»ä½“å®Œæˆåº¦**: **85%**ï¼ˆæ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ,å¯ç”Ÿäº§ä½¿ç”¨ï¼‰

**å®ç°äº®ç‚¹**:

- âœ… å®Œæ•´çš„ç»„ç»‡CRUDæ“ä½œ
- âœ… å¤šèº«ä»½åˆ‡æ¢å’Œæ•°æ®éš”ç¦»
- âœ… å®Œå–„çš„æˆå‘˜å’Œè§’è‰²ç®¡ç†
- âœ… åŸºäºDIDçš„é‚€è¯·ç³»ç»Ÿ
- âœ… åä½œå¼æ–‡æ¡£ç¼–è¾‘åŸºç¡€æ¡†æ¶


#### å®ç°çŠ¶æ€ (v0.20.0)

**å®Œæˆåº¦**: 45% ğŸš§

**å·²å®ç°**:
- RBACæƒé™ç³»ç»Ÿ
- ç»„ç»‡ç®¡ç†
- DIDé‚€è¯·æœºåˆ¶

**å¼€å‘ä¸­**:
- å®æ—¶åä½œç¼–è¾‘
- ç»„ç»‡çŸ¥è¯†åº“éš”ç¦»
- é«˜çº§æƒé™ç®¡ç†

**å®ç°ä½ç½®**: `desktop-app-vue/src/main/organization/` (12ä¸ªæ–‡ä»¶)

