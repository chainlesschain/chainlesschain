# Phase 2 - Task #9 端到端测试指南

**创建时间**: 2026-01-27
**测试类型**: E2E 集成测试 + 手动测试

## 一、自动化测试

### 1. 测试文件

**文件**: `desktop-app-vue/tests/integration/remote-control-e2e.test.js`
**测试用例数**: 25+ 个
**覆盖范围**: AI 命令、系统命令、错误处理、并发、性能

### 2. 运行测试

```bash
# 进入项目目录
cd desktop-app-vue

# 运行远程控制端到端测试
npx vitest run tests/integration/remote-control-e2e.test.js

# 运行所有远程相关测试
npx vitest run tests/remote/

# 运行并查看覆盖率
npx vitest run tests/integration/remote-control-e2e.test.js --coverage
```

### 3. 测试覆盖

#### AI 命令流程测试 (3 个测试)
- ✅ AI 对话命令
- ✅ RAG 搜索命令
- ✅ 获取模型列表

#### 系统命令流程测试 (3 个测试)
- ✅ 获取系统状态
- ✅ 发送通知
- ✅ 获取系统信息

#### 错误处理测试 (4 个测试)
- ✅ 无效命令方法
- ✅ 缺少必要参数
- ✅ 权限被拒绝
- ✅ 命令超时

#### 并发命令测试 (2 个测试)
- ✅ 并发 AI 对话命令
- ✅ 混合类型并发命令

#### 统计和日志测试 (3 个测试)
- ✅ 命令执行统计
- ✅ 设备活跃度
- ✅ 命令执行时长

#### 日志查询和导出测试 (5 个测试)
- ✅ 分页查询
- ✅ 按命名空间过滤
- ✅ 按状态过滤
- ✅ 搜索日志
- ✅ 导出为 JSON

#### 性能测试 (2 个测试)
- ✅ 大量命令处理（100 条）
- ✅ 长时间运行场景（2 秒持续）

## 二、手动测试

### 前置条件

1. **PC 端准备**
   - 启动桌面应用
   - 确保 P2P 服务运行
   - 确保本地 Ollama 运行（如使用）

2. **Android 端准备**
   - 安装 Android 应用
   - 确保网络连接
   - 确保已配对 PC 设备

### 测试场景 1: AI 对话完整流程

**步骤**:
1. Android 端打开"远程控制"
2. 点击"远程 AI 对话"
3. 输入消息："你好，请介绍一下自己"
4. 点击"发送"
5. 观察 AI 响应

**预期结果**:
- ✅ Android 显示发送中状态
- ✅ PC 端接收到命令
- ✅ AI 返回响应
- ✅ Android 显示 AI 回复
- ✅ 响应时间 < 5 秒
- ✅ 命令日志已记录

**验证**:
- PC 端打开"命令日志"页面
- 查看最近日志，应该有一条 `ai.chat` 记录
- 状态应为"成功"
- 查看日志详情，参数和结果应完整

### 测试场景 2: RAG 搜索完整流程

**步骤**:
1. Android 端打开"远程 RAG 搜索"
2. 输入查询："项目管理"
3. 设置 topK = 5
4. 点击"搜索"

**预期结果**:
- ✅ 显示搜索结果列表
- ✅ 每个结果显示相似度分数
- ✅ 结果按相似度排序
- ✅ 最多显示 5 条结果

**验证**:
- PC 端命令日志应有 `ai.ragSearch` 记录
- 日志详情应包含查询参数和结果数量

### 测试场景 3: 截图完整流程

**步骤**:
1. Android 端打开"远程截图"
2. 点击"截取屏幕"
3. 等待截图传输
4. 使用双指缩放查看
5. 点击"保存到相册"

**预期结果**:
- ✅ 截图在 3 秒内完成
- ✅ 图片清晰可见
- ✅ 缩放功能正常（1x-5x）
- ✅ 保存成功提示

**验证**:
- Android 相册中应有截图
- PC 端命令日志应有 `system.screenshot` 记录

### 测试场景 4: 系统监控完整流程

**步骤**:
1. Android 端打开"系统监控"
2. 观察 CPU/内存实时数据
3. 启用自动刷新（5 秒间隔）
4. 观察折线图变化

**预期结果**:
- ✅ CPU 使用率显示（0-100%）
- ✅ 内存使用显示（已用/总量）
- ✅ 折线图实时更新
- ✅ 数据点不超过 60 个

**验证**:
- PC 端命令日志应有多条 `system.getStatus` 记录
- 记录间隔约 5 秒

### 测试场景 5: 命令历史查看

**步骤**:
1. Android 端打开"命令历史"
2. 查看历史命令列表
3. 使用搜索功能
4. 使用过滤功能
5. 点击某条命令查看详情
6. 点击"重放"按钮

**预期结果**:
- ✅ 显示所有历史命令
- ✅ 搜索结果准确
- ✅ 过滤功能正常
- ✅ 详情显示完整
- ✅ 重放成功执行

### 测试场景 6: 命令日志查看（PC 端）

**步骤**:
1. PC 端打开"远程控制" -> "命令日志"
2. 查看统计卡片（总数/成功率/失败/耗时）
3. 查看 4 个图表
4. 使用搜索和过滤功能
5. 点击某条日志查看详情
6. 导出日志为 JSON

**预期结果**:
- ✅ 统计数据准确
- ✅ 图表显示正常
- ✅ 搜索过滤功能正常
- ✅ 详情完整显示
- ✅ 导出成功

### 测试场景 7: 错误处理测试

#### 7.1 连接断开
**步骤**:
1. Android 发送命令
2. 在命令执行过程中断开网络
3. 观察错误提示

**预期结果**:
- ✅ 显示"连接断开"错误
- ✅ 命令状态标记为失败
- ✅ 错误日志记录

#### 7.2 命令超时
**步骤**:
1. 发送一个预期会很慢的命令
2. 等待超时（30 秒）

**预期结果**:
- ✅ 显示"命令超时"错误
- ✅ 不会无限等待

#### 7.3 权限检查
**步骤**:
1. 尝试执行危险命令（如 `rm -rf /`）

**预期结果**:
- ✅ 命令被拒绝
- ✅ 显示权限错误

### 测试场景 8: 并发命令测试

**步骤**:
1. 同时打开多个 AI 对话
2. 在不同对话中快速发送消息
3. 同时执行截图和系统监控

**预期结果**:
- ✅ 所有命令都能正确执行
- ✅ 响应不会混乱
- ✅ 每个命令独立完成

### 测试场景 9: 性能测试

#### 9.1 大量历史记录
**步骤**:
1. 执行 100+ 次命令
2. 打开命令历史
3. 滚动查看

**预期结果**:
- ✅ 分页加载流畅
- ✅ 无卡顿
- ✅ 内存占用正常

#### 9.2 长时间运行
**步骤**:
1. 启用系统监控自动刷新
2. 持续运行 1 小时
3. 观察应用状态

**预期结果**:
- ✅ 应用不崩溃
- ✅ 内存不泄漏
- ✅ 功能正常

## 三、测试结果记录

### 自动化测试结果

```bash
# 运行测试
npx vitest run tests/integration/remote-control-e2e.test.js

# 预期输出
✓ AI 命令流程测试 (3)
  ✓ 应该成功执行 AI 对话命令
  ✓ 应该成功执行 RAG 搜索命令
  ✓ 应该成功获取可用模型列表

✓ 系统命令流程测试 (3)
  ✓ 应该成功获取系统状态
  ✓ 应该成功发送通知
  ✓ 应该成功获取系统信息

✓ 错误处理测试 (4)
  ✓ 应该正确处理无效的命令方法
  ✓ 应该正确处理缺少必要参数
  ✓ 应该正确处理权限被拒绝
  ✓ 应该正确处理命令超时

✓ 并发命令测试 (2)
  ✓ 应该能够处理并发的AI对话命令
  ✓ 应该能够处理混合类型的并发命令

✓ 统计和日志测试 (3)
  ✓ 应该正确记录命令执行统计
  ✓ 应该正确记录设备活跃度
  ✓ 应该正确记录命令执行时长

✓ 日志查询和导出测试 (5)
  ✓ 应该支持分页查询日志
  ✓ 应该支持按命名空间过滤日志
  ✓ 应该支持按状态过滤日志
  ✓ 应该支持搜索日志
  ✓ 应该支持导出日志为 JSON

✓ 性能测试 (2)
  ✓ 应该能够在合理时间内处理大量命令
  ✓ 应该能够处理长时间运行的场景

Test Files  1 passed (1)
     Tests  22 passed (22)
   Duration  ~5s
```

### 手动测试结果表格

| 测试场景 | 状态 | 执行时间 | 备注 |
|---------|------|---------|------|
| AI 对话完整流程 | [ ] 通过 / [ ] 失败 | ___s | |
| RAG 搜索完整流程 | [ ] 通过 / [ ] 失败 | ___s | |
| 截图完整流程 | [ ] 通过 / [ ] 失败 | ___s | |
| 系统监控完整流程 | [ ] 通过 / [ ] 失败 | ___s | |
| 命令历史查看 | [ ] 通过 / [ ] 失败 | ___s | |
| 命令日志查看 | [ ] 通过 / [ ] 失败 | ___s | |
| 连接断开测试 | [ ] 通过 / [ ] 失败 | ___s | |
| 命令超时测试 | [ ] 通过 / [ ] 失败 | ___s | |
| 权限检查测试 | [ ] 通过 / [ ] 失败 | ___s | |
| 并发命令测试 | [ ] 通过 / [ ] 失败 | ___s | |
| 大量历史记录 | [ ] 通过 / [ ] 失败 | ___s | |
| 长时间运行 | [ ] 通过 / [ ] 失败 | ___s | |

## 四、已知问题

### 限制
1. Android 测试需要真实设备或模拟器
2. P2P 连接需要网络环境
3. AI 功能需要 Ollama 服务

### 待优化
1. 增加更多边界情况测试
2. 添加性能基准测试
3. 增加 UI 自动化测试（Playwright）

## 五、测试总结

### 通过标准
- ✅ 所有自动化测试通过
- ✅ 90% 以上手动测试通过
- ✅ 无严重 bug
- ✅ 性能符合预期

### 下一步
- 完成手动测试
- 修复发现的问题
- 更新测试文档
- 继续 Task #10 (性能优化)

---

**测试人员**: ____________
**测试日期**: 2026-01-27
**测试版本**: v0.27.0
**测试环境**: Windows 11 / Android 12+
