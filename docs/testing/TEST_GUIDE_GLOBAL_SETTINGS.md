# 全局设置向导功能 - 详细测试指南

## 测试环境状态
- ✅ Vite 开发服务器: http://localhost:5173
- ✅ Electron 进程: 已启动 (3个进程)
- ✅ 应用状态: 正常运行

---

## 测试计划概览

本次测试共包含 **5 大模块**，每个模块包含多个测试用例：

1. **全局设置向导首次启动流程** (7个测试点)
2. **企业版服务器连接功能** (6个测试点) ⭐ 最新实现
3. **配置导入导出功能** (5个测试点)
4. **路径迁移向导** (4个测试点)
5. **边界情况和错误处理** (7个测试点)

**预计测试时间**: 30-40分钟

---

## 模块 1: 全局设置向导首次启动流程

### 前置条件
需要模拟首次启动状态。如果应用已经完成过首次设置，需要重置配置：

```bash
# 删除初始设置配置文件
cd C:\Users\longfa\AppData\Roaming\chainlesschain-desktop-vue
del initial-setup-config.json

# 或者通过应用内重置（如果有重置功能）
```

### 测试用例 1.1: 首次启动显示全局设置向导
**步骤**:
1. 启动应用（如果刚删除配置，请重启应用）
2. 观察应用启动后的第一个界面

**预期结果**:
- ✅ 自动弹出"全局设置向导"对话框
- ✅ 对话框标题为"欢迎使用 ChainlessChain"
- ✅ 显示6步进度条：欢迎 → 版本选择 → 项目路径 → 数据库路径 → AI配置 → 完成
- ✅ 第一步"欢迎"步骤处于激活状态
- ✅ 对话框不可通过点击遮罩关闭（maskClosable=false）

### 测试用例 1.2: 步骤 0 - 欢迎页面
**步骤**:
1. 查看欢迎页面内容

**预期结果**:
- ✅ 显示火箭图标
- ✅ 显示欢迎标题"欢迎使用 ChainlessChain"
- ✅ 显示两段说明文字
- ✅ 显示蓝色提示框："首次设置向导"
- ✅ 底部有"下一步"按钮

**操作**: 点击"下一步"

### 测试用例 1.3: 步骤 1 - 版本选择
**步骤**:
1. 观察版本选择界面

**预期结果**:
- ✅ 显示两张卡片：个人版（紫色渐变）、企业版（粉红渐变）
- ✅ 每张卡片显示图标、标题、描述、4个特性列表
- ✅ 默认选中"个人版"（蓝色边框）
- ✅ 鼠标悬停卡片时有上移动画效果

**操作**:
1. 点击"企业版"卡片
2. 观察界面变化

**预期结果**:
- ✅ 企业版卡片被选中（蓝色边框）
- ✅ 下方展开"企业服务器配置"表单（淡入动画）
- ✅ 表单包含3个输入框：服务器地址、租户ID、API密钥
- ✅ API密钥输入框为密码类型
- ✅ 显示"测试服务器连接"按钮（禁用状态，因为未填写完整）

**操作**: 切换回"个人版"

**预期结果**:
- ✅ 企业服务器配置表单消失

### 测试用例 1.4: 步骤 2 - 项目路径
**步骤**:
1. 点击"下一步"进入项目路径设置

**预期结果**:
- ✅ 显示"项目文件存储根目录"标题
- ✅ 显示说明文字："您的知识库项目将存储在此目录下"
- ✅ 显示路径输入框，可能预填充默认路径
- ✅ 输入框旁边有"浏览..."按钮

**操作**: 点击"浏览..."按钮

**预期结果**:
- ✅ 打开系统文件夹选择对话框
- ✅ 对话框标题为"选择项目文件存储根目录"

**操作**:
1. 选择一个文件夹（或取消）
2. 如果选择了文件夹，路径应显示在输入框中
3. 点击"下一步"

### 测试用例 1.5: 步骤 3 - 数据库路径
**预期结果**:
- ✅ 显示"数据库文件存储位置"标题
- ✅ 显示说明文字："SQLite数据库文件将存储在此目录下"
- ✅ 显示路径输入框，可能预填充默认路径
- ✅ 可以通过"浏览..."按钮选择路径

**操作**: 直接点击"下一步"（使用默认路径）

### 测试用例 1.6: 步骤 4 - AI配置
**预期结果**:
- ✅ 显示"LLM快速配置"标题
- ✅ 显示三种模式切换：简化模式 / 高级模式 / 跳过
- ✅ 默认为"简化模式"
- ✅ 简化模式下显示AI提供商下拉选择（Ollama, 火山引擎, OpenAI等）

**操作**:
1. 切换到"高级模式"

**预期结果**:
- ✅ 显示完整配置表单：API Key、Base URL、模型名称等

**操作**:
1. 切换到"跳过"模式
2. 点击"下一步"

### 测试用例 1.7: 步骤 5 - 完成确认
**预期结果**:
- ✅ 显示成功图标（绿色对勾）
- ✅ 显示"配置完成"标题
- ✅ 显示配置摘要表格，包含：
  - 版本：个人版 或 企业版
  - 项目路径
  - 数据库路径
  - AI提供商
  - （企业版）企业服务器地址
- ✅ 底部按钮变为"完成设置"

**操作**: 点击"完成设置"

**预期结果**:
- ✅ 显示成功提示："设置已保存"
- ✅ 全局设置对话框关闭
- ✅ 进入下一步流程（可能是加密设置向导或登录页面）

---

## 模块 2: 企业版服务器连接功能 ⭐

这是**最新实现的功能**，需要重点测试。

### 测试用例 2.1: 连接测试按钮状态管理
**步骤**:
1. 重新打开全局设置向导（通过登录页右上角设置按钮或托盘菜单）
2. 进入"版本选择"步骤
3. 选择"企业版"

**预期结果**:
- ✅ "测试服务器连接"按钮为禁用状态（灰色）

**操作**: 逐步填写配置信息
1. 填写服务器地址：`https://test.example.com`
2. 填写租户ID：`test-tenant`

**预期结果**:
- ✅ 按钮仍为禁用状态

**操作**: 填写API密钥：`test-api-key-12345`

**预期结果**:
- ✅ 按钮变为可用状态（蓝色）

### 测试用例 2.2: 成功连接测试
**前置条件**: 需要一个可访问的测试服务器（如果没有，跳过此测试）

**步骤**:
1. 填写真实的企业服务器配置
2. 点击"测试服务器连接"按钮

**预期结果**:
- ✅ 按钮显示"正在测试连接..."并进入加载状态
- ✅ 按钮图标变为旋转的加载图标
- ✅ 等待几秒后，显示绿色成功提示框
- ✅ 提示框内容："连接成功 (延迟: XXXms)"
- ✅ 显示成功消息提示（右上角）："企业服务器连接成功！"

### 测试用例 2.3: 连接超时测试（>10秒）
**步骤**:
1. 填写一个不可达的服务器地址：`https://192.168.255.255:9999`
2. 点击"测试服务器连接"

**预期结果**:
- ✅ 按钮显示"正在测试连接..."
- ✅ 等待约10秒后，显示红色错误提示框
- ✅ 错误消息："连接超时：服务器无响应"
- ✅ 显示错误提示（右上角）："连接超时，请检查服务器地址是否正确"
- ✅ 显示排查建议列表（4项）

### 测试用例 2.4: 认证失败测试（401/403）
**步骤**:
1. 填写服务器地址：`https://httpbin.org/status/401`
2. 填写任意租户ID和API密钥
3. 点击"测试服务器连接"

**预期结果**:
- ✅ 显示红色错误提示框
- ✅ 错误消息："认证失败：API密钥或租户ID无效"
- ✅ 显示错误提示："认证失败，请检查API密钥和租户ID"

### 测试用例 2.5: 网络错误测试
**步骤**:
1. 填写一个格式错误的URL：`htttttp://invalid-url`
2. 点击"测试服务器连接"

**预期结果**:
- ✅ 显示红色错误提示框
- ✅ 错误消息包含"网络错误"或"无法连接"
- ✅ 显示排查建议列表

### 测试用例 2.6: 连接延迟显示
**步骤**:
1. 填写一个有效的HTTP端点（如：`https://httpbin.org/status/200`）
2. 点击"测试服务器连接"

**预期结果**:
- ✅ 如果连接成功，显示延迟时间（如："延迟: 234ms"）
- ✅ 延迟时间为合理的数值（通常100-2000ms）

---

## 模块 3: 配置导入导出功能

### 测试用例 3.1: 导出配置
**步骤**:
1. 打开全局设置向导（需要canSkip=true，即从登录页或托盘菜单打开）
2. 观察对话框底部

**预期结果**:
- ✅ 显示"导入配置"和"导出配置"两个按钮（中间有分隔线）

**操作**: 点击"导出配置"按钮

**预期结果**:
- ✅ 打开系统文件保存对话框
- ✅ 默认文件名为：`chainlesschain-config-YYYY-MM-DD.json`
- ✅ 默认保存位置为"下载"文件夹

**操作**: 选择保存位置并保存

**预期结果**:
- ✅ 显示成功提示："配置已导出到: [文件路径]"
- ✅ 文件已成功创建

**操作**: 打开导出的JSON文件

**预期结果**:
- ✅ JSON格式正确，可以被解析
- ✅ 包含以下字段：edition, paths, llm, enterprise
- ✅ **敏感信息已被过滤**：
  - `llm.apiKey` 不存在或为空
  - `enterprise.apiKey` 不存在或为空
- ✅ 不包含 `setupCompleted` 和 `completedAt` 字段

### 测试用例 3.2: 导入有效配置
**步骤**:
1. 准备一个有效的配置文件（可以使用上一步导出的文件）
2. 在全局设置向导中点击"导入配置"

**预期结果**:
- ✅ 打开系统文件选择对话框
- ✅ 文件过滤器为JSON文件

**操作**: 选择配置文件并确认

**预期结果**:
- ✅ 显示成功提示："配置已导入！请检查各项设置"
- ✅ 表单字段被填充为导入的值：
  - 版本选择更新
  - 路径更新
  - LLM配置更新
  - 企业配置更新（如果有）

### 测试用例 3.3: 导入无效JSON
**步骤**:
1. 创建一个包含无效JSON的文件（如：`{invalid json}`）
2. 点击"导入配置"并选择该文件

**预期结果**:
- ✅ 显示错误提示："导入配置失败: [错误信息]"
- ✅ 表单数据不变

### 测试用例 3.4: 导入部分配置
**步骤**:
1. 创建一个只包含部分字段的JSON文件：
```json
{
  "edition": "enterprise",
  "paths": {
    "projectRoot": "D:/MyProjects"
  }
}
```
2. 导入该文件

**预期结果**:
- ✅ 只有存在的字段被更新
- ✅ 缺失的字段保持原值或默认值
- ✅ 不会导致应用崩溃

### 测试用例 3.5: 取消导入/导出
**步骤**:
1. 点击"导出配置"，然后在对话框中点击"取消"
2. 点击"导入配置"，然后在对话框中点击"取消"

**预期结果**:
- ✅ 不显示任何错误提示
- ✅ 不显示成功提示
- ✅ 应用状态不变

---

## 模块 4: 路径迁移向导

### 测试用例 4.1: 打开路径迁移向导
**步骤**:
1. 在系统设置页面或其他入口打开"路径迁移向导"

**预期结果**:
- ✅ 显示4步进度条：选择类型 → 设置路径 → 确认迁移 → 完成
- ✅ 第一步处于激活状态
- ✅ 显示3个单选按钮：项目文件 / 数据库 / 全部迁移
- ✅ 默认选中"项目文件"

### 测试用例 4.2: 迁移类型选择
**操作**: 依次选择不同的迁移类型

**预期结果**:
- ✅ 选择"项目文件"时，显示蓝色提示框说明迁移内容
- ✅ 选择"数据库"时，提示框内容改变
- ✅ 选择"全部迁移"时，提示框说明同时迁移两者

**操作**: 选择"全部迁移"，点击"下一步"

### 测试用例 4.3: 路径设置
**预期结果**:
- ✅ 显示当前项目路径（只读输入框）
- ✅ 显示新项目路径输入框+浏览按钮
- ✅ 显示当前数据库路径（只读）
- ✅ 显示新数据库路径输入框+浏览按钮
- ✅ "下一步"按钮禁用（因为未填写新路径）

**操作**:
1. 点击项目路径的"浏览..."按钮
2. 选择一个新文件夹
3. 点击数据库路径的"浏览..."按钮
4. 选择一个新文件夹

**预期结果**:
- ✅ 新路径显示在输入框中
- ✅ "下一步"按钮变为可用

**操作**: 点击"下一步"

### 测试用例 4.4: 确认迁移
**预期结果**:
- ✅ 显示迁移信息表格（边框样式）
- ✅ 表格显示：
  - 项目文件迁移：从 → 到
  - 数据库迁移：从 → 到
- ✅ 显示黄色警告提示："重要提示"
- ✅ 警告内容包含：备份建议、重启提示
- ✅ 显示确认复选框："我已阅读并理解上述提示..."
- ✅ 复选框默认未勾选
- ✅ "开始迁移"按钮禁用

**操作**: 勾选确认复选框

**预期结果**:
- ✅ "开始迁移"按钮变为可用

**⚠️ 警告**: 以下操作会真实迁移数据，请确保已备份！

**操作**: 点击"开始迁移"（仅在测试环境中执行）

**预期结果**:
- ✅ 进入第4步"完成"页面
- ✅ 显示加载动画（旋转图标）
- ✅ 显示进度条，从0%逐渐增加到100%
- ✅ 显示迁移状态消息（如："正在迁移数据库..."、"正在迁移项目文件..."）
- ✅ 迁移完成后，显示成功图标和"迁移成功"标题
- ✅ 显示："迁移完成！应用将在3秒后重启..."
- ✅ 3秒后应用自动重启

---

## 模块 5: 边界情况和错误处理

### 测试用例 5.1: 首次设置不可跳过
**步骤**:
1. 删除配置文件，重启应用进入首次设置
2. 尝试点击对话框外的遮罩层
3. 尝试按ESC键

**预期结果**:
- ✅ 对话框不会关闭
- ✅ 右上角没有关闭按钮（closable=false）

### 测试用例 5.2: 非首次设置可跳过
**步骤**:
1. 完成首次设置后，通过登录页设置按钮打开全局设置
2. 尝试点击对话框外的遮罩层或按ESC键

**预期结果**:
- ✅ 对话框可以关闭
- ✅ 右上角显示关闭按钮

### 测试用例 5.3: 企业版空服务器URL
**步骤**:
1. 选择企业版
2. 只填写租户ID和API密钥，服务器地址留空
3. 尝试点击"测试服务器连接"

**预期结果**:
- ✅ 按钮保持禁用状态
- ✅ 或显示警告提示："请先填写完整的服务器配置信息"

### 测试用例 5.4: 路径权限验证
**步骤**:
1. 在路径迁移向导中，尝试选择一个无写权限的路径（如：`C:\Windows\System32`）
2. 继续迁移流程

**预期结果**:
- ✅ 显示错误提示：权限不足或路径无效
- ✅ 不允许继续（或在迁移时失败并显示错误）

### 测试用例 5.5: 数据库初始化错误
**步骤**:
1. 观察应用启动时的控制台输出
2. 查看是否有数据库相关错误（如："no such table: projects_old"）

**预期结果**:
- ✅ 如果有错误，应用应该有容错机制，继续启动
- ✅ 或在首次启动时自动创建缺失的表

### 测试用例 5.6: 快速连续点击测试按钮
**步骤**:
1. 选择企业版，填写完整配置
2. 快速连续点击"测试服务器连接"按钮5次

**预期结果**:
- ✅ 只发送一次连接请求
- ✅ 按钮在测试期间保持禁用或加载状态
- ✅ 不会同时显示多个成功/失败提示

### 测试用例 5.7: 向导步骤导航
**步骤**:
1. 在全局设置向导中，前进到第3步
2. 点击"上一步"返回第2步
3. 再次点击"下一步"到第3步

**预期结果**:
- ✅ 每次切换步骤都有淡入动画
- ✅ 之前填写的数据被保留（不会丢失）
- ✅ 进度条正确更新当前步骤

---

## 测试结果记录

请在测试过程中记录每个测试用例的结果：

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 1.1 首次启动显示向导 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 1.2 欢迎页面 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 1.3 版本选择 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| ... | ... | ... |
| 2.1 连接测试按钮状态 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 2.2 成功连接测试 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| ... | ... | ... |

---

## 常见问题排查

### 问题1: 应用启动后没有显示全局设置向导
**可能原因**:
- 配置文件已存在（不是首次启动）
- `initial-setup-config.json` 中的 `setupCompleted` 为 `true`

**解决方案**:
1. 删除配置文件：`C:\Users\longfa\AppData\Roaming\chainlesschain-desktop-vue\initial-setup-config.json`
2. 重启应用

### 问题2: Electron窗口无法打开
**可能原因**:
- 端口冲突
- 数据库初始化失败

**解决方案**:
1. 检查端口5173是否被占用
2. 查看控制台错误日志
3. 尝试删除数据库文件重新初始化

### 问题3: 企业版连接测试一直超时
**可能原因**:
- 网络问题
- 服务器地址错误
- 防火墙阻止

**解决方案**:
1. 检查网络连接
2. 使用公共API端点测试（如：`https://httpbin.org/status/200`）
3. 检查防火墙设置

---

## 测试完成检查清单

测试完成后，请确保：

- [ ] 所有5个模块的测试用例都已执行
- [ ] 记录了所有失败的测试用例
- [ ] 对于失败的用例，记录了详细的错误信息和重现步骤
- [ ] 测试了至少一次完整的首次设置流程
- [ ] 测试了企业版服务器连接功能的所有场景
- [ ] 验证了配置导入导出功能正常工作
- [ ] 检查了应用的容错能力（边界测试）

---

## 下一步行动

测试完成后，请：

1. **整理测试报告**: 汇总所有测试结果，标记通过/失败的用例
2. **提交Bug报告**: 对于失败的用例，创建详细的Bug报告
3. **代码优化**: 根据测试反馈，优化代码和用户体验
4. **文档更新**: 更新`IMPLEMENTATION_SUMMARY.md`中的测试清单

---

**测试愉快！如有任何问题，请随时反馈。**
