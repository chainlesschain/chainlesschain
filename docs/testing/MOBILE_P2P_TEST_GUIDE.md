# 移动端 P2P 功能测试指南

**版本**: v1.0
**创建日期**: 2026-01-07
**测试环境**: 桌面端 (macOS) + 移动端 (微信开发者工具/HBuilderX)

---

## 📋 测试前准备

### 1. 数据库初始化

已完成数据库初始化，当前测试数据：

```bash
✅ 笔记: 25 条 (包括 5 条 Markdown 测试笔记)
✅ 文件夹: 12 个
✅ 项目: 15 个
```

**Markdown 测试笔记清单**：

| 序号 | 笔记标题 | 测试重点 |
|------|---------|---------|
| 1 | Markdown语法完整测试 | 基础语法：标题、粗体、斜体、代码、列表、引用、链接、图片、表格 |
| 2 | 代码示例集合 | 多语言代码块：JavaScript、Python、Bash、SQL、JSON |
| 3 | API文档示例 | 文档结构：多级标题、代码块、表格、警告提示 |
| 4 | 项目技术栈清单 | 复杂列表：嵌套列表、表格、代码块混合 |
| 5 | 复杂格式混合测试 | 高级格式：Emoji、特殊字符、嵌套格式、任务清单 |

### 2. 环境要求

**桌面端（PC端）**：
- macOS 系统
- 已安装并运行桌面应用
- P2P 服务已启动
- 数据库已初始化（包含测试笔记）

**移动端**：
- 微信开发者工具 或 HBuilderX
- uni-app 项目已打开
- 已配置信令服务器地址

**信令服务器**：
- WebSocket 服务运行在 `ws://localhost:9001`
- 支持 PC 和移动端消息转发

---

## 🎯 测试流程

### 阶段 1: 设备配对测试

#### 1.1 桌面端准备

```bash
# 1. 启动桌面应用
cd desktop-app-vue
npm run dev

# 2. 确认 P2P 服务已启动
# 在应用中检查状态栏或设置页面
```

#### 1.2 移动端配对操作

1. **打开设备配对页面**
   - 路径：`pages/device-pairing/index.vue`
   - 应显示：
     - ✅ QR 码（包含 DID 和配对信息）
     - ✅ 6 位配对码
     - ✅ 倒计时（默认 300 秒）

2. **扫描或输入配对码**
   - 使用 PC 端扫描移动端 QR 码
   - 或在 PC 端输入 6 位配对码

3. **验证配对成功**
   - 移动端显示"配对成功"提示
   - PC 端保存配对设备信息
   - 跳转到设备列表页面

**预期结果**：
- ✅ 配对流程顺利完成
- ✅ 设备信息正确保存
- ✅ 连接状态为"已连接"

---

### 阶段 2: 设备管理测试

#### 2.1 设备列表页面

**路径**: `pages/p2p/device-list.vue`

**测试项**：

1. **设备列表显示**
   - [ ] 显示所有已配对设备
   - [ ] 设备名称、DID、配对时间正确
   - [ ] 在线/离线状态准确

2. **统计信息**
   - [ ] 总设备数正确
   - [ ] 在线设备数正确
   - [ ] 离线设备数正确

3. **连接操作**
   - [ ] 点击"连接"按钮，设备变为在线状态
   - [ ] 点击"断开"按钮，设备变为离线状态
   - [ ] 连接状态实时更新

4. **设备操作**
   - [ ] 点击"查看PC状态"跳转到状态监控页面
   - [ ] 点击"取消配对"弹出确认对话框
   - [ ] 确认取消后，设备从列表移除

**预期结果**：
- ✅ 所有设备信息准确显示
- ✅ 连接/断开操作成功
- ✅ 状态更新及时

---

### 阶段 3: PC 状态监控测试

#### 3.1 PC 状态监控页面

**路径**: `pages/p2p/pc-status.vue`

**测试项**：

1. **系统信息显示**（10 项）
   - [ ] 主机名
   - [ ] 操作系统
   - [ ] CPU 型号
   - [ ] 内存总量
   - [ ] 磁盘总量
   - [ ] Node.js 版本
   - [ ] Electron 版本
   - [ ] 应用版本
   - [ ] 运行时间
   - [ ] 启动时间

2. **服务状态显示**（3 项）
   - [ ] 数据库状态（运行中/已停止）
   - [ ] P2P 网络状态（已连接/未连接）
   - [ ] LLM 服务状态（可用/不可用）

3. **实时性能监控**（3 项）
   - [ ] CPU 使用率（%）
   - [ ] 内存使用率（%）
   - [ ] 磁盘使用率（%）

4. **自动刷新功能**
   - [ ] 切换"自动刷新"开关
   - [ ] 开启后每 5 秒自动更新数据
   - [ ] 关闭后停止自动更新

5. **手动刷新功能**
   - [ ] 点击"立即刷新"按钮
   - [ ] 数据立即更新
   - [ ] 显示"刷新成功"提示

**预期结果**：
- ✅ 所有系统信息准确
- ✅ 服务状态实时反映
- ✅ 性能数据准确更新
- ✅ 自动刷新功能正常

---

### 阶段 4: 知识库同步测试

#### 4.1 笔记列表页面

**路径**: `pages/p2p/knowledge-list.vue`

**测试项**：

1. **笔记列表显示**
   - [ ] 显示所有笔记（25 条）
   - [ ] 笔记标题、预览内容、时间正确
   - [ ] 按更新时间降序排列

2. **全文搜索功能**
   - [ ] 输入关键词"Markdown"
   - [ ] 结果包含所有 Markdown 相关笔记（5 条）
   - [ ] 清空搜索，恢复完整列表

3. **标签筛选功能**
   - [ ] 横向滚动查看所有标签
   - [ ] 点击"Markdown"标签
   - [ ] 只显示带该标签的笔记（5 条）
   - [ ] 点击"全部"恢复完整列表

4. **分页加载**
   - [ ] 初始加载 20 条笔记
   - [ ] 滚动到底部自动加载更多
   - [ ] 显示"加载更多"或"没有更多了"

5. **笔记操作**
   - [ ] 点击笔记卡片
   - [ ] 跳转到笔记详情页面
   - [ ] 传递正确的笔记 ID 和 peerId

**预期结果**：
- ✅ 笔记列表正确显示
- ✅ 搜索功能准确
- ✅ 标签筛选有效
- ✅ 分页加载顺利

---

### 阶段 5: Markdown 渲染测试（重点）

#### 5.1 笔记详情页面

**路径**: `pages/p2p/note-detail.vue`

**测试笔记**：逐一打开 5 条 Markdown 测试笔记

---

#### 测试笔记 1: "Markdown语法完整测试"

**测试项**：

1. **标题渲染**
   - [ ] H1 标题显示正确（大号粗体）
   - [ ] H2 标题显示正确（中号粗体）
   - [ ] H3 标题显示正确（小号粗体）

2. **文本样式**
   - [ ] **粗体文本** 正确渲染
   - [ ] *斜体文本* 正确渲染
   - [ ] ***粗斜体*** 正确渲染
   - [ ] ~~删除线文本~~ 正确渲染
   - [ ] `行内代码` 正确渲染（灰色背景）

3. **列表渲染**
   - [ ] 有序列表（1. 2. 3.）正确显示
   - [ ] 无序列表（• 符号）正确显示
   - [ ] 嵌套列表缩进正确

4. **引用块**
   - [ ] 引用块左侧边框显示
   - [ ] 引用文字斜体显示
   - [ ] 背景色正确

5. **链接和图片**
   - [ ] 链接文字蓝色可点击
   - [ ] 图片正确加载显示
   - [ ] 占位图显示正确

6. **代码块**
   - [ ] JavaScript 代码块正确显示
   - [ ] Python 代码块正确显示
   - [ ] 代码背景色和边框正确
   - [ ] 代码缩进保持

7. **分割线**
   - [ ] 水平分割线显示

8. **表格**
   - [ ] 表格边框显示
   - [ ] 表头背景色正确
   - [ ] 单元格内容对齐
   - [ ] Emoji 在表格中正确显示

9. **混合格式**
   - [ ] 粗体中的代码正确显示
   - [ ] 斜体中的链接正确显示
   - [ ] 引用块中的多种格式正确显示

**预期结果**：
- ✅ 所有基础 Markdown 语法正确渲染
- ✅ 样式美观，间距合理
- ✅ 移动端适配良好

---

#### 测试笔记 2: "代码示例集合"

**测试项**：

1. **多语言代码块**
   - [ ] JavaScript 代码块（ES6+ 语法）
   - [ ] Python 代码块（缩进保持）
   - [ ] Shell 脚本代码块
   - [ ] SQL 查询代码块
   - [ ] JSON 配置代码块

2. **代码高亮标记**
   - [ ] 代码块标注语言（```javascript）
   - [ ] 代码块背景色一致
   - [ ] 代码可读性良好

**预期结果**：
- ✅ 所有语言代码块正确显示
- ✅ 代码格式化正确
- ✅ 长代码可横向滚动

---

#### 测试笔记 3: "API文档示例"

**测试项**：

1. **文档结构**
   - [ ] 多级标题层次清晰
   - [ ] 章节分隔明显

2. **API 示例**
   - [ ] HTTP 请求代码块
   - [ ] JSON 响应代码块
   - [ ] 代码块与说明文字对比清晰

3. **表格和列表**
   - [ ] 错误码表格显示正确
   - [ ] 参数列表清晰可读

4. **警告提示**
   - [ ] 引用块作为警告提示显示
   - [ ] 引用块中的粗体格式正确

**预期结果**：
- ✅ 文档结构清晰易读
- ✅ 代码示例完整
- ✅ 表格和列表布局合理

---

#### 测试笔记 4: "项目技术栈清单"

**测试项**：

1. **嵌套列表**
   - [ ] 多级嵌套列表缩进正确
   - [ ] 子项缩进明显
   - [ ] 列表符号正确

2. **混合内容**
   - [ ] 列表 + 代码块混排
   - [ ] 表格 + 列表混排
   - [ ] 引用块 + 列表混排

3. **技术栈表格**
   - [ ] 表格显示完整
   - [ ] 单元格内容不被截断
   - [ ] 表格宽度自适应

**预期结果**：
- ✅ 嵌套列表层次分明
- ✅ 混合内容排版美观
- ✅ 表格自适应宽度

---

#### 测试笔记 5: "复杂格式混合测试"

**测试项**：

1. **Emoji 渲染**
   - [ ] 标题中的 Emoji 正确显示
   - [ ] 列表中的 Emoji 正确显示
   - [ ] 表格中的 Emoji 正确显示
   - [ ] 各种 Emoji：😀 🎉 ⚡ 🚀 💡 ⭐ ✅ ❌ ⚠️

2. **特殊字符**
   - [ ] 数学符号：± × ÷ ≠ ≈ ≤ ≥ ∞
   - [ ] 箭头符号：→ ← ↑ ↓ ⇒ ⇐ ⇔
   - [ ] 其他符号：© ® ™ § ¶ † ‡ • ◦ ‣

3. **嵌套格式**
   - [ ] 外层粗体包含斜体列表
   - [ ] 外层粗体包含代码
   - [ ] 外层粗体包含链接
   - [ ] 外层斜体包含粗体有序项
   - [ ] 外层斜体包含删除线

4. **任务清单（Checkbox）**
   - [ ] [x] 已完成项显示勾选标记
   - [ ] [ ] 未完成项显示空框标记
   - [ ] 任务清单缩进正确

5. **代码与说明混排**
   - [ ] 代码块上方的说明文字
   - [ ] 代码块下方的引用块
   - [ ] 代码块 + 列表混合

6. **性能测试表格**
   - [ ] 表格中的粗体正确显示
   - [ ] 表格中的 Emoji 正确显示
   - [ ] 表格行背景色交替（如果有）

7. **图片与说明**
   - [ ] 图片下方的说明列表
   - [ ] 图片 + 文字混排布局

**预期结果**：
- ✅ 所有 Emoji 和特殊字符正确显示
- ✅ 嵌套格式完整渲染
- ✅ 任务清单正确显示
- ✅ 复杂混合内容排版美观

---

### 阶段 6: 笔记操作测试

#### 6.1 操作菜单测试

**路径**: `pages/p2p/note-detail.vue`

**测试项**：

1. **打开操作菜单**
   - [ ] 点击右上角"更多"按钮（三个点）
   - [ ] 弹出操作菜单
   - [ ] 显示 3 个选项：
     - 📋 复制内容
     - 📤 分享笔记
     - 🔄 刷新

2. **复制内容功能**
   - [ ] 选择"复制内容"
   - [ ] 显示"内容已复制"提示
   - [ ] 粘贴到其他应用验证内容正确

3. **分享笔记功能**
   - [ ] 选择"分享笔记"
   - [ ] 调用系统分享功能
   - [ ] 分享内容包含标题和链接（或文本）

4. **刷新功能**
   - [ ] 选择"刷新"
   - [ ] 笔记内容重新加载
   - [ ] 显示"刷新成功"提示

**预期结果**：
- ✅ 操作菜单正确弹出
- ✅ 复制功能正常
- ✅ 分享功能调用成功
- ✅ 刷新功能正常

---

## 🐛 常见问题排查

### 问题 1: 设备配对失败

**可能原因**：
- 信令服务器未启动
- PC 端 P2P 服务未启动
- 网络连接问题

**解决方法**：
1. 检查信令服务器是否运行：`ws://localhost:9001`
2. 检查 PC 端应用 P2P 服务状态
3. 检查网络连接，确保移动端和 PC 端在同一网络

---

### 问题 2: 笔记列表为空

**可能原因**：
- P2P 连接断开
- 数据库未初始化
- Handler 处理器错误

**解决方法**：
1. 检查设备连接状态（设备列表页面）
2. 运行数据库初始化脚本：
   ```bash
   cd desktop-app-vue
   node scripts/init-test-database.js
   ```
3. 查看 PC 端控制台日志，确认 Handler 注册成功

---

### 问题 3: Markdown 渲染异常

**可能原因**：
- mp-html 组件未正确配置
- Markdown 转换函数错误
- 样式未加载

**解决方法**：
1. 检查 `note-detail.vue` 中的 `markdownToHtml` 方法
2. 确认 mp-html 组件已正确安装
3. 检查页面 CSS 样式是否加载

---

### 问题 4: 请求超时

**可能原因**：
- P2P 消息未送达
- Handler 处理时间过长
- 超时时间设置过短

**解决方法**：
1. 增加超时时间（当前 30 秒）
2. 检查 PC 端 Handler 是否正确响应
3. 查看 P2P 消息路由日志

---

## 📊 测试结果记录

### 测试环境信息

| 项目 | 信息 |
|-----|------|
| 测试日期 | 2026-01-07 |
| 桌面端版本 | v0.16.0 |
| 移动端框架 | uni-app |
| 测试工具 | 微信开发者工具 / HBuilderX |
| 数据库笔记数 | 25 条 |
| Markdown 测试笔记 | 5 条 |

---

### 测试结果汇总

| 测试阶段 | 测试项数 | 通过 | 失败 | 备注 |
|---------|---------|------|------|------|
| 1. 设备配对 | 3 | - | - | |
| 2. 设备管理 | 10 | - | - | |
| 3. PC 状态监控 | 15 | - | - | |
| 4. 知识库同步 | 12 | - | - | |
| 5. Markdown 渲染 | 50+ | - | - | 重点测试 |
| 6. 笔记操作 | 7 | - | - | |
| **总计** | **97+** | **-** | **-** | |

**通过率**: -%

---

## ✅ 测试检查清单

### 功能测试

- [ ] 设备配对功能正常
- [ ] 设备列表显示正确
- [ ] 连接/断开操作成功
- [ ] PC 状态监控数据准确
- [ ] 笔记列表加载正常
- [ ] 全文搜索功能有效
- [ ] 标签筛选功能有效
- [ ] 笔记详情正确显示

### Markdown 渲染测试

- [ ] 标题（H1-H3）正确渲染
- [ ] 文本样式（粗体/斜体/删除线）正确
- [ ] 行内代码和代码块正确
- [ ] 有序列表和无序列表正确
- [ ] 嵌套列表缩进正确
- [ ] 引用块显示正确
- [ ] 链接可点击
- [ ] 图片正确加载
- [ ] 表格显示完整
- [ ] 分割线显示
- [ ] Emoji 正确显示
- [ ] 特殊字符正确显示
- [ ] 嵌套格式正确渲染
- [ ] 任务清单正确显示

### 操作测试

- [ ] 复制内容功能正常
- [ ] 分享笔记功能正常
- [ ] 刷新功能正常
- [ ] 返回导航正常

### 性能测试

- [ ] 笔记列表加载速度 < 1 秒
- [ ] 笔记详情加载速度 < 500ms
- [ ] Markdown 渲染速度 < 200ms
- [ ] 搜索响应速度 < 500ms
- [ ] 自动刷新不卡顿

---

## 🚀 下一步计划

测试完成后，根据结果进行以下工作：

### 高优先级

1. **修复发现的 Bug** 🐛
   - 记录所有测试中发现的问题
   - 按优先级修复 Bug
   - 重新测试验证修复效果

2. **真机测试** 📱
   - iOS 真机测试
   - Android 真机测试
   - 跨平台兼容性验证

3. **性能优化** ⚡
   - 优化大笔记加载
   - 优化 Markdown 渲染性能
   - 减少不必要的网络请求

### 中优先级

4. **UI 优化** 🎨
   - 添加骨架屏加载
   - 优化动画效果
   - 改进交互体验

5. **功能扩展** ✨
   - 项目文件同步 UI
   - 离线消息同步测试
   - 增量同步实现

### 低优先级

6. **文档完善** 📚
   - 补充用户使用手册
   - 添加常见问题解答
   - 更新 API 文档

---

## 📝 测试报告模板

测试完成后，请填写以下报告：

```markdown
# 移动端 P2P 功能测试报告

**测试人员**: [姓名]
**测试日期**: 2026-01-07
**测试环境**: [环境信息]

## 测试结果

- 总测试项: 97+
- 通过: [数量]
- 失败: [数量]
- 通过率: [百分比]

## 发现的问题

### 问题 1: [问题标题]
- **严重程度**: 高/中/低
- **问题描述**: [详细描述]
- **复现步骤**: [步骤]
- **预期结果**: [预期]
- **实际结果**: [实际]
- **截图**: [如有]

### 问题 2: ...

## 测试结论

[总结测试结果，给出建议]

## 建议

1. [建议 1]
2. [建议 2]
3. ...
```

---

**创建人**: Claude Sonnet 4.5
**版本**: v1.0
**最后更新**: 2026-01-07

---

> 💡 **提示**: 请按照本指南逐步完成测试，记录所有发现的问题，以便后续优化改进。
