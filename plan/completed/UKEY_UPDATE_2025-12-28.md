# Uç›¾å¤šå“ç‰Œæ”¯æŒæ›´æ–° - 2025-12-28

## ğŸ‰ é‡å¤§æ›´æ–°

ChainlessChain çš„Uç›¾ç³»ç»Ÿç°å·²æ”¯æŒ**5ç§ä¸»æµå“ç‰Œ**çš„è‡ªåŠ¨è¯†åˆ«å’Œåˆ‡æ¢ï¼

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. æ–°å¢å“ç‰Œæ”¯æŒ

| å“ç‰Œ | çŠ¶æ€ | ç‰¹è‰²åŠŸèƒ½ |
|------|------|---------|
| ğŸ†• **åå¤§ (Huada)** | âœ… å®Œæˆ | **å›½å¯†ç®—æ³•æ”¯æŒ (SM2/SM3/SM4)** |
| ğŸ†• **å¤©åœ°è (TDR)** | âœ… å®Œæˆ | **æ”¯ä»˜å¯†ç å™¨æ¨¡å¼** |
| âœ… é£å¤©è¯šä¿¡ (FeiTian) | å¢å¼º | å¹¿æ³›å…¼å®¹æ€§ |
| âœ… æ¡å¥‡ (WatchData) | å¢å¼º | ä¼ä¸šçº§å®‰å…¨ |
| âœ… é‘«é‡‘ç§‘ (XinJinKe) | ç°æœ‰ | åŸºç¡€åŠŸèƒ½ |

### 2. æ ¸å¿ƒæ”¹è¿›

#### ğŸ” æ™ºèƒ½è‡ªåŠ¨æ£€æµ‹
```javascript
const manager = new UKeyManager();
const result = await manager.autoDetect();
// è‡ªåŠ¨è¯†åˆ«ï¼šé‘«é‡‘ç§‘ â†’ é£å¤© â†’ æ¡å¥‡ â†’ åå¤§ â†’ å¤©åœ°è
```

#### ğŸ”„ åŠ¨æ€é©±åŠ¨åˆ‡æ¢
```javascript
await manager.switchDriver('huada'); // è¿è¡Œæ—¶åˆ‡æ¢
```

#### ğŸ” åå¤§å›½å¯†ç®—æ³•
```javascript
const smSupport = huadaDriver.supportsSM();
// SM2: âœ“ SM3: âœ“ SM4: âœ“
```

#### ğŸ’³ å¤©åœ°èæ”¯ä»˜æ¨¡å¼
```javascript
await tdrDriver.enablePaymentMode();
const counter = await tdrDriver.getTransactionCounter();
```

## ğŸ“ æ–°å¢æ–‡ä»¶

```
desktop-app-vue/src/main/ukey/
â”œâ”€â”€ huada-driver.js          # åå¤§é©±åŠ¨ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ tdr-driver.js            # å¤©åœ°èé©±åŠ¨ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ multi-brand-test.js      # æµ‹è¯•å¥—ä»¶ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ ukey-manager.js          # æ›´æ–°ï¼šæ”¯æŒ5ç§å“ç‰Œ
â”œâ”€â”€ config.js                # æ›´æ–°ï¼šæ–°å¢é…ç½®é¡¹
â””â”€â”€ types.js                 # æ›´æ–°ï¼šç±»å‹å®šä¹‰
```

## ğŸ”§ ä¿®æ”¹æ–‡ä»¶

### `ukey-manager.js`
- âœ… æ·»åŠ åå¤§ã€å¤©åœ°èé©±åŠ¨å¯¼å…¥
- âœ… æ›´æ–° `DriverTypes` æšä¸¾
- âœ… æ‰©å±• `autoDetect()` æ£€æµ‹åˆ—è¡¨
- âœ… å®Œå–„ `createDriver()` å·¥å‚æ–¹æ³•

### `config.js`
- âœ… æ·»åŠ åå¤§é…ç½®é¡¹ï¼ˆå›½å¯†æ”¯æŒï¼‰
- âœ… æ·»åŠ å¤©åœ°èé…ç½®é¡¹ï¼ˆæ”¯ä»˜æ¨¡å¼ï¼‰

### `types.js`
- âœ… æ›´æ–° `UKeyDriverType` ç±»å‹å®šä¹‰

## ğŸ§ª æµ‹è¯•ç»“æœ

è¿è¡Œæµ‹è¯•ï¼š`node src/main/ukey/multi-brand-test.js`

```
âœ… é‘«é‡‘ç§‘é©±åŠ¨ - åˆå§‹åŒ–æˆåŠŸ
âœ… é£å¤©è¯šä¿¡é©±åŠ¨ - åˆå§‹åŒ–æˆåŠŸ
âœ… æ¡å¥‡é©±åŠ¨ - åˆå§‹åŒ–æˆåŠŸ
âœ… åå¤§é©±åŠ¨ - åˆå§‹åŒ–æˆåŠŸ â­ï¸ æ–°å¢
âœ… å¤©åœ°èé©±åŠ¨ - åˆå§‹åŒ–æˆåŠŸ â­ï¸ æ–°å¢
âœ… æ¨¡æ‹Ÿé©±åŠ¨ - åˆå§‹åŒ–æˆåŠŸ

âœ… è‡ªåŠ¨æ£€æµ‹åŠŸèƒ½ - æ­£å¸¸
âœ… æ‰‹åŠ¨åˆ‡æ¢é©±åŠ¨ - æ­£å¸¸
âœ… åå¤§å›½å¯†ç®—æ³•æ£€æµ‹ - SM2/SM3/SM4 æ”¯æŒ â­ï¸
âœ… å¤©åœ°èæ”¯ä»˜æ¨¡å¼ - æ­£å¸¸ â­ï¸
```

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨

```javascript
const { UKeyManager } = require('./ukey/ukey-manager');

const manager = new UKeyManager();
await manager.initialize();

// è‡ªåŠ¨è¯†åˆ«Uç›¾å“ç‰Œ
const result = await manager.autoDetect();

if (result.detected) {
  console.log(`æ£€æµ‹åˆ°: ${result.driverType}`);
  console.log(`åˆ¶é€ å•†: ${result.status.manufacturer}`);

  // éªŒè¯PINå¹¶ä½¿ç”¨
  await manager.verifyPIN('123456');
  const signature = await manager.sign('æ•°æ®');
}
```

### ä½¿ç”¨åå¤§å›½å¯†åŠŸèƒ½

```javascript
const manager = new UKeyManager({ driverType: 'huada' });
await manager.initialize();

// æ£€æŸ¥å›½å¯†æ”¯æŒ
const driver = manager.currentDriver;
const smSupport = driver.supportsSM();

if (smSupport.SM2) {
  // ä½¿ç”¨SM2ç­¾å
  await manager.verifyPIN('123456');
  const signature = await manager.sign(data);
}
```

### ä½¿ç”¨å¤©åœ°èæ”¯ä»˜åŠŸèƒ½

```javascript
const manager = new UKeyManager({ driverType: 'tdr' });
await manager.initialize();

// å¯ç”¨æ”¯ä»˜æ¨¡å¼
const driver = manager.currentDriver;
await driver.enablePaymentMode();

// æŸ¥çœ‹äº¤æ˜“è®¡æ•°
const counter = await driver.getTransactionCounter();
console.log(`å·²å®Œæˆ ${counter.counter} ç¬”äº¤æ˜“`);
```

## ğŸ¯ åº”ç”¨åœºæ™¯

### åå¤§Uç›¾
- âœ… é‡‘èè¡Œä¸šï¼ˆå›½å¯†æ ‡å‡†ï¼‰
- âœ… æ”¿åºœæœºæ„
- âœ… æ¶‰å¯†ä¿¡æ¯ç³»ç»Ÿ
- âœ… ç”µå­æ”¿åŠ¡

### å¤©åœ°èUç›¾
- âœ… åœ¨çº¿æ”¯ä»˜
- âœ… POSç»ˆç«¯
- âœ… é“¶è¡Œäº¤æ˜“
- âœ… ç”µå­å•†åŠ¡

## ğŸš€ éƒ¨ç½²è¯´æ˜

### 1. æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 

ç°æœ‰ä½¿ç”¨ `UKeyManager` çš„ä»£ç **æ— éœ€ä¿®æ”¹**ï¼Œä¼šè‡ªåŠ¨è·å¾—å¤šå“ç‰Œæ”¯æŒã€‚

### 2. å¯é€‰ï¼šé…ç½®é»˜è®¤é©±åŠ¨

ç¼–è¾‘ `ukey-config.json`ï¼š

```json
{
  "driverType": "huada",
  "driverOptions": {
    "huada": {
      "supportSM": true
    }
  }
}
```

### 3. å®‰è£…é©±åŠ¨DLL

- åå¤§ï¼šå®‰è£…åå¤§Uç›¾é©±åŠ¨ç¨‹åº
- å¤©åœ°èï¼šå®‰è£…å¤©åœ°èUç›¾é©±åŠ¨ç¨‹åº
- å…¶ä»–å“ç‰Œï¼šä¿æŒç°æœ‰é…ç½®

### 4. æµ‹è¯•éªŒè¯

```bash
cd desktop-app-vue
node src/main/ukey/multi-brand-test.js
```

## ğŸ“Š å…¼å®¹æ€§

| é¡¹ç›® | è¦æ±‚ | è¯´æ˜ |
|------|------|------|
| æ“ä½œç³»ç»Ÿ | Windows | å¿…éœ€ï¼ˆmacOS/Linuxä»…æ¨¡æ‹Ÿæ¨¡å¼ï¼‰ |
| Node.js | 16+ | ç°æœ‰è¦æ±‚ |
| Electron | 39.2.6+ | ç°æœ‰è¦æ±‚ |
| SKF API | GM/T 0016-2012 | å›½å®¶æ ‡å‡† |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Windowså¹³å°é™åˆ¶**ï¼šç‰©ç†Uç›¾ä»…æ”¯æŒWindowsï¼ŒmacOS/Linuxå¯ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼
2. **DLLä¾èµ–**ï¼šéœ€è¦å®‰è£…å¯¹åº”å“ç‰Œçš„é©±åŠ¨ç¨‹åº
3. **å‘åå…¼å®¹**ï¼šå®Œå…¨å…¼å®¹ç°æœ‰ä»£ç ï¼Œæ— ç ´åæ€§æ›´æ”¹
4. **è‡ªåŠ¨é™çº§**ï¼šDLLæœªæ‰¾åˆ°æ—¶è‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼

## ğŸ“š æ–‡æ¡£

å®Œæ•´æ–‡æ¡£ï¼š`desktop-app-vue/UKEY_MULTI_BRAND_SUPPORT.md`

åŒ…å«å†…å®¹ï¼š
- è¯¦ç»†APIå‚è€ƒ
- å®Œæ•´ä½¿ç”¨ç¤ºä¾‹
- æ•…éšœæ’é™¤æŒ‡å—
- DLLè·¯å¾„é…ç½®
- äº‹ä»¶ç›‘å¬è¯´æ˜

## ğŸ› å·²çŸ¥é—®é¢˜

1. å¤©åœ°èäº¤æ˜“è®¡æ•°å™¨éœ€è¦è®¾å¤‡è§£é”æ‰èƒ½è¯»å–ï¼ˆå·²åœ¨æµ‹è¯•ä¸­å‘ç°ï¼‰
2. DLLè·¯å¾„æœç´¢å¯èƒ½åœ¨æŸäº›è‡ªå®šä¹‰å®‰è£…ç›®å½•ä¸‹å¤±è´¥ï¼ˆå¯æ‰‹åŠ¨é…ç½®ï¼‰

## ğŸ”œ åç»­è®¡åˆ’

- [ ] æ·»åŠ æ›´å¤šå“ç‰Œæ”¯æŒï¼ˆæ¡å¥‡ã€æ±Ÿå—å¤©å®‰ç­‰ï¼‰
- [ ] macOS/Linuxç¡¬ä»¶æ”¯æŒï¼ˆéœ€è¦å‚å•†SDKï¼‰
- [ ] å¹¶è¡Œæ£€æµ‹ï¼ˆæå‡æ£€æµ‹é€Ÿåº¦ï¼‰
- [ ] è®¾å¤‡æŒ‡çº¹è¯†åˆ«ï¼ˆè®°å¿†ç”¨æˆ·å¸¸ç”¨è®¾å¤‡ï¼‰

## ğŸ‘¥ è´¡çŒ®è€…

- å®ç°ï¼šClaude Code
- æµ‹è¯•ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶
- æ–‡æ¡£ï¼šå®Œæ•´æŠ€æœ¯æ–‡æ¡£

## ğŸ“ æ›´æ–°æ¸…å•

- [x] æ·»åŠ åå¤§é©±åŠ¨
- [x] æ·»åŠ å¤©åœ°èé©±åŠ¨
- [x] æ›´æ–°UKeyManager
- [x] æ›´æ–°é…ç½®å’Œç±»å‹
- [x] ç¼–å†™æµ‹è¯•å¥—ä»¶
- [x] ä¿®å¤è¯­æ³•é”™è¯¯
- [x] è¿è¡Œæµ‹è¯•éªŒè¯
- [x] ç¼–å†™æŠ€æœ¯æ–‡æ¡£
- [x] ç¼–å†™æ›´æ–°è¯´æ˜

## ğŸŠ æ€»ç»“

è¿™æ¬¡æ›´æ–°å¤§å¹…æ‰©å±•äº†ChainlessChainçš„Uç›¾å…¼å®¹æ€§ï¼š

- ä» **3ç§** å“ç‰Œå¢åŠ åˆ° **5ç§**
- æ–°å¢ **å›½å¯†ç®—æ³•** æ”¯æŒï¼ˆåå¤§ï¼‰
- æ–°å¢ **æ”¯ä»˜å¯†ç å™¨** åŠŸèƒ½ï¼ˆå¤©åœ°èï¼‰
- æä¾› **å®Œæ•´æµ‹è¯•å¥—ä»¶**
- é™„å¸¦ **è¯¦ç»†æ–‡æ¡£**

ç°åœ¨ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ›´å¤šå“ç‰Œçš„Uç›¾ï¼Œç‰¹åˆ«æ˜¯é‡‘èå’Œæ”¿åŠ¡é¢†åŸŸå¸¸ç”¨çš„åå¤§ã€å¤©åœ°èè®¾å¤‡ï¼

---

**æ—¥æœŸ**: 2025-12-28
**ç‰ˆæœ¬**: v1.0.0
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•
