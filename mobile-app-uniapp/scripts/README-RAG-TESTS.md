# RAGç³»ç»Ÿæµ‹è¯•æŒ‡å—

## æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«ç§»åŠ¨ç«¯RAGï¼ˆRetrieval-Augmented Generationï¼‰ç³»ç»Ÿçš„æµ‹è¯•è„šæœ¬ã€‚

## æµ‹è¯•è„šæœ¬

### `test-rag.js` - RAGç³»ç»Ÿå®Œæ•´æµ‹è¯•

**åŠŸèƒ½**: æµ‹è¯•æ‰€æœ‰RAGç»„ä»¶çš„åŠŸèƒ½æ­£ç¡®æ€§

**æµ‹è¯•è¦†ç›–**:
- âœ… Embeddings Service (å‘é‡ç”ŸæˆæœåŠ¡)
  - æ¨¡å¼æ£€æµ‹ (transformers.js/API/TF-IDF)
  - å‘é‡ç”Ÿæˆ (å•ä¸ª/æ‰¹é‡)
  - ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—
  - ç¼“å­˜æœºåˆ¶
- âœ… Vector Store (å‘é‡å­˜å‚¨)
  - åˆå§‹åŒ–å’ŒæŒä¹…åŒ–
  - æ·»åŠ å‘é‡ (å•ä¸ª/æ‰¹é‡)
  - ç›¸ä¼¼åº¦æœç´¢
  - åˆ é™¤å‘é‡
- âœ… Reranker (é‡æ’åºå™¨)
  - å…³é”®è¯é‡æ’åº
  - æ··åˆé‡æ’åº (å‘é‡+å…³é”®è¯)
- âœ… RAG Manager (RAGç®¡ç†å™¨)
  - åˆå§‹åŒ–å’Œç´¢å¼•æ„å»º
  - æ–‡æ¡£æ£€ç´¢
  - æŸ¥è¯¢å¢å¼º
  - æ–‡æ¡£ç®¡ç† (æ·»åŠ /åˆ é™¤)
  - æ€§èƒ½ç»Ÿè®¡

## è¿è¡Œæ–¹å¼

### å‰ææ¡ä»¶

```bash
# ç¡®ä¿å·²å®‰è£…Node.js (æ¨èv16+)
node --version

# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd mobile-app-uniapp
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡ŒRAGç³»ç»Ÿæµ‹è¯•
node scripts/test-rag.js
```

### é¢„æœŸè¾“å‡º

```
================================================================================
RAGç³»ç»Ÿæµ‹è¯•å¼€å§‹
================================================================================

ğŸ“ EmbeddingsService: åˆå§‹åŒ–å’Œæ¨¡å¼æ£€æµ‹
   å½“å‰æ¨¡å¼: tfidf
âœ… é€šè¿‡

ğŸ“ EmbeddingsService: TF-IDFå‘é‡ç”Ÿæˆ
   æ–‡æœ¬: "Pythonæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ "
   å‘é‡ç»´åº¦: 384
   å‘é‡å‰5ç»´: [0.0000, 0.1234, 0.0567, ...]
âœ… é€šè¿‡

... (æ›´å¤šæµ‹è¯•)

================================================================================
æµ‹è¯•ç»“æœ
================================================================================
âœ… é€šè¿‡: 15
âŒ å¤±è´¥: 0
ğŸ“Š æ€»è®¡: 15
ğŸ¯ æˆåŠŸç‡: 100.00%
================================================================================
```

## æµ‹è¯•è¯´æ˜

### æ¨¡æ‹Ÿç¯å¢ƒ

æµ‹è¯•è„šæœ¬è¿è¡Œåœ¨Node.jsç¯å¢ƒä¸­ï¼ŒåŒ…å«ä»¥ä¸‹æ¨¡æ‹Ÿ:

1. **uni-app APIæ¨¡æ‹Ÿ**: æ¨¡æ‹Ÿ`uni.request`ç­‰uni-appæ¥å£
2. **æ•°æ®åº“æ¨¡æ‹Ÿ**: ä½¿ç”¨å†…å­˜æ•°æ®åº“æ¨¡æ‹ŸSQLiteæ“ä½œ
3. **æµ‹è¯•æ•°æ®**: é¢„ç½®5æ¡æµ‹è¯•ç¬”è®°æ•°æ®

### æµ‹è¯•æ•°æ®

æµ‹è¯•ä½¿ç”¨ä»¥ä¸‹é¢„ç½®æ•°æ®:

```javascript
[
  {
    id: '1',
    title: 'Pythonæœºå™¨å­¦ä¹ åŸºç¡€',
    content: 'Pythonæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€...',
    tags: 'Python,æœºå™¨å­¦ä¹ '
  },
  {
    id: '2',
    title: 'JavaScriptå¼‚æ­¥ç¼–ç¨‹',
    content: 'JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹ä¸»è¦é€šè¿‡Promise...',
    tags: 'JavaScript,å¼‚æ­¥ç¼–ç¨‹'
  },
  // ... 3æ¡æ›´å¤šæ•°æ®
]
```

### æ€§èƒ½åŸºå‡†

æµ‹è¯•è„šæœ¬ä¼šè¾“å‡ºå…³é”®æ€§èƒ½æŒ‡æ ‡:

| æŒ‡æ ‡ | é¢„æœŸå€¼ | è¯´æ˜ |
|------|--------|------|
| å‘é‡ç”Ÿæˆ (TF-IDF) | < 10ms | å•ä¸ªæ–‡æ¡£ |
| ç›¸ä¼¼åº¦æœç´¢ | < 50ms | 5ä¸ªå‘é‡ |
| é‡æ’åº | < 10ms | Hybridæ¨¡å¼ |
| å®Œæ•´æ£€ç´¢ | < 100ms | æ£€ç´¢+é‡æ’åº |

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**1. æ¨¡å—åŠ è½½å¤±è´¥**

```
âŒ æ¨¡å—åŠ è½½å¤±è´¥: Cannot find module
```

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿æ‰€æœ‰RAGæ¨¡å—æ–‡ä»¶å­˜åœ¨
- æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- éªŒè¯æ–‡ä»¶å¯¼å‡ºè¯­æ³• (`export default`)

**2. æµ‹è¯•å¤±è´¥ - å‘é‡ç»´åº¦é”™è¯¯**

```
âŒ å¤±è´¥: å‘é‡ç»´åº¦é”™è¯¯: æœŸæœ›384ï¼Œå®é™…256
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥`embeddings-service.js`ä¸­çš„å‘é‡ç»´åº¦é…ç½®
- ç¡®ä¿TF-IDFç”Ÿæˆå™¨ä½¿ç”¨384ç»´

**3. æµ‹è¯•å¤±è´¥ - æ•°æ®åº“æ“ä½œ**

```
âŒ å¤±è´¥: åˆå§‹åŒ–å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥`database.js`æ¨¡å—çš„å¯¼å…¥
- éªŒè¯æ•°æ®åº“è¡¨ç»“æ„æ˜¯å¦æ­£ç¡®

### è°ƒè¯•æ¨¡å¼

åœ¨æµ‹è¯•è„šæœ¬ä¸­æ·»åŠ è°ƒè¯•è¾“å‡º:

```javascript
// åœ¨test-rag.jsé¡¶éƒ¨æ·»åŠ 
process.env.DEBUG = 'true'
```

## é›†æˆåˆ°CI/CD

### GitHub Actionsç¤ºä¾‹

```yaml
name: RAG Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '16'
      - name: Run RAG tests
        run: |
          cd mobile-app-uniapp
          node scripts/test-rag.js
```

## æ‰©å±•æµ‹è¯•

### æ·»åŠ è‡ªå®šä¹‰æµ‹è¯•

åœ¨`test-rag.js`ä¸­æ·»åŠ æ–°æµ‹è¯•:

```javascript
runner.test('æˆ‘çš„è‡ªå®šä¹‰æµ‹è¯•', async () => {
  // æµ‹è¯•é€»è¾‘
  const result = await someFunction()

  console.log(`   ç»“æœ: ${result}`)

  if (result !== expected) {
    throw new Error('æµ‹è¯•å¤±è´¥')
  }
})
```

### æ€§èƒ½æµ‹è¯•

æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•:

```javascript
runner.test('æ€§èƒ½æµ‹è¯•: å¤§è§„æ¨¡æ£€ç´¢', async () => {
  const manager = new RAGManager({ embeddingsMode: 'tfidf' })
  await manager.initialize()

  const startTime = Date.now()

  for (let i = 0; i < 100; i++) {
    await manager.retrieve(`æµ‹è¯•æŸ¥è¯¢ ${i}`)
  }

  const totalTime = Date.now() - startTime
  const avgTime = totalTime / 100

  console.log(`   100æ¬¡æŸ¥è¯¢æ€»è€—æ—¶: ${totalTime}ms`)
  console.log(`   å¹³å‡è€—æ—¶: ${avgTime}ms`)

  if (avgTime > 100) {
    throw new Error(`æ€§èƒ½ä¸è¾¾æ ‡: ${avgTime}ms > 100ms`)
  }
})
```

## ç›¸å…³æ–‡æ¡£

- [MOBILE_RAG_COMPLETE_REPORT.md](../../MOBILE_RAG_COMPLETE_REPORT.md) - RAGå®ç°å®Œæ•´æŠ¥å‘Š
- [embeddings-service.js](../src/services/rag/embeddings-service.js) - å‘é‡ç”ŸæˆæœåŠ¡
- [vector-store.js](../src/services/rag/vector-store.js) - å‘é‡å­˜å‚¨
- [reranker.js](../src/services/rag/reranker.js) - é‡æ’åºå™¨
- [rag-manager.js](../src/services/rag/rag-manager.js) - RAGç®¡ç†å™¨

## åé¦ˆä¸è´¡çŒ®

å¦‚æœå‘ç°æµ‹è¯•é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–Pull Requestã€‚

---

**ç”Ÿæˆæ—¶é—´**: 2026-01-02
**ç»´æŠ¤è€…**: ChainlessChain Team
