# ChainlessChain 移动端 UniApp 功能实施计划

**文档版本：** v1.0
**创建日期：** 2025-12-20
**参考文档：** 系统设计_个人移动AI管理系统.md

---

## 📊 当前实现状态评估

### ✅ 已完成模块（约30%）

#### 1. 知识库基础功能
- [x] 知识CRUD操作
- [x] 标签系统（12色）
- [x] 搜索和筛选
- [x] 收藏/星标功能
- [x] 知识关联
- [x] 文件夹数据层
- [x] 数据统计仪表板
- [x] 本地数据库（SQLite/localStorage双模式）

#### 2. AI辅助功能（模拟实现）
- [x] 智能摘要生成
- [x] 标签建议
- [x] 内容扩展
- [x] 内容润色

#### 3. 数据备份
- [x] 本地备份
- [x] 云端备份基础框架
- [x] WebDAV配置界面

#### 4. UI框架
- [x] 页面路由结构
- [x] 主题系统（深色/浅色）
- [x] 基础社交页面UI（好友、动态、消息）
- [x] 基础交易页面UI（市场、订单、资产）

---

## 🚧 缺失的核心功能（约70%）

### 第一优先级：安全与身份层（P0）

#### 1.1 DID去中心化身份系统
**系统设计要求：**
```
- DID标识符生成：did:chainlesschain:<public_key_hash>
- DID文档管理
- 公私钥对生成（Ed25519签名 + X25519加密）
- 可验证凭证（Verifiable Credentials）
```

**当前状态：** ❌ 未实现
**实施难度：** 🔴 高
**预计工期：** 2-3周

**实施步骤：**
1. 集成加密库（tweetnacl-js / noble-ed25519）
2. 实现DID生成和验证
3. 创建DID数据库表结构
4. 开发DID管理页面
5. 实现DID文档CRUD

**技术栈：**
- `@stablelib/ed25519` - Ed25519签名
- `@stablelib/x25519` - 加密
- 本地SQLite存储DID数据

---

#### 1.2 SIMKey硬件安全集成
**系统设计要求：**
```
- SIM卡安全芯片私钥存储
- OMAPI (org.simalliance.openmobileapi)
- 数字签名和加密操作
```

**当前状态：** ❌ 未实现
**实施难度：** 🔴 极高
**预计工期：** 4-6周

**实施方案：**
- **Android端：**
  - 使用OMAPI访问SIM卡
  - 原生插件开发（Java/Kotlin）
  - UniApp插件封装

- **iOS端：**
  - Core Telephony（需运营商支持）
  - 降级方案：使用Keychain + Secure Enclave

- **降级方案（短期）：**
  - 软件模拟密钥（仅测试用）
  - 密码 + 设备密钥链
  - 生物识别认证

**阻塞因素：**
⚠️ SIMKey需要运营商支持，商用难度极大
⚠️ 建议优先实现降级方案

---

### 第二优先级：社交网络层（P1）

#### 2.1 P2P通信网络
**系统设计要求：**
```
- libp2p集成（节点发现、DHT、NAT穿透）
- WebRTC直连
- Signal协议端到端加密
- 离线消息中继
```

**当前状态：** ⚠️ UI已有，功能未实现
**实施难度：** 🔴 高
**预计工期：** 3-4周

**实施步骤：**
1. **Phase 1：基础P2P通信**
   - 集成libp2p-js（轻量版）
   - 实现WebSocket连接
   - 简单的节点发现（中心化引导节点）

2. **Phase 2：端到端加密**
   - Signal协议集成（@signalapp/libsignal-client-js）
   - 双棘轮密钥协商
   - 加密消息收发

3. **Phase 3：去中心化优化**
   - DHT节点发现
   - WebRTC直连
   - STUN/TURN服务器配置

**技术替代方案（降低难度）：**
- 短期：使用WebSocket + 中继服务器
- 中期：引入MQTT协议
- 长期：完整P2P网络

---

#### 2.2 社交功能完善
**已有UI页面：**
- `pages/social/friends` - 好友列表
- `pages/social/posts` - 动态广场
- `pages/social/messages` - 消息列表
- `pages/social/friend-chat` - 聊天界面

**需要实现的功能：**

1. **好友管理**
   - [x] 数据库表已创建
   - [ ] 添加好友（扫描DID二维码）
   - [ ] 好友请求处理
   - [ ] 好友分组
   - [ ] 黑名单

2. **动态发布**
   - [x] 数据库表已创建
   - [ ] 发布文本/图片动态
   - [ ] 可见性控制（公开/好友/私密）
   - [ ] 点赞和评论
   - [ ] 内容签名验证

3. **私密消息**
   - [x] UI界面已有
   - [ ] 端到端加密聊天
   - [ ] 离线消息
   - [ ] 已读回执
   - [ ] 消息撤回

**预计工期：** 2-3周

---

### 第三优先级：AI增强层（P1）

#### 3.1 向量数据库与RAG
**系统设计要求：**
```
- 向量数据库（ChromaDB/Qdrant）
- Embedding模型（bge-small-zh-v1.5）
- RAG检索增强生成
- 语义搜索
```

**当前状态：** ❌ 未实现（仅模拟）
**实施难度：** 🟡 中
**预计工期：** 2-3周

**实施方案：**

**方案A：纯前端实现（推荐）**
```javascript
技术栈：
├── transformers.js - 浏览器端运行ML模型
├── hnswlib-wasm - 轻量级向量索引
├── localforage - 向量数据持久化
└── 预训练模型：all-MiniLM-L6-v2（多语言）
```

**方案B：混合架构**
```
移动端：
- 简单查询：本地向量检索
- 复杂查询：调用云端API

云端：
- 完整向量数据库
- 大型Embedding模型
```

**实施步骤：**
1. 集成transformers.js
2. 下载轻量级Embedding模型
3. 实现向量化服务
4. 构建向量索引
5. 实现语义搜索接口
6. 集成到知识库搜索

---

#### 3.2 本地LLM集成
**系统设计要求：**
```
移动端：MiniCPM-2B / Phi-3（轻量级模型）
推理框架：MLC LLM / llama.cpp
```

**当前状态：** ⚠️ AI服务仅为模拟
**实施难度：** 🔴 高
**预计工期：** 3-4周

**移动端LLM方案对比：**

| 方案 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| **MLC LLM** | 原生加速，性能好 | 包体积大(>100MB) | 旗舰手机 |
| **llama.cpp** | 跨平台，生态好 | 需要原生编译 | 全平台 |
| **Web LLM** | 纯JS实现 | 性能较差 | H5/小程序 |
| **云端API** | 质量高，无需本地资源 | 需联网，有成本 | 通用 |

**推荐方案：分层架构**
```javascript
// 智能路由
if (taskSimple && modelAvailable) {
  return localLLM.infer(prompt)  // 本地推理
} else {
  return cloudAPI.call(prompt)   // 云端API
}
```

**实施步骤：**
1. 集成Web LLM（短期）
2. 开发原生插件（中期）
3. 实现混合推理路由
4. 模型下载管理
5. 性能优化和量化

---

### 第四优先级：数据同步层（P2）

#### 4.1 Git仓库同步
**系统设计要求：**
```
- Git Push/Pull同步
- libgit2 / JGit
- 冲突解决机制
- 版本历史管理
```

**当前状态：** ⚠️ 有云同步框架，但非Git
**实施难度：** 🟡 中
**预计工期：** 2周

**技术方案：**

**移动端Git实现：**
- **Android:** JGit（纯Java实现）
- **iOS:** ObjectiveGit（libgit2封装）
- **H5/小程序:** 使用Git HTTP API

**实施步骤：**
1. 开发UniApp原生插件
2. 封装Git基础操作
3. 实现自动同步服务
4. 冲突检测和UI
5. GitHub/Gitee私有仓库集成

**替代方案：**
- 使用GitHub REST API
- 使用Gitee WebDAV

---

#### 4.2 IPFS分布式存储
**系统设计要求：**
```
- 公开内容上传到IPFS
- 获取CID（内容寻址）
- IPFS网关访问
```

**当前状态：** ❌ 未实现
**实施难度：** 🟡 中
**预计工期：** 1-2周

**实施方案：**
```javascript
// 轻量级方案
- js-ipfs-http-client
- 连接到Infura IPFS网关
- 或自建IPFS节点
```

---

### 第五优先级：交易辅助层（P2）

#### 5.1 智能合约集成
**系统设计要求：**
```
- 以太坊集成（Ethers.js）
- 托管合约
- 多签钱包
- 交易签名
```

**当前状态：** ⚠️ UI已有，功能未实现
**实施难度：** 🟡 中
**预计工期：** 2-3周

**已有页面：**
- `pages/trade/market` - 交易市场
- `pages/trade/orders` - 我的订单
- `pages/trade/assets` - 我的资产

**实施步骤：**
1. 集成ethers.js
2. 钱包创建和管理
3. 合约交互封装
4. 交易签名（DID私钥）
5. 托管合约部署和调用

---

#### 5.2 信誉系统
**系统设计要求：**
```
- 交易历史链上存证
- 多维度信用分计算
- 评价体系
- 零知识证明
```

**当前状态：** ❌ 未实现
**实施难度：** 🔴 高
**预计工期：** 2周

**数据库设计：**
```sql
CREATE TABLE reputation_scores (
  user_did TEXT PRIMARY KEY,
  total_transactions INTEGER DEFAULT 0,
  success_rate REAL DEFAULT 0.0,
  average_rating REAL DEFAULT 0.0,
  trust_score REAL DEFAULT 0.0,
  last_calculated INTEGER
);

CREATE TABLE reviews (
  id TEXT PRIMARY KEY,
  transaction_id TEXT,
  reviewer_did TEXT,
  reviewee_did TEXT,
  rating INTEGER CHECK(rating >= 1 AND rating <= 5),
  comment TEXT,
  signature TEXT,
  created_at INTEGER
);
```

---

## 📅 分阶段实施路线图

### 🎯 Phase 1: MVP核心功能（4-6周）

**目标：** 实现可独立运行的知识库+基础社交

#### Week 1-2: 安全基础
- [ ] DID身份系统（简化版）
- [ ] 软件密钥管理（降级方案）
- [ ] 密码+生物识别认证
- [ ] 数据加密增强

#### Week 3-4: 社交基础
- [ ] 好友系统完善
- [ ] 端到端加密消息（Signal协议）
- [ ] 动态发布和时间线
- [ ] WebSocket中继服务器

#### Week 5-6: AI增强
- [ ] 向量数据库集成（transformers.js）
- [ ] 语义搜索
- [ ] RAG基础实现
- [ ] 云端LLM API接入

**验收标准：**
- ✅ 用户可创建DID身份
- ✅ 用户可添加好友并加密聊天
- ✅ 知识库支持语义搜索
- ✅ AI问答基于真实RAG

---

### 🎯 Phase 2: 去中心化网络（4-6周）

**目标：** 实现真正的P2P通信

#### Week 1-2: P2P网络
- [ ] libp2p-js集成
- [ ] 节点发现（引导节点）
- [ ] WebRTC直连
- [ ] NAT穿透（STUN）

#### Week 3-4: 分布式存储
- [ ] Git同步实现
- [ ] IPFS集成
- [ ] 版本冲突解决
- [ ] 离线消息队列

#### Week 5-6: 性能优化
- [ ] 消息缓存策略
- [ ] 节点连接池
- [ ] 带宽优化
- [ ] 电池优化

**验收标准：**
- ✅ 无需中心服务器可通信
- ✅ 数据Git自动同步
- ✅ 离线消息自动补发

---

### 🎯 Phase 3: 交易市场（3-4周）

**目标：** 实现去中心化交易

#### Week 1-2: 智能合约
- [ ] 钱包集成
- [ ] 托管合约部署
- [ ] 交易流程实现
- [ ] 多签机制

#### Week 3-4: 信誉与仲裁
- [ ] 信誉系统
- [ ] 评价机制
- [ ] 仲裁流程
- [ ] 争议解决

**验收标准：**
- ✅ 用户可发布交易需求
- ✅ 智能合约托管资金
- ✅ 评价系统正常运作

---

### 🎯 Phase 4: 硬件安全（持续）

**目标：** SIMKey/U盾集成（低优先级）

- [ ] 运营商SIMKey调研
- [ ] OMAPI原生插件开发
- [ ] 硬件密钥适配器
- [ ] 降级兼容方案

**⚠️ 说明：**
由于SIMKey商用难度极大，建议作为长期探索方向，短期以软件方案为主。

---

## 🛠 技术债务与优化

### 当前技术债务
1. **AI服务为模拟实现** - 需接入真实LLM
2. **无向量检索** - 搜索仅为全文匹配
3. **云同步非Git** - 与设计不符
4. **社交功能空壳** - UI存在但无逻辑
5. **交易功能空壳** - UI存在但无逻辑

### 架构优化建议
1. **服务层重构**
   - 抽象统一接口
   - 插件化架构
   - 依赖注入

2. **数据层优化**
   - 添加索引
   - 查询优化
   - 缓存机制

3. **UI组件化**
   - 抽取公共组件
   - 统一设计系统
   - 主题变量完善

---

## 📊 功能优先级矩阵

| 功能模块 | 重要性 | 紧急性 | 难度 | 优先级 | 建议工期 |
|---------|-------|-------|------|--------|---------|
| DID身份系统 | 🔴 高 | 🔴 高 | 🟡 中 | **P0** | 2周 |
| 端到端加密 | 🔴 高 | 🔴 高 | 🔴 高 | **P0** | 2周 |
| 向量数据库+RAG | 🔴 高 | 🟡 中 | 🟡 中 | **P1** | 3周 |
| P2P通信 | 🟡 中 | 🟡 中 | 🔴 高 | **P1** | 4周 |
| Git同步 | 🟡 中 | 🟢 低 | 🟡 中 | **P2** | 2周 |
| 本地LLM | 🟡 中 | 🟢 低 | 🔴 高 | **P2** | 4周 |
| 智能合约 | 🟢 低 | 🟢 低 | 🟡 中 | **P2** | 3周 |
| SIMKey硬件 | 🟢 低 | 🟢 低 | 🔴 极高 | **P3** | 6周+ |
| IPFS存储 | 🟢 低 | 🟢 低 | 🟡 中 | **P3** | 2周 |

---

## 💡 实施建议

### 短期目标（1-2个月）
**聚焦于MVP可用性**
1. 完善知识库AI增强（真实RAG）
2. 实现基础社交功能
3. DID身份系统
4. 加密通信基础

### 中期目标（3-6个月）
**构建去中心化网络**
1. P2P通信网络
2. Git/IPFS存储
3. 智能合约集成
4. 信誉系统

### 长期目标（6-12个月）
**完善生态和安全**
1. 硬件安全设备
2. 多平台适配
3. 性能优化
4. 生态插件

---

## 🚀 快速启动建议

### 如果只有2周时间
**优先实现：**
1. ✅ 接入云端LLM API（OpenAI/Claude）
2. ✅ 实现简单的向量检索（transformers.js）
3. ✅ 完善好友和聊天功能（非P2P）
4. ✅ DID身份基础版

### 如果只有1个月时间
**在2周基础上增加：**
5. ✅ Signal协议端到端加密
6. ✅ Git仓库同步
7. ✅ 完整的RAG问答
8. ✅ 社交动态发布

### 如果有3个月时间
**完整MVP实现：**
9. ✅ P2P网络基础
10. ✅ 智能合约托管
11. ✅ 本地LLM（可选）
12. ✅ 完整测试和优化

---

## 📝 下一步行动

### 立即可做
1. ✅ 接入云端LLM API（最快见效）
2. ✅ 集成transformers.js实现向量搜索
3. ✅ 完善社交页面业务逻辑

### 本周计划
1. 搭建DID身份框架
2. 实现好友管理完整流程
3. 集成Signal加密库

### 本月计划
1. 完成Phase 1所有功能
2. 开始P2P网络调研
3. 准备智能合约开发

---

**文档维护者：** ChainlessChain Team
**下次更新时间：** 每周五更新进度
