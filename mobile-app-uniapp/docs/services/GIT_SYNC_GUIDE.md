# Git同步功能使用指南

## 概述

ChainlessChain移动端Git同步功能允许您将知识库备份到远程Git仓库，实现多设备同步和版本控制。

## 功能特性

### 核心功能
- ✅ **Git仓库管理** - 初始化、克隆、状态查询
- ✅ **版本控制** - 提交、推送、拉取
- ✅ **自动同步** - 可配置的自动同步间隔
- ✅ **冲突检测** - 检测本地和远程的差异
- ✅ **提交历史** - 查看完整的提交记录
- ✅ **多平台支持** - App、H5、小程序全平台支持

### 技术实现
- 基于 **isomorphic-git** 纯JavaScript实现
- 支持 **HTTPS** 协议
- 支持 **Personal Access Token** 认证
- 跨平台文件系统适配

## 快速开始

### 1. 配置Git设置

进入 **设置 → Git设置**，配置以下信息：

#### 用户信息
- **用户名**: 您的Git用户名
- **邮箱**: 您的Git邮箱

#### 远程仓库
- **仓库地址**: Git仓库URL（例如：`https://github.com/username/repo.git`）
- **用户名**: Git账户用户名
- **密码/Token**: 密码或Personal Access Token（推荐使用Token）

#### 自动同步
- **启用自动同步**: 开启后自动定期同步
- **同步间隔**: 选择同步频率（1分钟、5分钟、10分钟、30分钟、1小时）

### 2. 初始化仓库

有两种方式初始化Git仓库：

#### 方式一：使用现有仓库
1. 配置好远程仓库地址和认证信息
2. 点击 **克隆仓库** 按钮
3. 等待克隆完成

#### 方式二：创建新仓库
1. 在GitHub/GitLab等平台创建新仓库
2. 配置远程仓库地址
3. 进入Git同步页面
4. 点击 **同步** 按钮，首次同步会自动推送本地内容

### 3. 日常使用

#### 手动同步
1. 进入 **Git同步** 页面
2. 查看当前状态（待推送、待拉取、本地更改）
3. 点击 **同步** 按钮
4. 如有本地更改，输入提交消息
5. 等待同步完成

#### 自动同步
- 启用自动同步后，系统会按设定间隔自动同步
- 自动同步使用默认提交消息："自动同步"
- 可在Git设置中调整同步间隔

## 使用场景

### 场景1：多设备同步
1. 在设备A上配置Git同步
2. 创建或编辑知识库内容
3. 同步到远程仓库
4. 在设备B上配置相同的远程仓库
5. 克隆或拉取最新内容
6. 两个设备的知识库保持同步

### 场景2：版本备份
1. 定期同步知识库到远程仓库
2. 通过提交历史查看所有版本
3. 如需恢复，可从远程仓库克隆

### 场景3：协作编辑
1. 多人配置相同的远程仓库
2. 各自编辑知识库内容
3. 定期同步，Git会自动合并更改
4. 如有冲突，手动解决

## 状态说明

### 同步状态
- **已同步** - 本地和远程完全一致
- **有更改** - 本地有未提交的更改
- **需要同步** - 本地或远程有新的提交
- **同步中** - 正在执行同步操作

### 文件状态
- **已修改** - 文件内容已更改
- **未跟踪** - 新创建的文件
- **已删除** - 文件已删除

### Ahead/Behind
- **待推送** - 本地有N个提交未推送到远程
- **待拉取** - 远程有N个提交未拉取到本地

## 常见问题

### Q1: 如何获取Personal Access Token？

**GitHub**:
1. 登录GitHub
2. 进入 Settings → Developer settings → Personal access tokens
3. 点击 Generate new token
4. 选择权限（至少需要 `repo` 权限）
5. 生成并复制Token

**GitLab**:
1. 登录GitLab
2. 进入 User Settings → Access Tokens
3. 创建新Token
4. 选择权限（至少需要 `write_repository` 权限）
5. 生成并复制Token

### Q2: 同步失败怎么办？

1. **检查网络连接** - 确保设备联网
2. **检查仓库地址** - 确认URL正确
3. **检查认证信息** - 确认用户名和Token正确
4. **检查权限** - 确认有仓库的读写权限
5. **查看错误信息** - 根据错误提示排查问题

### Q3: 如何解决冲突？

目前移动端暂不支持手动解决冲突，建议：
1. 在PC端使用桌面应用解决冲突
2. 或在GitHub/GitLab网页端解决冲突
3. 然后在移动端拉取最新版本

### Q4: 自动同步会消耗流量吗？

是的，自动同步会使用网络流量：
- 仅在有更改时才会推送
- 每次同步的流量取决于更改的文件大小
- 建议在WiFi环境下使用自动同步
- 或设置较长的同步间隔（如30分钟或1小时）

### Q5: 可以同步到私有仓库吗？

可以，只要：
1. 配置正确的仓库地址
2. 提供有效的认证信息（用户名和Token）
3. Token有足够的权限

### Q6: 支持哪些Git平台？

支持所有标准的Git平台：
- ✅ GitHub
- ✅ GitLab
- ✅ Gitee（码云）
- ✅ Bitbucket
- ✅ 自建Git服务器（需支持HTTPS）

### Q7: 如何禁用自动同步？

1. 进入 **设置 → Git设置**
2. 关闭 **启用自动同步** 开关
3. 点击 **保存**

### Q8: 提交历史可以删除吗？

移动端不支持删除提交历史，如需操作：
1. 在PC端使用Git命令行工具
2. 或在GitHub/GitLab网页端操作
3. 然后在移动端拉取最新版本

## 最佳实践

### 1. 使用Personal Access Token
- 比密码更安全
- 可以随时撤销
- 可以设置精细的权限

### 2. 合理设置同步间隔
- 频繁编辑时：5-10分钟
- 偶尔编辑时：30分钟-1小时
- 仅备份用途：手动同步即可

### 3. 定期查看同步状态
- 确保更改已成功同步
- 及时发现同步问题
- 避免数据丢失

### 4. 使用有意义的提交消息
- 手动同步时输入清晰的提交消息
- 方便日后查看历史记录
- 便于团队协作

### 5. 备份重要数据
- Git同步是备份手段之一
- 建议同时使用其他备份方式
- 定期导出重要数据

## 技术细节

### 文件系统适配

#### App平台
使用 `plus.io` 文件系统API

#### H5平台
使用 `LightningFS`（IndexedDB）

#### 小程序平台
使用微信小程序文件系统API

### 认证方式
- 支持 HTTP Basic Auth
- 支持 Personal Access Token
- 推荐使用Token认证

### 数据存储
- Git配置存储在SQLite数据库
- 仓库数据存储在本地文件系统
- 认证信息加密存储

### 性能优化
- 增量同步，仅传输更改的文件
- 压缩传输，减少流量消耗
- 后台同步，不阻塞UI

## 故障排除

### 问题1：克隆失败
**可能原因**:
- 网络连接问题
- 仓库地址错误
- 认证信息错误
- 权限不足

**解决方法**:
1. 检查网络连接
2. 确认仓库地址正确
3. 重新输入认证信息
4. 确认有仓库访问权限

### 问题2：推送失败
**可能原因**:
- 远程有新提交
- 认证信息过期
- 权限不足

**解决方法**:
1. 先拉取远程更新
2. 更新认证信息
3. 确认有推送权限

### 问题3：拉取失败
**可能原因**:
- 本地有未提交的更改
- 网络连接问题

**解决方法**:
1. 先提交本地更改
2. 检查网络连接
3. 重试拉取操作

### 问题4：自动同步不工作
**可能原因**:
- 未启用自动同步
- 应用在后台被系统杀死
- 网络连接问题

**解决方法**:
1. 确认已启用自动同步
2. 保持应用在前台运行
3. 检查网络连接

## 更新日志

### v0.3.0 (2026-01-14)
- ✅ 初始版本发布
- ✅ 支持基本的Git操作
- ✅ 支持自动同步
- ✅ 支持提交历史查看
- ✅ 跨平台文件系统适配

### 未来计划
- ⏳ 支持SSH协议
- ⏳ 支持冲突解决
- ⏳ 支持分支管理
- ⏳ 支持标签管理
- ⏳ 支持.gitignore编辑

## 反馈与支持

如有问题或建议，请联系：
- **Email**: zhanglongfa@chainlesschain.com
- **GitHub**: https://github.com/chainlesschain/chainlesschain/issues

---

**最后更新**: 2026-01-14
**版本**: v0.3.0
