# 移动端P2P功能快速测试指南

**版本**: v0.18.0
**预计测试时间**: 30-60分钟

---

## 🚀 快速开始（5分钟准备）

### 步骤 1: 准备PC端环境

```bash
# 1. 启动信令服务器（必须）
cd signaling-server
npm install  # 首次运行需要
npm start    # 保持运行

# 输出应显示:
# ✅ 信令服务器运行在 ws://localhost:9001
```

```bash
# 2. 初始化测试数据（包含5个Markdown测试笔记）
cd desktop-app-vue
node scripts/init-test-database.js

# 输出应显示:
# ✅ 插入 10 条笔记
# ✅ 验证数据...
#   - 笔记: 25 条
#   - 文件夹: 12 个
#   - 项目: 15 个
```

```bash
# 3. 测试PC端处理器（验证后端）
node scripts/test-p2p-handlers.js

# 输出应显示:
# ✅ 知识库同步处理器: ✅ 通过
# ✅ 项目同步处理器:   ✅ 通过
# ✅ PC状态处理器:     ✅ 通过
# 总计: 3/3 通过
```

```bash
# 4. 启动PC端应用
npm run dev

# 应用启动后，导航到: 设置 > P2P配对
```

---

### 步骤 2: 准备移动端环境

**选项 A: 微信开发者工具**

1. 打开微信开发者工具
2. 导入项目: `mobile-app-uniapp/`
3. 选择"小程序"模式
4. 点击"编译"

**选项 B: HBuilderX**

1. 打开HBuilderX
2. 文件 > 导入 > 从本地目录导入
3. 选择 `mobile-app-uniapp/`
4. 运行 > 运行到浏览器/模拟器

**选项 C: 真机测试**

1. 编译为小程序/App
2. 扫码预览或安装到真机

---

## ✅ 核心功能测试（20分钟）

### 测试 1: 设备配对（3分钟）

**PC端**:
1. 打开"设置 > P2P配对"
2. 点击"生成配对码"
3. 显示QR码和6位码

**移动端**:
1. 打开"设备配对"页面
2. 扫描QR码 或 输入6位码
3. 等待配对完成

**✅ 成功标志**:
- 移动端显示"配对成功"
- 自动跳转到设备列表
- 设备列表显示PC设备（绿色边框=在线）

---

### 测试 2: PC状态监控（2分钟）

**移动端**:
1. 从设备列表点击PC设备卡片
2. 选择"PC状态监控"

**检查点**:
- [ ] 系统信息（操作系统、CPU、内存）
- [ ] 服务状态（各服务运行状态）
- [ ] 实时监控（CPU使用率、内存使用率）

**✅ 成功标志**: 所有信息正确显示，数据合理

---

### 测试 3: 知识库同步（5分钟）

**移动端**:
1. 导航到"PC端知识库"
2. 选择已连接的PC设备
3. 查看笔记列表

**检查点**:
- [ ] 笔记列表显示（应该有25条笔记）
- [ ] 搜索功能（搜索"Markdown"）
- [ ] 标签筛选
- [ ] 点击笔记查看详情

**重点测试**: **Markdown渲染**

打开以下5个测试笔记，验证渲染效果：

1. **"Markdown语法完整测试"**
   - 检查: 标题、粗体、斜体、代码、列表、引用、表格

2. **"代码示例集合"**
   - 检查: JS/Python/Bash/SQL/JSON 代码块

3. **"API文档示例"**
   - 检查: 复杂格式、嵌套列表

4. **"技术栈列表"**
   - 检查: 多级嵌套列表

5. **"复杂格式混合测试"**
   - 检查: Emoji、特殊字符、任务列表

**✅ 成功标志**: 所有Markdown元素正确渲染，无乱码

---

### 测试 4: 项目文件同步（5分钟）

**移动端**:
1. 导航到"PC端项目"
2. 选择已连接的PC设备
3. 查看项目列表

**检查点**:
- [ ] 项目列表显示（应该有15个项目）
- [ ] 点击任一项目查看详情
- [ ] 查看"项目信息"Tab（统计、文件类型分布）
- [ ] 查看"文件树"Tab（递归树结构）
- [ ] 查看"文件搜索"Tab（搜索文件）

**✅ 成功标志**: 项目信息完整，文件树可展开，搜索正常

---

### 测试 5: 代码语法高亮（3分钟）

**移动端**:
1. 从文件树点击任一代码文件
2. 查看文件内容

**测试文件类型**:
- JavaScript文件 (`.js`) - 检查关键字、字符串、注释颜色
- JSON文件 (`package.json`) - 检查键值颜色
- HTML文件 (`.html`) - 检查标签颜色
- CSS文件 (`.css`) - 检查属性颜色

**操作**:
- 点击"🎨 高亮"按钮切换纯文本模式
- 再次点击恢复高亮

**✅ 成功标志**:
- 关键字显示紫色
- 字符串显示绿色
- 注释显示灰色
- 切换按钮工作正常

---

### 测试 6: 文件下载（2分钟）

**移动端**:
1. 打开任一文件
2. 点击"💾 下载"按钮
3. 等待保存完成

**检查点**:
- [ ] 显示"正在保存..."
- [ ] Toast提示"文件已保存"
- [ ] 弹窗显示文件路径
- [ ] 可以在文件管理器找到文件

**✅ 成功标志**: 文件保存成功，内容正确

---

### 测试 7: 智能缓存（5分钟）

**测试步骤**:

1. **首次加载文件**
   - 打开文件A
   - 记录加载时间: ______ ms

2. **返回列表**
   - 点击返回按钮

3. **再次打开文件**
   - 打开同一个文件A
   - 记录加载时间: ______ ms

4. **查看控制台**
   - 查找"从缓存加载文件"日志

**✅ 成功标志**:
- 第二次加载明显更快（几乎瞬间）
- 控制台显示缓存命中
- 性能提升 > 100倍

---

## 🐛 常见问题排查

### 问题 1: 信令服务器连接失败

**症状**: 移动端无法连接PC

**解决方案**:
```bash
# 1. 检查信令服务器是否运行
# 访问: http://localhost:9001
# 应该看到: "WebSocket signaling server"

# 2. 检查防火墙
# Windows: 允许端口 9001
# macOS: 系统偏好设置 > 安全性 > 防火墙

# 3. 检查网络
# 确保移动端和PC在同一局域网
```

---

### 问题 2: 笔记列表为空

**症状**: 知识库页面显示"暂无笔记"

**解决方案**:
```bash
# 重新初始化测试数据
cd desktop-app-vue
node scripts/init-test-database.js

# 验证数据库
sqlite3 "路径/chainlesschain.db" "SELECT COUNT(*) FROM notes;"
# 应该输出: 25
```

---

### 问题 3: 语法高亮不工作

**症状**: 代码显示为纯文本，无颜色

**解决方案**:
1. 检查文件扩展名是否支持
2. 点击"🎨 高亮"按钮确保已开启
3. 查看控制台是否有JavaScript错误

---

### 问题 4: 文件下载失败

**症状**: 点击下载按钮无反应或报错

**解决方案**:
1. 检查小程序文件系统权限
2. 检查文件大小（< 5MB）
3. 查看控制台错误信息

---

## 📊 快速验证清单

使用此清单快速验证核心功能：

```
核心功能验证
├─ [ ] 设备配对成功
├─ [ ] 设备列表显示
├─ [ ] PC状态监控正常
├─ [ ] 笔记列表加载
├─ [ ] Markdown渲染正确
├─ [ ] 项目列表显示
├─ [ ] 文件树展开
├─ [ ] 文件内容显示
├─ [ ] 语法高亮工作
├─ [ ] 文件下载成功
└─ [ ] 缓存加速明显

如果以上全部打✅，功能基本正常！
```

---

## 📝 测试报告填写

测试完成后，请填写详细的测试报告：

**文件**: `MOBILE_P2P_TEST_REPORT.md`

**重点记录**:
1. 每个测试项的通过/失败状态
2. 性能数据（加载时间、缓存命中率等）
3. 发现的问题和缺陷
4. 改进建议

---

## 🎯 下一步

### 如果测试通过

1. ✅ 标记项目为"Ready for Production"
2. 📝 整理测试报告
3. 🚀 准备发布或部署

### 如果发现问题

1. 📋 记录详细的问题描述
2. 📸 截图或录屏
3. 🐛 在issue tracker中创建缺陷
4. 🔧 等待修复后重新测试

---

## 💡 测试技巧

1. **分阶段测试** - 先测试基础功能，再测试高级功能
2. **记录数据** - 记录所有性能数据，方便对比
3. **模拟真实场景** - 测试时模拟真实使用场景
4. **边界测试** - 测试极限情况（大文件、深层文件树等）
5. **重复测试** - 关键功能多测试几次，确保稳定

---

## 📞 需要帮助？

如果测试过程中遇到问题：

1. 查看 `MOBILE_P2P_TEST_GUIDE.md` 详细测试指南
2. 查看 `MOBILE_P2P_IMPLEMENTATION.md` 实现文档
3. 查看控制台日志和错误信息
4. 检查网络连接和服务器状态

---

**祝测试顺利！🚀**
